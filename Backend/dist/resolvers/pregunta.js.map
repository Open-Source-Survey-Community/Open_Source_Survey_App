{"version":3,"sources":["../../resolvers/pregunta.js"],"names":["Query","verMyPreguntaActual","parent","args","models","Pregunta","findOne","_id","idPregunta","registroActual","populate","then","pregunta","catch","error","Error","listadoPreguntasActuales","edgePreguntaArray","cursor","parseInt","Buffer","from","after","toString","edgePreguntaInfoPromise","Promise","resolve","reject","edges","find","identificador","$gt","descripcion","RegExp","word","err","result","limit","on","push","res","node","endCursor","length","NaN","hasNextPage","cursorFinal","where","gt","count","pageInfo","hasnextPage","totalPagesPromise","listPaginatePregunta","all","values","totalCount","verListadoMisPreguntasActuales","idUsuario","usuario_ID","sort","listadoMisPreguntas","verListadoMisPreguntasActualesByEstado","estado","listadoPreguntas","listadoPreguntasActualesByEstado","historialImagenesUsadasByUserinAPregunta","listadoUsuariosDistintosCreadoPreguntas","distinct","User","$in","listaUsuariosDistintos","listaUsuarios","listadoAreasConocimientosUsadasPreguntas","areasConocimiento","listaAreasConocimientosUsadas","cargarListadoPreguntasByAreasConocimiento","areaconocimiento","idAreaConocimiento","cargarListaPreguntasAsignadasRevisor","listaPreguntas","Mutation","crearPregunta","existenPreguntasCreadas","objectNewPregunta","save","documento","editarPregunta","findById","preguntaAnterior","imagen","fecha_creacion","tipoPregunta","respuestas","findByIdAndUpdate","$push","historial_cambios","$set","new","documentoActualizado","eliminarPregunta","correo","correoUsuario","documentoPregunta","rollbackPreguntaAnterior","idPreguntaAnterior","ownerQuestion","rollbackDescripcionPregunta","rollbackRespuestasPregunta","rollbackImagenPregunta","asignarPreguntasAMiembroComite","registroUsuario","roles","rol","eachSeries","arrayPreguntas","item","next","registroPregunta","nombre","estados_asignados","usuario","estado_asignado","observacion","fecha_asignacion","Date","preguntaActualizada","asignarEstadoPregunta","findOneAndUpdate","errorActualizar","transferirListaPreguntasDesignadasAUsuario","idUsuarioDesignado","update","idUsuarioActivo","multi","actualizada","n"],"mappings":";;;;;;AACA;;;;;;kBAEe;AACdA,QAAO;AACNC,uBAAqB,6BAACC,MAAD,EAASC,IAAT,QAA4B;AAAA,OAAZC,MAAY,QAAZA,MAAY;;AAChD,UAAOA,OAAOC,QAAP,CAAgBC,OAAhB,CAAwB,EAACC,KAAKJ,KAAKK,UAAX;AAC9BC,oBAAgB,IADc,EAAxB,EAELC,QAFK,CAEI,YAFJ,EAGLA,QAHK,CAGI,2BAHJ,EAILA,QAJK,CAII,kBAJJ,EAKLA,QALK,CAKI,aALJ,EAMLC,IANK,CAMA,oBAAY;AACjB,WAAOC,QAAP;AACA,IARK,EAQHC,KARG,CAQG,iBAAQ;AAChB,QAAIC,KAAJ,EAAU;AACT,WAAM,IAAIC,KAAJ,CAAUD,KAAV,CAAN;AACA;AACD,IAZK,CAAP;AAcA,GAhBK;AAiBNE,4BAA2B,kCAACd,MAAD,EAASC,IAAT,SAA4B;AAAA,OAAZC,MAAY,SAAZA,MAAY;;AACtD,OAAIa,oBAAoB,EAAxB;AACA,OAAIC,SAASC,SAASC,OAAOC,IAAP,CAAYlB,KAAKmB,KAAjB,EAAwB,QAAxB,EAAkCC,QAAlC,CAA2C,OAA3C,CAAT,CAAb;AACA,OAAI,CAACL,MAAL,EAAY;AACXA,aAAS,CAAT;AACA;AACD,OAAIM,0BAA0B,IAAIC,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAoB;AAC7D,QAAIC,QAAQxB,OAAOC,QAAP,CAAgBwB,IAAhB,CAAqB,EAACC,eAAc,EAACC,KAAIb,MAAL,EAAf,EAA4BT,gBAAgB,IAA5C;AAChCuB,kBAAa,IAAIC,MAAJ,CAAW9B,KAAK+B,IAAhB,EAAsB,GAAtB,CADmB,EAArB,EAC+B,UAACC,GAAD,EAAMC,MAAN,EAAiB;AAC3D,SAAGD,GAAH,EAAO;AACNR,aAAOQ,GAAP;AACA;AACD,KALW,EAKTzB,QALS,CAKA,YALA,EAMVA,QANU,CAMD,2BANC,EAOVA,QAPU,CAOD,kBAPC,EAQVA,QARU,CAQD,aARC,EASV2B,KATU,CASJlC,KAAKkC,KATD,EASQnB,MATR,EAAZ;;AAWAU,UAAMU,EAAN,CAAS,MAAT,EAAiB,eAAO;AACvBrB,uBAAkBsB,IAAlB,CAAuB;AACtBrB,cAASE,OAAOC,IAAP,CAAamB,IAAIV,aAAL,CAAoBP,QAApB,EAAZ,EAA4CA,QAA5C,CAAqD,QAArD,CADa;AAEtBkB,YAAMD;AAFgB,MAAvB;AAIA,KALD;AAMAZ,UAAMU,EAAN,CAAS,KAAT,EAAe,YAAK;AACnB,SAAII,YAAYzB,kBAAkB0B,MAAlB,GAA2B,CAA3B,GAA+B1B,kBAAkBA,kBAAkB0B,MAAlB,GAA2B,CAA7C,EAAgDzB,MAA/E,GAAsF0B,GAAtG;AACA,SAAIC,cAAc,IAAIpB,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAoB;AACjD,UAAIe,SAAJ,EAAe;AACd,WAAII,cAAc3B,SAASC,OAAOC,IAAP,CAAYqB,SAAZ,EAAsB,QAAtB,EAAgCnB,QAAhC,CAAyC,OAAzC,CAAT,CAAlB;AACAnB,cAAOC,QAAP,CAAgB0C,KAAhB,CAAsB,eAAtB,EAAuCC,EAAvC,CAA0CF,WAA1C,EAAuDG,KAAvD,CAA6D,EAACxC,gBAAe,IAAhB,EAA7D,EAAmF,UAAC0B,GAAD,EAAMc,KAAN,EAAe;AACjG,YAAId,GAAJ,EAAS;AACRR,gBAAOQ,GAAP;AACA;AACDc,gBAAQ,CAAR,GAAYvB,QAAQ,IAAR,CAAZ,GAA2BA,QAAQ,KAAR,CAA3B;AACA,QALD;AAOA,OATD,MASO;AACNA,eAAQ,KAAR;AACA;AACD,MAbiB,CAAlB;AAcAA,aAAQ;AACPE,aAAOX,iBADA;AAEPiC,gBAAU;AACTR,kBAAWA,SADF;AAETS,oBAAaN;AAFJ;AAFH,MAAR;AAOA,KAvBD;AAwBA,IA1C6B,CAA9B;AA2CA,OAAIO,oBAAoB,IAAI3B,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;AACxDvB,WAAOC,QAAP,CAAgB4C,KAAhB,CAAsB,EAACxC,gBAAe,IAAhB,EAAtB,EAA4C,UAAC0B,GAAD,EAAMc,KAAN,EAAgB;AAC3D,SAAId,GAAJ,EAAS;AACRR,aAAOQ,GAAP;AACA,MAFD,MAEM;AACLT,cAAQuB,KAAR;AACA;AACD,KAND;AAOA,IARuB,CAAxB;AASA,OAAII,uBAAuB5B,QAAQ6B,GAAR,CAAY,CAAC9B,uBAAD,EAA0B4B,iBAA1B,CAAZ,EAA0DzC,IAA1D,CAA+D,UAAC4C,MAAD,EAAY;AACrG,WAAO;AACN3B,YAAO2B,OAAO,CAAP,EAAU3B,KADX;AAEN4B,iBAAYD,OAAO,CAAP,CAFN;AAGNL,eAAS;AACRR,iBAAWa,OAAO,CAAP,EAAUL,QAAV,CAAmBR,SADtB;AAERS,mBAAYI,OAAO,CAAP,EAAUL,QAAV,CAAmBC;AAFvB;AAHH,KAAP;AAQA,IAT0B,CAA3B;AAUA,UAAOE,oBAAP;AACA,GAtFK;AAuFNI,kCAAgC,wCAACvD,MAAD,EAASC,IAAT,SAA2B;AAAA,OAAXC,MAAW,SAAXA,MAAW;;AAC1D,OAAID,KAAKuD,SAAT,EAAoB;AACnB,WAAOtD,OAAOC,QAAP,CAAgBwB,IAAhB,CAAqB,EAAC8B,YAAYxD,KAAKuD,SAAlB,EAA6BjD,gBAAgB,IAA7C,EAArB,EACLC,QADK,CACI,YADJ,EAELA,QAFK,CAEI,2BAFJ,EAGLA,QAHK,CAGI,kBAHJ,EAILA,QAJK,CAII,aAJJ,EAKLkD,IALK,CAKA,EAAC,kBAAiB,CAAC,CAAnB,EALA,EAMLjD,IANK,CAMA,+BAAuB;AAC5B,YAAOkD,mBAAP;AACA,KARK,EASLhD,KATK,CASC,iBAAS;AACf,SAAIC,KAAJ,EAAW;AACV,YAAM,IAAIC,KAAJ,CAAUD,KAAV,CAAN;AACA;AACD,KAbK,CAAP;AAcA,IAfD,MAeO;AACN,UAAM,IAAIC,KAAJ,CAAU,iEAAV,CAAN;AACA;AAED,GA3GK;AA4GN+C,0CAAwC,gDAAC5D,MAAD,EAASC,IAAT,SAA2B;AAAA,OAAXC,MAAW,SAAXA,MAAW;;AAClE,OAAI2D,eAAJ;AACA,OAAI5D,KAAKuD,SAAT,EAAmB;AAClB,QAAI,CAACvD,KAAK4D,MAAV,EAAiB;AAChBA,cAAS,UAAT;AACA,KAFD,MAGK;AACJA,cAAS5D,KAAK4D,MAAd;AACA;AACD,WAAO3D,OAAOC,QAAP,CAAgBwB,IAAhB,CAAqB,EAAC8B,YAAYxD,KAAKuD,SAAlB,EAA6BjD,gBAAgB,IAA7C,EAAmDsD,QAAQA,MAA3D,EAArB,EACLrD,QADK,CACI,YADJ,EAELA,QAFK,CAEI,2BAFJ,EAGLA,QAHK,CAGI,kBAHJ,EAILA,QAJK,CAII,aAJJ,EAKLkD,IALK,CAKA,EAAC,kBAAiB,CAAC,CAAnB,EALA,EAMLjD,IANK,CAMA,4BAAoB;AACzB,YAAOqD,gBAAP;AACA,KARK,EAQHnD,KARG,CAQG,iBAAS;AACjB,SAAIC,KAAJ,EAAU;AACT,YAAM,IAAIC,KAAJ,CAAUD,KAAV,CAAN;AACA;AACD,KAZK,CAAP;AAaA,IApBD,MAoBO;AACN,UAAM,IAAIC,KAAJ,CAAU,iEAAV,CAAN;AACA;AAED,GAtIK;AAuINkD,oCAAkC,0CAAC/D,MAAD,EAASC,IAAT,SAA4B;AAAA,OAAZC,MAAY,SAAZA,MAAY;;AAC7D,OAAIa,oBAAoB,EAAxB;AACA,OAAIC,SAASC,SAASC,OAAOC,IAAP,CAAYlB,KAAKmB,KAAjB,EAAwB,QAAxB,EAAkCC,QAAlC,CAA2C,OAA3C,CAAT,CAAb;AACA,OAAI,CAACL,MAAL,EAAY;AACXA,aAAS,CAAT;AACA;AACD,OAAIM,0BAA0B,IAAIC,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAoB;AAC7D,QAAIC,QAAQxB,OAAOC,QAAP,CAAgBwB,IAAhB,CAAqB,EAACC,eAAc,EAACC,KAAIb,MAAL,EAAf,EAA4BT,gBAAgB,IAA5C;AAChCuB,kBAAa,IAAIC,MAAJ,CAAW9B,KAAK+B,IAAhB,EAAsB,GAAtB,CADmB,EACQ6B,QAAQ5D,KAAK4D,MADrB,EAArB,EACmD,UAAC5B,GAAD,EAAMC,MAAN,EAAiB;AAC/E,SAAGD,GAAH,EAAO;AACNR,aAAOQ,GAAP;AACA;AACD,KALW,EAKTzB,QALS,CAKA,YALA,EAMVA,QANU,CAMD,2BANC,EAOVA,QAPU,CAOD,kBAPC,EAQVA,QARU,CAQD,aARC,EASV2B,KATU,CASJlC,KAAKkC,KATD,EASQnB,MATR,EAAZ;;AAWAU,UAAMU,EAAN,CAAS,MAAT,EAAiB,eAAO;AACvBrB,uBAAkBsB,IAAlB,CAAuB;AACtBrB,cAASE,OAAOC,IAAP,CAAamB,IAAIV,aAAL,CAAoBP,QAApB,EAAZ,EAA4CA,QAA5C,CAAqD,QAArD,CADa;AAEtBkB,YAAMD;AAFgB,MAAvB;AAIA,KALD;AAMAZ,UAAMU,EAAN,CAAS,KAAT,EAAe,YAAK;AACnB,SAAII,YAAYzB,kBAAkB0B,MAAlB,GAA2B,CAA3B,GAA+B1B,kBAAkBA,kBAAkB0B,MAAlB,GAA2B,CAA7C,EAAgDzB,MAA/E,GAAsF0B,GAAtG;AACA,SAAIC,cAAc,IAAIpB,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAoB;AACjD,UAAIe,SAAJ,EAAe;AACd,WAAII,cAAc3B,SAASC,OAAOC,IAAP,CAAYqB,SAAZ,EAAsB,QAAtB,EAAgCnB,QAAhC,CAAyC,OAAzC,CAAT,CAAlB;AACAnB,cAAOC,QAAP,CAAgB0C,KAAhB,CAAsB,eAAtB,EAAuCC,EAAvC,CAA0CF,WAA1C,EAAuDG,KAAvD,CAA6D,EAACxC,gBAAe,IAAhB,EAA7D,EAAmF,UAAC0B,GAAD,EAAMc,KAAN,EAAe;AACjG,YAAId,GAAJ,EAAS;AACRR,gBAAOQ,GAAP;AACA;AACDc,gBAAQ,CAAR,GAAYvB,QAAQ,IAAR,CAAZ,GAA2BA,QAAQ,KAAR,CAA3B;AACA,QALD;AAOA,OATD,MASO;AACNA,eAAQ,KAAR;AACA;AACD,MAbiB,CAAlB;AAcAA,aAAQ;AACPE,aAAOX,iBADA;AAEPiC,gBAAU;AACTR,kBAAWA,SADF;AAETS,oBAAaN;AAFJ;AAFH,MAAR;AAOA,KAvBD;AAwBA,IA1C6B,CAA9B;AA2CA,OAAIO,oBAAoB,IAAI3B,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;AACxDvB,WAAOC,QAAP,CAAgB4C,KAAhB,CAAsB,UAACd,GAAD,EAAMc,KAAN,EAAgB;AACrC,SAAId,GAAJ,EAAS;AACRR,aAAOQ,GAAP;AACA,MAFD,MAEM;AACLT,cAAQuB,KAAR;AACA;AACD,KAND;AAOA,IARuB,CAAxB;AASA,OAAII,uBAAuB5B,QAAQ6B,GAAR,CAAY,CAAC9B,uBAAD,EAA0B4B,iBAA1B,CAAZ,EAA0DzC,IAA1D,CAA+D,UAAC4C,MAAD,EAAY;AACrG,WAAO;AACN3B,YAAO2B,OAAO,CAAP,EAAU3B,KADX;AAEN4B,iBAAYD,OAAO,CAAP,CAFN;AAGNL,eAAS;AACRR,iBAAWa,OAAO,CAAP,EAAUL,QAAV,CAAmBR,SADtB;AAERS,mBAAYI,OAAO,CAAP,EAAUL,QAAV,CAAmBC;AAFvB;AAHH,KAAP;AAQA,IAT0B,CAA3B;AAUA,UAAOE,oBAAP;AACA,GA5MK;AA6MNa,4CAA0C,kDAAChE,MAAD,EAASC,IAAT,SAA4B;AAAA,OAAZC,MAAY,SAAZA,MAAY;;AACrE,UAAOA,OAAOC,QAAP,CAAgBC,OAAhB,CAAwB,EAACC,KAAKJ,KAAKK,UAAX,EAAuBmD,YAAYxD,KAAKuD,SAAxC,EAAxB,EAA2E,0BAA3E,EACL/C,IADK,CACA,oBAAY;AACjB,QAAIC,SAASmD,MAAT,KAAoB,UAApB,IAAkCnD,SAASmD,MAAT,KAAoB,SAA1D,EAAoE;AACnE,YAAOnD,QAAP;AAEA,KAHD,MAGO;AACN,WAAM,IAAIG,KAAJ,CAAU,+DAAV,CAAN;AACA;AAED,IATK,EASHF,KATG,CASG,iBAAS;AACjB,QAAIC,KAAJ,EAAU;AACT,WAAM,IAAIC,KAAJ,CAAUD,KAAV,CAAN;AACA;AACD,IAbK,CAAP;AAcA,GA5NK;AA6NNqD,2CAAyC,iDAACjE,MAAD,EAASC,IAAT,SAA4B;AAAA,OAAZC,MAAY,SAAZA,MAAY;;AACpE,UAAOA,OAAOC,QAAP,CAAgB+D,QAAhB,CAAyB,YAAzB,EACLzD,IADK,CACA,kCAA0B;AAC/B,WAAOP,OAAOiE,IAAP,CAAYxC,IAAZ,CAAiB,EAAC,OAAM,EAACyC,KAAIC,sBAAL,EAAP,EAAjB,EACL5D,IADK,CACA,yBAAiB;AACtB,YAAO6D,aAAP;AACA,KAHK,EAGH3D,KAHG,CAGG,iBAAS;AACjB,SAAIC,KAAJ,EAAU;AACT,YAAM,IAAIC,KAAJ,CAAUD,KAAV,CAAN;AACA;AACD,KAPK,CAAP;AAQA,IAVK,EAUHD,KAVG,CAUG,iBAAS;AACjB,QAAIC,KAAJ,EAAU;AACT,WAAM,IAAIC,KAAJ,CAAUD,KAAV,CAAN;AACA;AACD,IAdK,CAAP;AAeA,GA7OK;AA8ON2D,4CAA0C,kDAACvE,MAAD,EAASC,IAAT,SAA4B;AAAA,OAAZC,MAAY,SAAZA,MAAY;;AACrE,UAAOA,OAAOsE,iBAAP,CAAyBN,QAAzB,CAAkC,QAAlC,EACLzD,IADK,CACA,yCAA+B;AACpC,WAAOgE,6BAAP;AACA,IAHK,EAGH9D,KAHG,CAGG,iBAAS;AACjB,QAAIC,KAAJ,EAAU;AACT,WAAM,IAAIC,KAAJ,CAAUD,KAAV,CAAN;AACA;AACD,IAPK,CAAP;AAQA,GAvPK;AAwPN8D,6CAA2C,mDAAC1E,MAAD,EAASC,IAAT,SAA0B;AAAA,OAAVC,MAAU,SAAVA,MAAU;;AACpE,OAAIa,oBAAoB,EAAxB;AACA,OAAIC,SAASC,SAASC,OAAOC,IAAP,CAAYlB,KAAKmB,KAAjB,EAAwB,QAAxB,EAAkCC,QAAlC,CAA2C,OAA3C,CAAT,CAAb;AACA,OAAI,CAACL,MAAL,EAAY;AACXA,aAAS,CAAT;AACA;AACD,OAAIM,0BAA0B,IAAIC,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAoB;AAC7D,QAAIC,QAAQxB,OAAOC,QAAP,CAAgBwB,IAAhB,CAAqB,EAACC,eAAc,EAACC,KAAIb,MAAL,EAAf,EAA4BT,gBAAgB,IAA5C;AAChCuB,kBAAa,IAAIC,MAAJ,CAAW9B,KAAK+B,IAAhB,EAAsB,GAAtB,CADmB,EACQ2C,kBAAkB1E,KAAK2E,kBAD/B,EAArB,EACyE,UAAC3C,GAAD,EAAMC,MAAN,EAAiB;AACrG,SAAGD,GAAH,EAAO;AACNR,aAAOQ,GAAP;AACA;AACD,KALW,EAKTzB,QALS,CAKA,YALA,EAMVA,QANU,CAMD,kBANC,EAOVA,QAPU,CAOD,aAPC,EAQV2B,KARU,CAQJlC,KAAKkC,KARD,EAQQnB,MARR,EAAZ;;AAUAU,UAAMU,EAAN,CAAS,MAAT,EAAiB,eAAO;AACvBrB,uBAAkBsB,IAAlB,CAAuB;AACtBrB,cAASE,OAAOC,IAAP,CAAamB,IAAIV,aAAL,CAAoBP,QAApB,EAAZ,EAA4CA,QAA5C,CAAqD,QAArD,CADa;AAEtBkB,YAAMD;AAFgB,MAAvB;AAIA,KALD;AAMAZ,UAAMU,EAAN,CAAS,KAAT,EAAe,YAAK;AACnB,SAAII,YAAYzB,kBAAkB0B,MAAlB,GAA2B,CAA3B,GAA+B1B,kBAAkBA,kBAAkB0B,MAAlB,GAA2B,CAA7C,EAAgDzB,MAA/E,GAAsF0B,GAAtG;AACA,SAAIC,cAAc,IAAIpB,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAoB;AACjD,UAAIe,SAAJ,EAAe;AACd,WAAII,cAAc3B,SAASC,OAAOC,IAAP,CAAYqB,SAAZ,EAAsB,QAAtB,EAAgCnB,QAAhC,CAAyC,OAAzC,CAAT,CAAlB;AACAnB,cAAOC,QAAP,CAAgB0C,KAAhB,CAAsB,eAAtB,EAAuCC,EAAvC,CAA0CF,WAA1C,EAAuDG,KAAvD,CAA6D,EAACxC,gBAAe,IAAhB;AAC5DoE,0BAAkB1E,KAAK2E,kBADqC,EAA7D,EAC4C,UAAC3C,GAAD,EAAMc,KAAN,EAAe;AAC1D,YAAId,GAAJ,EAAS;AACRR,gBAAOQ,GAAP;AACA;AACDc,gBAAQ,CAAR,GAAYvB,QAAQ,IAAR,CAAZ,GAA2BA,QAAQ,KAAR,CAA3B;AACA,QAND;AAQA,OAVD,MAUO;AACNA,eAAQ,KAAR;AACA;AACD,MAdiB,CAAlB;AAeAA,aAAQ;AACPE,aAAOX,iBADA;AAEPiC,gBAAU;AACTR,kBAAWA,SADF;AAETS,oBAAaN;AAFJ;AAFH,MAAR;AAOA,KAxBD;AAyBA,IA1C6B,CAA9B;AA2CA,OAAIO,oBAAoB,IAAI3B,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;AACxDvB,WAAOC,QAAP,CAAgB4C,KAAhB,CAAsB,EAAC4B,kBAAkB1E,KAAK2E,kBAAxB,EAA2CrE,gBAAe,IAA1D,EAAtB,EAAsF,UAAC0B,GAAD,EAAMc,KAAN,EAAgB;AACrG,SAAId,GAAJ,EAAS;AACRR,aAAOQ,GAAP;AACA,MAFD,MAEM;AACLT,cAAQuB,KAAR;AACA;AACD,KAND;AAOA,IARuB,CAAxB;AASA,OAAII,uBAAuB5B,QAAQ6B,GAAR,CAAY,CAAC9B,uBAAD,EAA0B4B,iBAA1B,CAAZ,EAA0DzC,IAA1D,CAA+D,UAAC4C,MAAD,EAAY;AACrG,WAAO;AACN3B,YAAO2B,OAAO,CAAP,EAAU3B,KADX;AAEN4B,iBAAYD,OAAO,CAAP,CAFN;AAGNL,eAAS;AACRR,iBAAWa,OAAO,CAAP,EAAUL,QAAV,CAAmBR,SADtB;AAERS,mBAAYI,OAAO,CAAP,EAAUL,QAAV,CAAmBC;AAFvB;AAHH,KAAP;AAQA,IAT0B,CAA3B;AAUA,UAAOE,oBAAP;AACA,GA7TK;AA8TN0B,wCAAsC,8CAAC7E,MAAD,EAASC,IAAT,UAA0B;AAAA,OAAVC,MAAU,UAAVA,MAAU;;AAC/D,UAAOA,OAAOC,QAAP,CAAgBwB,IAAhB,CAAqB,EAAC,6BAA4B1B,KAAKuD,SAAlC,EAA6C,kBAAkB,IAA/D,EAArB,EACLhD,QADK,CACI,YADJ,EAELA,QAFK,CAEI,kBAFJ,EAGLA,QAHK,CAGI,2BAHJ,EAILA,QAJK,CAII,aAJJ,EAKLkD,IALK,CAKA,EAAC,kBAAiB,CAAC,CAAnB,EALA,EAMLjD,IANK,CAMA,0BAAkB;AACvB,WAAOqE,cAAP;AACA,IARK,EAQHnE,KARG,CAQG,iBAAS;AACjB,QAAIC,KAAJ,EAAU;AACT,WAAM,IAAIC,KAAJ,CAAUD,KAAV,CAAN;AACA;AACD,IAZK,CAAP;AAeA;AA9UK,EADO;AAiVdmE,WAAU;AACTC,iBAAe,uBAAChF,MAAD,EAASC,IAAT,UAA4B;AAAA,OAAZC,MAAY,UAAZA,MAAY;;AAC1C,OAAID,KAAKS,QAAL,CAAcoB,WAAd,IAA6B7B,KAAKS,QAAL,CAAc+C,UAA3C,IAAyDxD,KAAKS,QAAL,CAAciE,gBAAd,CAA+BlC,MAA/B,GAAwC,CAArG,EAAwG;AACvG,WAAOvC,OAAOC,QAAP,CAAgB4C,KAAhB,GACLtC,IADK,CACA,mCAA2B;AAChC,SAAIwE,uBAAJ,EAA6B;AAC5BhF,WAAKS,QAAL,CAAckB,aAAd,GAA8BqD,0BAA0B,CAAxD;AACA;AACD,SAAMC,oBAAoB,IAAIhF,OAAOC,QAAX,CAAoBF,KAAKS,QAAzB,CAA1B;AACA,YAAOwE,kBAAkBC,IAAlB,GACL1E,IADK,CACA,qBAAa;AAClB,aAAO2E,SAAP;AACA,MAHK,EAILzE,KAJK,CAIC,iBAAS;AACf,UAAIC,KAAJ,EAAW;AACV,aAAM,IAAIC,KAAJ,CAAUD,KAAV,CAAN;AACA;AACD,MARK,CAAP;AAUA,KAhBK,EAgBHD,KAhBG,CAgBG,iBAAQ;AAChB,SAAIC,KAAJ,EAAU;AACT,YAAM,IAAIC,KAAJ,CAAUD,KAAV,CAAN;AACA;AACD,KApBK,CAAP;AAsBA,IAvBD,MAuBO;AACN,UAAM,IAAIC,KAAJ,CAAU,8DAAV,CAAN;AACA;AAED,GA7BQ;AA8BTwE,kBAAgB,wBAACrF,MAAD,EAASC,IAAT,UAA4B;AAAA,OAAZC,MAAY,UAAZA,MAAY;;AAC3C,UAAOA,OAAOC,QAAP,CAAgBmF,QAAhB,CAAyBrF,KAAKK,UAA9B,EACLG,IADK,CACA,qBAAa;AAClB,QAAI2E,UAAU3B,UAAV,IAAwBxD,KAAKS,QAAL,CAAc+C,UAA1C,EAAuD;AACtD,SAAI2B,UAAUvB,MAAV,KAAqB,UAArB,IAAmCuB,UAAUvB,MAAV,KAAqB,SAA5D,EAAsE;AACrE,UAAI0B,mBAAmB;AACtBzD,oBAAasD,UAAUtD,WADD;AAEtB0D,eAAQJ,UAAUI,MAFI;AAGtB3B,eAAQuB,UAAUvB,MAHI;AAItB4B,uBAAgBL,UAAUK,cAJJ;AAKtBC,qBAAcN,UAAUM,YALF;AAMtBf,yBAAkBS,UAAUT,gBANN;AAOtBgB,mBAAYP,UAAUO;AAPA,OAAvB;;AAUA,aAAOzF,OAAOC,QAAP,CAAgByF,iBAAhB,CAAkC3F,KAAKK,UAAvC,EACN,EAACuF,OAAM,EAACC,mBAAmBP,gBAApB,EAAP;AACCQ,aAAK,EAACjE,aAAa7B,KAAKS,QAAL,CAAcoB,WAA5B;AACJ0D,gBAAQvF,KAAKS,QAAL,CAAc8E,MADlB;AAEJC,wBAAgBxF,KAAKS,QAAL,CAAc+E,cAF1B;AAGJC,sBAAczF,KAAKS,QAAL,CAAcgF,YAHxB;AAIJf,0BAAkB1E,KAAKS,QAAL,CAAciE,gBAJ5B;AAKJgB,oBAAY1F,KAAKS,QAAL,CAAciF;AALtB,QADN,EADM,EASL,EAACK,KAAM,IAAP,EATK,EAULvF,IAVK,CAUA,gCAAwB;AAC7B,cAAOwF,oBAAP;AACA,OAZK,EAYHtF,KAZG,CAYG,iBAAQ;AAChB,WAAIC,KAAJ,EAAW;AACV,cAAM,IAAIC,KAAJ,CAAUD,KAAV,CAAN;AACA;AACD,OAhBK,CAAP;AAiBA,MA5BD,MA4BO;AACN,YAAM,IAAIC,KAAJ,CAAU,oEACf,uDADK,CAAN;AAEA;AACD,KAjCD,MAiCM;AACL,WAAM,IAAIA,KAAJ,CAAU,sDAAV,CAAN;AACA;AACD,IAtCK,EAuCLF,KAvCK,CAuCC,iBAAS;AACf,QAAIC,KAAJ,EAAW;AACV,WAAM,IAAIC,KAAJ,CAAUD,KAAV,CAAN;AACA;AACD,IA3CK,CAAP;AA6CA,GA5EQ;AA6ETsF,oBAAkB,0BAAClG,MAAD,EAASC,IAAT,UAA4B;AAAA,OAAZC,MAAY,UAAZA,MAAY;;AAC7C,UAAOA,OAAOiE,IAAP,CAAY/D,OAAZ,CAAoB,EAAC+F,QAAQlG,KAAKmG,aAAd,EAApB,EAAiD,KAAjD,EACL3F,IADK,CACA,qBAAa;AAClB,WAAOP,OAAOC,QAAP,CAAgBC,OAAhB,CAAwB,EAACC,KAAKJ,KAAKK,UAAX,EAAuBmD,YAAYD,SAAnC,EAAxB,EACL/C,IADK,CACA,6BAAqB;AAC1B,SAAI4F,kBAAkBxC,MAAlB,KAA6B,UAA7B,IAA2CwC,kBAAkBxC,MAAlB,KAA6B,WAA5E,EAAyF;AACxF,aAAO3D,OAAOC,QAAP,CAAgByF,iBAAhB,CAAkC3F,KAAKK,UAAvC,EAAmD,EAACyF,MAAK,EAACxF,gBAAgB,KAAjB,EAAN,EAAnD,EAAkF,EAACyF,KAAK,IAAN,EAAlF,EACLvF,IADK,CACA,6BAAqB;AAC1B,cAAO4F,iBAAP;AACA,OAHK,EAGH1F,KAHG,CAGG,iBAAS;AACjB,WAAIC,KAAJ,EAAW;AACV,cAAM,IAAIC,KAAJ,CAAUD,KAAV,CAAN;AACA;AACD,OAPK,CAAP;AAQA,MATD,MASO;AACN,YAAM,IAAIC,KAAJ,CAAU,kEAAV,CAAN;AACA;AAED,KAfK,EAeHF,KAfG,CAeG,iBAAS;AACjB,SAAIC,KAAJ,EAAW;AACV,YAAM,IAAIC,KAAJ,CAAUD,KAAV,CAAN;AACA;AACD,KAnBK,CAAP;AAqBA,IAvBK,EAuBHD,KAvBG,CAuBG,iBAAS;AACjB,QAAIC,KAAJ,EAAW;AACV,WAAM,IAAIC,KAAJ,CAAUD,KAAV,CAAN;AACA;AAED,IA5BK,CAAP;AA8BA,GA5GQ;AA6GT0F,4BAA0B,kCAACtG,MAAD,EAASC,IAAT,UAA4B;AAAA,OAAZC,MAAY,UAAZA,MAAY;;AACrD,UAAOA,OAAOC,QAAP,CAAgBC,OAAhB,CAAwB,EAAC,OAAOH,KAAKK,UAAb;AAC9B,6BAAyBL,KAAKsG,kBADA,EAAxB,EAC6C,EAAC,uBAAsB,CAAvB,EAAyB,UAAS,CAAlC,EAD7C,EAEL/F,QAFK,CAEI,YAFJ,EAGLC,IAHK,CAGA,4BAAoB;AACzB,QAAI8E,iBAAiB9B,UAAjB,CAA4B0C,MAA5B,KAAuClG,KAAKuG,aAAhD,EAA8D;AAC7D,SAAKjB,iBAAiB1B,MAAjB,KAA4B,UAA5B,IAA0C0B,iBAAiBO,iBAAjB,CAAmC,CAAnC,EAAsCjC,MAAtC,KAAiD,SAA5F,IACE0B,iBAAiB1B,MAAjB,KAA4B,UAA5B,IAA0C0B,iBAAiBO,iBAAjB,CAAmC,CAAnC,EAAsCjC,MAAtC,KAAiD,UAD7F,IAEC0B,iBAAiB1B,MAAjB,KAA4B,SAA5B,IAAyC0B,iBAAiBO,iBAAjB,CAAmC,CAAnC,EAAsCjC,MAAtC,KAAiD,UAF/F,EAE4G;AAC3G,aAAO3D,OAAOC,QAAP,CAAgByF,iBAAhB,CAAkC3F,KAAKK,UAAvC,EAAkD;AACxDyF,aAAM,EAACjE,aAAayD,iBAAiBO,iBAAjB,CAAmC,CAAnC,EAAsChE,WAApD;AACL0D,gBAAQD,iBAAiBO,iBAAjB,CAAmC,CAAnC,EAAsCN,MADzC;AAEL3B,gBAAQ0B,iBAAiBO,iBAAjB,CAAmC,CAAnC,EAAsCjC,MAFzC;AAGL4B,wBAAgBF,iBAAiBO,iBAAjB,CAAmC,CAAnC,EAAsCL,cAHjD;AAILC,sBAAcH,iBAAiBO,iBAAjB,CAAmC,CAAnC,EAAsCJ,YAJ/C;AAKLf,0BAAkBY,iBAAiBO,iBAAjB,CAAmC,CAAnC,EAAsCnB,gBALnD;AAMLgB,oBAAYJ,iBAAiBO,iBAAjB,CAAmC,CAAnC,EAAsCH,UAN7C;AADkD,OAAlD,EAQL,EAACK,KAAK,IAAN,EARK,EAQQvF,IARR,CAQa,oBAAY;AAC/B,cAAOC,QAAP;AAEA,OAXM,EAWJC,KAXI,CAWE,iBAAS;AACjB,WAAIC,KAAJ,EAAW;AACV,cAAM,IAAIC,KAAJ,CAAUD,KAAV,CAAN;AACA;AACD,OAfM,CAAP;AAiBA,MApBD,MAoBO;AACN,YAAM,IAAIC,KAAJ,CAAU,wDAAV,CAAN;AACA;AACD,KAxBD,MAwBO;AACN,WAAM,IAAIA,KAAJ,CAAU,uEAAV,CAAN;AACA;AAED,IAhCK,EAgCHF,KAhCG,CAgCG,iBAAS;AACjB,QAAIC,KAAJ,EAAW;AACV,WAAM,IAAIC,KAAJ,CAAUD,KAAV,CAAN;AACA;AACD,IApCK,CAAP;AAqCA,GAnJQ;AAoJT6F,+BAA6B,qCAACzG,MAAD,EAASC,IAAT,UAA4B;AAAA,OAAZC,MAAY,UAAZA,MAAY;;AACxD,UAAOA,OAAOC,QAAP,CAAgBC,OAAhB,CAAwB,EAAC,OAAOH,KAAKK,UAAb;AAC9B,6BAAyBL,KAAKsG,kBADA,EAAxB,EAC6C,EAAC,uBAAsB,CAAvB,EAAyB,UAAS,CAAlC,EAD7C,EAEL/F,QAFK,CAEI,YAFJ,EAGLC,IAHK,CAGA,4BAAoB;AACzB,QAAI8E,iBAAiB9B,UAAjB,CAA4B0C,MAA5B,KAAuClG,KAAKuG,aAAhD,EAA8D;AAC7D,SAAKjB,iBAAiB1B,MAAjB,KAA4B,UAA5B,IAA0C0B,iBAAiBO,iBAAjB,CAAmC,CAAnC,EAAsCjC,MAAtC,KAAiD,SAA5F,IACC0B,iBAAiB1B,MAAjB,KAA4B,UAA5B,IAA0C0B,iBAAiBO,iBAAjB,CAAmC,CAAnC,EAAsCjC,MAAtC,KAAiD,UAD5F,IAEC0B,iBAAiB1B,MAAjB,KAA4B,SAA5B,IAAyC0B,iBAAiBO,iBAAjB,CAAmC,CAAnC,EAAsCjC,MAAtC,KAAiD,UAF/F,EAE4G;AAC3G,aAAO3D,OAAOC,QAAP,CAAgByF,iBAAhB,CAAkC3F,KAAKK,UAAvC,EAAkD;AACxDyF,aAAM,EAACjE,aAAayD,iBAAiBO,iBAAjB,CAAmC,CAAnC,EAAsChE,WAApD;AADkD,OAAlD,EAEL,EAACkE,KAAK,IAAN,EAFK,EAEQvF,IAFR,CAEa,oBAAY;AAC/B,cAAOC,QAAP;AAEA,OALM,EAKJC,KALI,CAKE,iBAAS;AACjB,WAAIC,KAAJ,EAAW;AACV,cAAM,IAAIC,KAAJ,CAAUD,KAAV,CAAN;AACA;AACD,OATM,CAAP;AAWA,MAdD,MAcO;AACN,YAAM,IAAIC,KAAJ,CAAU,wDAAV,CAAN;AACA;AACD,KAlBD,MAkBO;AACN,WAAM,IAAIA,KAAJ,CAAU,uEAAV,CAAN;AACA;AAED,IA1BK,EA0BHF,KA1BG,CA0BG,iBAAS;AACjB,QAAIC,KAAJ,EAAW;AACV,WAAM,IAAIC,KAAJ,CAAUD,KAAV,CAAN;AACA;AACD,IA9BK,CAAP;AAgCA,GArLQ;AAsLT8F,8BAA4B,oCAAC1G,MAAD,EAASC,IAAT,UAA4B;AAAA,OAAZC,MAAY,UAAZA,MAAY;;AACvD,UAAOA,OAAOC,QAAP,CAAgBC,OAAhB,CAAwB,EAAC,OAAOH,KAAKK,UAAb;AAC9B,6BAAyBL,KAAKsG,kBADA,EAAxB,EAC6C,EAAC,uBAAsB,CAAvB,EAAyB,UAAS,CAAlC,EAD7C,EAEL/F,QAFK,CAEI,YAFJ,EAGLC,IAHK,CAGA,4BAAoB;AACzB,QAAI8E,iBAAiB9B,UAAjB,CAA4B0C,MAA5B,KAAuClG,KAAKuG,aAAhD,EAA8D;AAC7D,SAAKjB,iBAAiB1B,MAAjB,KAA4B,UAA5B,IAA0C0B,iBAAiBO,iBAAjB,CAAmC,CAAnC,EAAsCjC,MAAtC,KAAiD,SAA5F,IACC0B,iBAAiB1B,MAAjB,KAA4B,UAA5B,IAA0C0B,iBAAiBO,iBAAjB,CAAmC,CAAnC,EAAsCjC,MAAtC,KAAiD,UAD5F,IAEC0B,iBAAiB1B,MAAjB,KAA4B,SAA5B,IAAyC0B,iBAAiBO,iBAAjB,CAAmC,CAAnC,EAAsCjC,MAAtC,KAAiD,UAF/F,EAE4G;AAC3G,aAAO3D,OAAOC,QAAP,CAAgByF,iBAAhB,CAAkC3F,KAAKK,UAAvC,EAAkD;AACxDyF,aAAM,EAACJ,YAAYJ,iBAAiBO,iBAAjB,CAAmC,CAAnC,EAAsCH,UAAnD;AADkD,OAAlD,EAEL,EAACK,KAAK,IAAN,EAFK,EAEQvF,IAFR,CAEa,oBAAY;AAC/B,cAAOC,QAAP;AAEA,OALM,EAKJC,KALI,CAKE,iBAAS;AACjB,WAAIC,KAAJ,EAAW;AACV,cAAM,IAAIC,KAAJ,CAAUD,KAAV,CAAN;AACA;AACD,OATM,CAAP;AAWA,MAdD,MAcO;AACN,YAAM,IAAIC,KAAJ,CAAU,wDAAV,CAAN;AACA;AACD,KAlBD,MAkBO;AACN,WAAM,IAAIA,KAAJ,CAAU,uEAAV,CAAN;AACA;AAED,IA1BK,EA0BHF,KA1BG,CA0BG,iBAAS;AACjB,QAAIC,KAAJ,EAAW;AACV,WAAM,IAAIC,KAAJ,CAAUD,KAAV,CAAN;AACA;AACD,IA9BK,CAAP;AAgCA,GAvNQ;AAwNT+F,0BAAwB,gCAAC3G,MAAD,EAASC,IAAT,UAA4B;AAAA,OAAZC,MAAY,UAAZA,MAAY;;AACnD,UAAOA,OAAOC,QAAP,CAAgBC,OAAhB,CAAwB,EAAC,OAAOH,KAAKK,UAAb;AAC9B,6BAAyBL,KAAKsG,kBADA,EAAxB,EAC6C,EAAC,uBAAsB,CAAvB,EAAyB,UAAS,CAAlC,EAD7C,EAEL/F,QAFK,CAEI,YAFJ,EAGLC,IAHK,CAGA,4BAAoB;AACzB,QAAI8E,iBAAiB9B,UAAjB,CAA4B0C,MAA5B,KAAuClG,KAAKuG,aAAhD,EAA8D;AAC7D,SAAKjB,iBAAiB1B,MAAjB,KAA4B,UAA5B,IAA0C0B,iBAAiBO,iBAAjB,CAAmC,CAAnC,EAAsCjC,MAAtC,KAAiD,SAA5F,IACC0B,iBAAiB1B,MAAjB,KAA4B,UAA5B,IAA0C0B,iBAAiBO,iBAAjB,CAAmC,CAAnC,EAAsCjC,MAAtC,KAAiD,UAD5F,IAEC0B,iBAAiB1B,MAAjB,KAA4B,SAA5B,IAAyC0B,iBAAiBO,iBAAjB,CAAmC,CAAnC,EAAsCjC,MAAtC,KAAiD,UAF/F,EAE4G;AAC3G,aAAO3D,OAAOC,QAAP,CAAgByF,iBAAhB,CAAkC3F,KAAKK,UAAvC,EAAkD;AACxDyF,aAAM,EAACP,QAAQD,iBAAiBO,iBAAjB,CAAmC,CAAnC,EAAsCN,MAA/C;AADkD,OAAlD,EAEL,EAACQ,KAAK,IAAN,EAFK,EAEQvF,IAFR,CAEa,oBAAY;AAC/B,cAAOC,QAAP;AAEA,OALM,EAKJC,KALI,CAKE,iBAAS;AACjB,WAAIC,KAAJ,EAAW;AACV,cAAM,IAAIC,KAAJ,CAAUD,KAAV,CAAN;AACA;AACD,OATM,CAAP;AAWA,MAdD,MAcO;AACN,YAAM,IAAIC,KAAJ,CAAU,wDAAV,CAAN;AACA;AACD,KAlBD,MAkBO;AACN,WAAM,IAAIA,KAAJ,CAAU,uEAAV,CAAN;AACA;AAED,IA1BK,EA0BHF,KA1BG,CA0BG,iBAAS;AACjB,QAAIC,KAAJ,EAAW;AACV,WAAM,IAAIC,KAAJ,CAAUD,KAAV,CAAN;AACA;AACD,IA9BK,CAAP;AAgCA,GAzPQ;AA0PTgG,kCAAgC,wCAAC5G,MAAD,EAASC,IAAT,UAA4B;AAAA,OAAZC,MAAY,UAAZA,MAAY;;AAC3D,UAAOA,OAAOiE,IAAP,CAAYmB,QAAZ,CAAqBrF,KAAKuD,SAA1B,EACL/C,IADK,CACA,2BAAmB;AACxB,QAAGoG,gBAAgBC,KAAhB,CAAsB,CAAtB,EAAyBC,GAAzB,KAAiC,QAApC,EAA6C;AAC5C,YAAO,IAAIxF,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAmB;AACrC,sBAAMuF,UAAN,CAAiB/G,KAAKgH,cAAtB,EAAsC,UAACC,IAAD,EAAOC,IAAP,EAAc;AACnD,cAAOjH,OAAOC,QAAP,CAAgBmF,QAAhB,CAAyB4B,IAAzB,EACL1G,QADK,CACI,YADJ,EAELA,QAFK,CAEI,kBAFJ,EAGLC,IAHK,CAGA,4BAAoB;AACzB,YAAG2G,iBAAiB3D,UAAjB,CAA4BpD,GAA5B,IAAmCJ,KAAKuD,SAA3C,EAAqD;AACpD/B,gBAAO,cAAc2F,iBAAiB3D,UAAjB,CAA4B4D,MAA1C,GAAmD,kBAAnD,GACN,4BADM,GACyBD,iBAAiBtF,WAD1C,GACwD,WADxD,GAEN,oDAFD;AAGA,SAJD,MAIM,IAAGsF,iBAAiBE,iBAAjB,CAAmC7E,MAAnC,IACR2E,iBAAiBE,iBAAjB,CAAmCC,OAAnC,IAA8CtH,KAAKuD,SAD9C,EACwD;AAC7D/B,gBAAO,sEACN,qBADD;AAEA,SAJK,MAKD;AACJ,gBAAOvB,OAAOC,QAAP,CAAgByF,iBAAhB,CAAkCsB,IAAlC,EAAuC;AAC7CrB,iBAAO,EAACyB,mBAAkB,EAACC,SAAQtH,KAAKuD,SAAd;AACzBgE,6BAAiB,SADQ;AAEzBC,yBAAa,oEAFY;AAGzBC,8BAAkB,IAAIC,IAAJ,EAHO,EAAnB;AADsC,UAAvC,EAKL,EAAC3B,KAAK,IAAN,EALK,EAKQvF,IALR,CAKa,+BAAuB;AAC1C,cAAImH,mBAAJ,EAAwB;AACvBT;AACA;AACD,UATM,CAAP;AAUA;AAED,QA1BK,EA0BHxG,KA1BG,CA0BG,iBAAS;AACjB,YAAIC,KAAJ,EAAU;AACTa,gBAAOb,KAAP;AACA;AACD,QA9BK,CAAP;AAgCA,OAjCD,EAiCE,UAACA,KAAD,EAAS;AACV,WAAIA,KAAJ,EAAU;AACTa,eAAOb,KAAP;AACA;AACDY,eAAQ,IAAR;AACA,OAtCD;AAwCA,MAzCM,CAAP;AA6CA,KA9CD,MA8CK;AACJ,WAAM,IAAIX,KAAJ,CAAU,yEAAV,CAAN;AACA;AACD,IAnDK,EAmDHF,KAnDG,CAmDG,iBAAS;AACjB,UAAM,IAAIE,KAAJ,CAAUD,KAAV,CAAN;AAEA,IAtDK,CAAP;AAuDA,GAlTQ;AAmTTiH,yBAAuB,+BAAC7H,MAAD,EAASC,IAAT,UAA4B;AAAA,OAAZC,MAAY,UAAZA,MAAY;;AAClD,UAAOA,OAAOC,QAAP,CAAgBmF,QAAhB,CAAyBrF,KAAKK,UAA9B,EACLG,IADK,CACA,4BAAoB;AACzB,QAAI2G,iBAAiB3D,UAAjB,IAA+BxD,KAAKuD,SAAxC,EAAkD;AACjD,WAAM,IAAI3C,KAAJ,CAAU,uCACf,4BADK,CAAN;AAEA,KAHD,MAGM,IAAGuG,iBAAiBE,iBAAjB,CAAmC,CAAnC,EAAsCC,OAAtC,IAAiDtH,KAAKuD,SAAzD,EAAmE;AACxE,YAAOtD,OAAOC,QAAP,CAAgB2H,gBAAhB,CAAiC,EAACzH,KAAIJ,KAAKK,UAAV,EAAqB,6BAA6BL,KAAKuD,SAAvD,EAAjC,EAAmG;AACzGuC,YAAK,EAAC,UAAU9F,KAAK4D,MAAhB,EAAuB,uCAAsC5D,KAAK4D,MAAlE;AACJ,0CAAkC5D,KAAKwH,WADnC;AADoG,MAAnG,EAGL,EAACzB,KAAK,IAAN,EAHK,EAGQvF,IAHR,CAGa,+BAAuB;AAC1C,aAAOmH,mBAAP;AACA,MALM,EAKJjH,KALI,CAKE,2BAAmB;AAC3B,YAAM,IAAIE,KAAJ,CAAUkH,eAAV,CAAN;AACA,MAPM,CAAP;AAQA,KATK,MASD;AACJ,WAAM,IAAIlH,KAAJ,CAAU,oEACf,2BADK,CAAN;AAEA;AAED,IAnBK,EAmBHF,KAnBG,CAmBG,iBAAS;AACjB,QAAIC,KAAJ,EAAU;AACT,WAAM,IAAIC,KAAJ,CAAUD,KAAV,CAAN;AACA;AACD,IAvBK,CAAP;AAwBA,GA5UQ;AA6UToH,8CAA4C,oDAAChI,MAAD,EAASC,IAAT,UAA0B;AAAA,OAAVC,MAAU,UAAVA,MAAU;;AACrE,UAAOA,OAAOiE,IAAP,CAAYmB,QAAZ,CAAqBrF,KAAKgI,kBAA1B,EACLxH,IADK,CACA,mBAAW;AAChB,QAAG8G,QAAQT,KAAR,CAAc,CAAd,EAAiBC,GAAjB,KAAyB,QAA5B,EAAqC;AACpC,YAAO7G,OAAOC,QAAP,CAAgB+H,MAAhB,CAAuB,EAAC,6BAA6BjI,KAAKkI,eAAnC,EAAvB,EAA2E;AACjFpC,YAAK,EAAC,+BAA8B9F,KAAKgI,kBAApC;AAD4E,MAA3E,EAEL,EAACG,OAAM,IAAP,EAAYpC,KAAI,IAAhB,EAFK,EAEkBvF,IAFlB,CAEuB,uBAAe;AAC5C,UAAG4H,YAAYC,CAAZ,GAAe,CAAlB,EAAoB;AACnB,cAAO,IAAP;AACA,OAFD,MAEK;AACJ,cAAO,KAAP;AACA;AACD,MARM,EAQJ3H,KARI,CAQE,iBAAQ;AAChB,UAAGC,KAAH,EAAS;AACR,aAAM,IAAIC,KAAJ,CAAUD,KAAV,CAAN;AACA;AACD,MAZM,CAAP;AAcA,KAfD,MAeK;AACJ,WAAM,IAAIC,KAAJ,CAAU,iDAAV,CAAN;AACA;AAED,IArBK,EAqBHF,KArBG,CAqBG,iBAAS;AACjB,QAAIC,KAAJ,EAAU;AACT,WAAM,IAAIC,KAAJ,CAAUD,KAAV,CAAN;AACA;AACD,IAzBK,CAAP;AA0BA;AAxWQ;AAjVI,C,EAHf","file":"pregunta.js","sourcesContent":["/* eslint-disable no-unused-vars */\nimport async from \"async\";\n\nexport default {\n\tQuery: {\n\t\tverMyPreguntaActual: (parent, args, {models}) => {\n\t\t\treturn models.Pregunta.findOne({_id: args.idPregunta,\n\t\t\t\tregistroActual: true })\n\t\t\t\t.populate(\"usuario_ID\")\n\t\t\t\t.populate(\"estados_asignados.usuario\")\n\t\t\t\t.populate(\"areaconocimiento\")\n\t\t\t\t.populate(\"discusiones\")\n\t\t\t\t.then(pregunta => {\n\t\t\t\t\treturn pregunta;\n\t\t\t\t}).catch(error=> {\n\t\t\t\t\tif (error){\n\t\t\t\t\t\tthrow new Error(error);\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t},\n\t\tlistadoPreguntasActuales : (parent, args, {models}) => {\n\t\t\tlet edgePreguntaArray = [];\n\t\t\tlet cursor = parseInt(Buffer.from(args.after, \"base64\").toString(\"ascii\"));\n\t\t\tif (!cursor){\n\t\t\t\tcursor = 0;\n\t\t\t}\n\t\t\tlet edgePreguntaInfoPromise = new Promise((resolve, reject)=> {\n\t\t\t\tlet edges = models.Pregunta.find({identificador:{$gt:cursor},registroActual: true,\n\t\t\t\t\tdescripcion: new RegExp(args.word, \"i\")}, (err, result) => {\n\t\t\t\t\tif(err){\n\t\t\t\t\t\treject(err);\n\t\t\t\t\t}\n\t\t\t\t}).populate(\"usuario_ID\")\n\t\t\t\t\t.populate(\"estados_asignados.usuario\")\n\t\t\t\t\t.populate(\"areaconocimiento\")\n\t\t\t\t\t.populate(\"discusiones\")\n\t\t\t\t\t.limit(args.limit).cursor();\n\n\t\t\t\tedges.on(\"data\", res => {\n\t\t\t\t\tedgePreguntaArray.push({\n\t\t\t\t\t\tcursor : Buffer.from((res.identificador).toString()).toString(\"base64\"),\n\t\t\t\t\t\tnode: res\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t\tedges.on(\"end\",()=> {\n\t\t\t\t\tlet endCursor = edgePreguntaArray.length > 0 ? edgePreguntaArray[edgePreguntaArray.length - 1].cursor:NaN;\n\t\t\t\t\tlet hasNextPage = new Promise((resolve, reject)=> {\n\t\t\t\t\t\tif (endCursor) {\n\t\t\t\t\t\t\tlet cursorFinal = parseInt(Buffer.from(endCursor,\"base64\").toString(\"ascii\"));\n\t\t\t\t\t\t\tmodels.Pregunta.where(\"identificador\").gt(cursorFinal).count({registroActual:true},(err, count)=> {\n\t\t\t\t\t\t\t\tif (err) {\n\t\t\t\t\t\t\t\t\treject(err);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tcount > 0 ? resolve(true): resolve(false);\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tresolve(false);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\tresolve({\n\t\t\t\t\t\tedges: edgePreguntaArray,\n\t\t\t\t\t\tpageInfo: {\n\t\t\t\t\t\t\tendCursor: endCursor,\n\t\t\t\t\t\t\thasnextPage: hasNextPage\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t});\n\t\t\tlet totalPagesPromise = new Promise((resolve, reject) => {\n\t\t\t\tmodels.Pregunta.count({registroActual:true},(err, count) => {\n\t\t\t\t\tif (err) {\n\t\t\t\t\t\treject(err);\n\t\t\t\t\t}else {\n\t\t\t\t\t\tresolve(count);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\t\t\tlet listPaginatePregunta = Promise.all([edgePreguntaInfoPromise, totalPagesPromise]).then((values) => {\n\t\t\t\treturn {\n\t\t\t\t\tedges: values[0].edges,\n\t\t\t\t\ttotalCount: values[1],\n\t\t\t\t\tpageInfo:{\n\t\t\t\t\t\tendCursor: values[0].pageInfo.endCursor,\n\t\t\t\t\t\thasnextPage:values[0].pageInfo.hasnextPage\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t});\n\t\t\treturn listPaginatePregunta;\n\t\t},\n\t\tverListadoMisPreguntasActuales: (parent, args, {models})=> {\n\t\t\tif (args.idUsuario) {\n\t\t\t\treturn models.Pregunta.find({usuario_ID: args.idUsuario, registroActual: true})\n\t\t\t\t\t.populate(\"usuario_ID\")\n\t\t\t\t\t.populate(\"estados_asignados.usuario\")\n\t\t\t\t\t.populate(\"areaconocimiento\")\n\t\t\t\t\t.populate(\"discusiones\")\n\t\t\t\t\t.sort({\"fecha_creacion\":-1})\n\t\t\t\t\t.then(listadoMisPreguntas => {\n\t\t\t\t\t\treturn listadoMisPreguntas;\n\t\t\t\t\t})\n\t\t\t\t\t.catch(error => {\n\t\t\t\t\t\tif (error) {\n\t\t\t\t\t\t\tthrow new Error(error);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tthrow new Error(\"It neccessary to ID of a usuario, para retrieve the information\");\n\t\t\t}\n\n\t\t},\n\t\tverListadoMisPreguntasActualesByEstado: (parent, args, {models})=> {\n\t\t\tlet estado;\n\t\t\tif (args.idUsuario){\n\t\t\t\tif (!args.estado){\n\t\t\t\t\testado = \"revision\";\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\testado = args.estado;\n\t\t\t\t}\n\t\t\t\treturn models.Pregunta.find({usuario_ID: args.idUsuario, registroActual: true, estado: estado})\n\t\t\t\t\t.populate(\"usuario_ID\")\n\t\t\t\t\t.populate(\"estados_asignados.usuario\")\n\t\t\t\t\t.populate(\"areaconocimiento\")\n\t\t\t\t\t.populate(\"discusiones\")\n\t\t\t\t\t.sort({\"fecha_creacion\":-1})\n\t\t\t\t\t.then(listadoPreguntas => {\n\t\t\t\t\t\treturn listadoPreguntas;\n\t\t\t\t\t}).catch(error => {\n\t\t\t\t\t\tif (error){\n\t\t\t\t\t\t\tthrow new Error(error);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tthrow new Error(\"It neccessary to ID of a usuario, para retrieve the information\");\n\t\t\t}\n\n\t\t},\n\t\tlistadoPreguntasActualesByEstado: (parent, args, {models}) => {\n\t\t\tlet edgePreguntaArray = [];\n\t\t\tlet cursor = parseInt(Buffer.from(args.after, \"base64\").toString(\"ascii\"));\n\t\t\tif (!cursor){\n\t\t\t\tcursor = 0;\n\t\t\t}\n\t\t\tlet edgePreguntaInfoPromise = new Promise((resolve, reject)=> {\n\t\t\t\tlet edges = models.Pregunta.find({identificador:{$gt:cursor},registroActual: true,\n\t\t\t\t\tdescripcion: new RegExp(args.word, \"i\"),estado: args.estado}, (err, result) => {\n\t\t\t\t\tif(err){\n\t\t\t\t\t\treject(err);\n\t\t\t\t\t}\n\t\t\t\t}).populate(\"usuario_ID\")\n\t\t\t\t\t.populate(\"estados_asignados.usuario\")\n\t\t\t\t\t.populate(\"areaconocimiento\")\n\t\t\t\t\t.populate(\"discusiones\")\n\t\t\t\t\t.limit(args.limit).cursor();\n\n\t\t\t\tedges.on(\"data\", res => {\n\t\t\t\t\tedgePreguntaArray.push({\n\t\t\t\t\t\tcursor : Buffer.from((res.identificador).toString()).toString(\"base64\"),\n\t\t\t\t\t\tnode: res\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t\tedges.on(\"end\",()=> {\n\t\t\t\t\tlet endCursor = edgePreguntaArray.length > 0 ? edgePreguntaArray[edgePreguntaArray.length - 1].cursor:NaN;\n\t\t\t\t\tlet hasNextPage = new Promise((resolve, reject)=> {\n\t\t\t\t\t\tif (endCursor) {\n\t\t\t\t\t\t\tlet cursorFinal = parseInt(Buffer.from(endCursor,\"base64\").toString(\"ascii\"));\n\t\t\t\t\t\t\tmodels.Pregunta.where(\"identificador\").gt(cursorFinal).count({registroActual:true},(err, count)=> {\n\t\t\t\t\t\t\t\tif (err) {\n\t\t\t\t\t\t\t\t\treject(err);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tcount > 0 ? resolve(true): resolve(false);\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tresolve(false);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\tresolve({\n\t\t\t\t\t\tedges: edgePreguntaArray,\n\t\t\t\t\t\tpageInfo: {\n\t\t\t\t\t\t\tendCursor: endCursor,\n\t\t\t\t\t\t\thasnextPage: hasNextPage\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t});\n\t\t\tlet totalPagesPromise = new Promise((resolve, reject) => {\n\t\t\t\tmodels.Pregunta.count((err, count) => {\n\t\t\t\t\tif (err) {\n\t\t\t\t\t\treject(err);\n\t\t\t\t\t}else {\n\t\t\t\t\t\tresolve(count);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\t\t\tlet listPaginatePregunta = Promise.all([edgePreguntaInfoPromise, totalPagesPromise]).then((values) => {\n\t\t\t\treturn {\n\t\t\t\t\tedges: values[0].edges,\n\t\t\t\t\ttotalCount: values[1],\n\t\t\t\t\tpageInfo:{\n\t\t\t\t\t\tendCursor: values[0].pageInfo.endCursor,\n\t\t\t\t\t\thasnextPage:values[0].pageInfo.hasnextPage\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t});\n\t\t\treturn listPaginatePregunta;\n\t\t},\n\t\thistorialImagenesUsadasByUserinAPregunta: (parent, args, {models}) => {\n\t\t\treturn models.Pregunta.findOne({_id: args.idPregunta, usuario_ID: args.idUsuario},\"historial_cambios estado\")\n\t\t\t\t.then(pregunta => {\n\t\t\t\t\tif (pregunta.estado === \"revision\" || pregunta.estado === \"estable\"){\n\t\t\t\t\t\treturn pregunta;\n\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthrow new Error(\"you can to access to list Images of a closed(reject) question\");\n\t\t\t\t\t}\n\n\t\t\t\t}).catch(error => {\n\t\t\t\t\tif (error){\n\t\t\t\t\t\tthrow new Error(error);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t},\n\t\tlistadoUsuariosDistintosCreadoPreguntas: (parent, args, {models}) => {\n\t\t\treturn models.Pregunta.distinct(\"usuario_ID\")\n\t\t\t\t.then(listaUsuariosDistintos => {\n\t\t\t\t\treturn models.User.find({\"_id\":{$in:listaUsuariosDistintos}})\n\t\t\t\t\t\t.then(listaUsuarios => {\n\t\t\t\t\t\t\treturn listaUsuarios;\n\t\t\t\t\t\t}).catch(error => {\n\t\t\t\t\t\t\tif (error){\n\t\t\t\t\t\t\t\tthrow new Error(error);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t}).catch(error => {\n\t\t\t\t\tif (error){\n\t\t\t\t\t\tthrow new Error(error);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t},\n\t\tlistadoAreasConocimientosUsadasPreguntas: (parent, args, {models}) => {\n\t\t\treturn models.areasConocimiento.distinct(\"titulo\")\n\t\t\t\t.then(listaAreasConocimientosUsadas=>{\n\t\t\t\t\treturn listaAreasConocimientosUsadas;\n\t\t\t\t}).catch(error => {\n\t\t\t\t\tif (error){\n\t\t\t\t\t\tthrow new Error(error);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t},\n\t\tcargarListadoPreguntasByAreasConocimiento: (parent, args, {models})=>{\n\t\t\tlet edgePreguntaArray = [];\n\t\t\tlet cursor = parseInt(Buffer.from(args.after, \"base64\").toString(\"ascii\"));\n\t\t\tif (!cursor){\n\t\t\t\tcursor = 0;\n\t\t\t}\n\t\t\tlet edgePreguntaInfoPromise = new Promise((resolve, reject)=> {\n\t\t\t\tlet edges = models.Pregunta.find({identificador:{$gt:cursor},registroActual: true,\n\t\t\t\t\tdescripcion: new RegExp(args.word, \"i\"),areaconocimiento: args.idAreaConocimiento}, (err, result) => {\n\t\t\t\t\tif(err){\n\t\t\t\t\t\treject(err);\n\t\t\t\t\t}\n\t\t\t\t}).populate(\"usuario_ID\")\n\t\t\t\t\t.populate(\"areaconocimiento\")\n\t\t\t\t\t.populate(\"discusiones\")\n\t\t\t\t\t.limit(args.limit).cursor();\n\n\t\t\t\tedges.on(\"data\", res => {\n\t\t\t\t\tedgePreguntaArray.push({\n\t\t\t\t\t\tcursor : Buffer.from((res.identificador).toString()).toString(\"base64\"),\n\t\t\t\t\t\tnode: res\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t\tedges.on(\"end\",()=> {\n\t\t\t\t\tlet endCursor = edgePreguntaArray.length > 0 ? edgePreguntaArray[edgePreguntaArray.length - 1].cursor:NaN;\n\t\t\t\t\tlet hasNextPage = new Promise((resolve, reject)=> {\n\t\t\t\t\t\tif (endCursor) {\n\t\t\t\t\t\t\tlet cursorFinal = parseInt(Buffer.from(endCursor,\"base64\").toString(\"ascii\"));\n\t\t\t\t\t\t\tmodels.Pregunta.where(\"identificador\").gt(cursorFinal).count({registroActual:true,\n\t\t\t\t\t\t\t\tareaconocimiento: args.idAreaConocimiento},(err, count)=> {\n\t\t\t\t\t\t\t\tif (err) {\n\t\t\t\t\t\t\t\t\treject(err);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tcount > 0 ? resolve(true): resolve(false);\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tresolve(false);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\tresolve({\n\t\t\t\t\t\tedges: edgePreguntaArray,\n\t\t\t\t\t\tpageInfo: {\n\t\t\t\t\t\t\tendCursor: endCursor,\n\t\t\t\t\t\t\thasnextPage: hasNextPage\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t});\n\t\t\tlet totalPagesPromise = new Promise((resolve, reject) => {\n\t\t\t\tmodels.Pregunta.count({areaconocimiento: args.idAreaConocimiento,registroActual:true},(err, count) => {\n\t\t\t\t\tif (err) {\n\t\t\t\t\t\treject(err);\n\t\t\t\t\t}else {\n\t\t\t\t\t\tresolve(count);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\t\t\tlet listPaginatePregunta = Promise.all([edgePreguntaInfoPromise, totalPagesPromise]).then((values) => {\n\t\t\t\treturn {\n\t\t\t\t\tedges: values[0].edges,\n\t\t\t\t\ttotalCount: values[1],\n\t\t\t\t\tpageInfo:{\n\t\t\t\t\t\tendCursor: values[0].pageInfo.endCursor,\n\t\t\t\t\t\thasnextPage:values[0].pageInfo.hasnextPage\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t});\n\t\t\treturn listPaginatePregunta;\n\t\t},\n\t\tcargarListaPreguntasAsignadasRevisor: (parent, args, {models})=>{\n\t\t\treturn models.Pregunta.find({\"estados_asignados.usuario\":args.idUsuario, \"registroActual\": true})\n\t\t\t\t.populate(\"usuario_ID\")\n\t\t\t\t.populate(\"areaconocimiento\")\n\t\t\t\t.populate(\"estados_asignados.usuario\")\n\t\t\t\t.populate(\"discusiones\")\n\t\t\t\t.sort({\"fecha_creacion\":-1})\n\t\t\t\t.then(listaPreguntas => {\n\t\t\t\t\treturn listaPreguntas;\n\t\t\t\t}).catch(error => {\n\t\t\t\t\tif (error){\n\t\t\t\t\t\tthrow new Error(error);\n\t\t\t\t\t}\n\t\t\t\t});\n\n\n\t\t}\n\t},\n\tMutation: {\n\t\tcrearPregunta: (parent, args, {models}) => {\n\t\t\tif (args.pregunta.descripcion && args.pregunta.usuario_ID && args.pregunta.areaconocimiento.length > 0) {\n\t\t\t\treturn models.Pregunta.count()\n\t\t\t\t\t.then(existenPreguntasCreadas => {\n\t\t\t\t\t\tif (existenPreguntasCreadas) {\n\t\t\t\t\t\t\targs.pregunta.identificador = existenPreguntasCreadas + 1;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tconst objectNewPregunta = new models.Pregunta(args.pregunta);\n\t\t\t\t\t\treturn objectNewPregunta.save()\n\t\t\t\t\t\t\t.then(documento => {\n\t\t\t\t\t\t\t\treturn documento;\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t.catch(error => {\n\t\t\t\t\t\t\t\tif (error) {\n\t\t\t\t\t\t\t\t\tthrow new Error(error);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t}).catch(error=> {\n\t\t\t\t\t\tif (error){\n\t\t\t\t\t\t\tthrow new Error(error);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t} else {\n\t\t\t\tthrow new Error(\"there is empties fields, is not possible save a new question\");\n\t\t\t}\n\n\t\t},\n\t\teditarPregunta: (parent, args, {models}) => {\n\t\t\treturn models.Pregunta.findById(args.idPregunta)\n\t\t\t\t.then(documento => {\n\t\t\t\t\tif (documento.usuario_ID == args.pregunta.usuario_ID ) {\n\t\t\t\t\t\tif (documento.estado === \"revision\" || documento.estado === \"estable\"){\n\t\t\t\t\t\t\tlet preguntaAnterior = {\n\t\t\t\t\t\t\t\tdescripcion: documento.descripcion,\n\t\t\t\t\t\t\t\timagen: documento.imagen,\n\t\t\t\t\t\t\t\testado: documento.estado,\n\t\t\t\t\t\t\t\tfecha_creacion: documento.fecha_creacion,\n\t\t\t\t\t\t\t\ttipoPregunta: documento.tipoPregunta,\n\t\t\t\t\t\t\t\tareaconocimiento: documento.areaconocimiento,\n\t\t\t\t\t\t\t\trespuestas: documento.respuestas\n\t\t\t\t\t\t\t};\n\n\t\t\t\t\t\t\treturn models.Pregunta.findByIdAndUpdate(args.idPregunta,\n\t\t\t\t\t\t\t\t{$push:{historial_cambios: preguntaAnterior},\n\t\t\t\t\t\t\t\t\t$set:{descripcion: args.pregunta.descripcion,\n\t\t\t\t\t\t\t\t\t\timagen: args.pregunta.imagen,\n\t\t\t\t\t\t\t\t\t\tfecha_creacion: args.pregunta.fecha_creacion,\n\t\t\t\t\t\t\t\t\t\ttipoPregunta: args.pregunta.tipoPregunta,\n\t\t\t\t\t\t\t\t\t\tareaconocimiento: args.pregunta.areaconocimiento,\n\t\t\t\t\t\t\t\t\t\trespuestas: args.pregunta.respuestas\n\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t,{new : true})\n\t\t\t\t\t\t\t\t.then(documentoActualizado => {\n\t\t\t\t\t\t\t\t\treturn documentoActualizado;\n\t\t\t\t\t\t\t\t}).catch(error=> {\n\t\t\t\t\t\t\t\t\tif (error) {\n\t\t\t\t\t\t\t\t\t\tthrow new Error(error);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tthrow new Error(\"this questions is closed!!, because the commite member decided \" +\n\t\t\t\t\t\t\t\t\"reject this question, so you should, create a new one\");\n\t\t\t\t\t\t}\n\t\t\t\t\t}else {\n\t\t\t\t\t\tthrow new Error(\"you are not own this question, so you can not update\");\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\t.catch(error => {\n\t\t\t\t\tif (error) {\n\t\t\t\t\t\tthrow new Error(error);\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t},\n\t\teliminarPregunta: (parent, args, {models}) => {\n\t\t\treturn models.User.findOne({correo: args.correoUsuario},\"_id\")\n\t\t\t\t.then(idUsuario => {\n\t\t\t\t\treturn models.Pregunta.findOne({_id: args.idPregunta, usuario_ID: idUsuario})\n\t\t\t\t\t\t.then(documentoPregunta => {\n\t\t\t\t\t\t\tif (documentoPregunta.estado === \"revision\" || documentoPregunta.estado === \"rechazada\") {\n\t\t\t\t\t\t\t\treturn models.Pregunta.findByIdAndUpdate(args.idPregunta, {$set:{registroActual: false}},{new: true})\n\t\t\t\t\t\t\t\t\t.then(documentoPregunta => {\n\t\t\t\t\t\t\t\t\t\treturn documentoPregunta;\n\t\t\t\t\t\t\t\t\t}).catch(error => {\n\t\t\t\t\t\t\t\t\t\tif (error) {\n\t\t\t\t\t\t\t\t\t\t\tthrow new Error(error);\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tthrow new Error(\"this questions is accepted, is not possible delete this question\");\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t}).catch(error => {\n\t\t\t\t\t\t\tif (error) {\n\t\t\t\t\t\t\t\tthrow new Error(error);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\n\t\t\t\t}).catch(error => {\n\t\t\t\t\tif (error) {\n\t\t\t\t\t\tthrow new Error(error);\n\t\t\t\t\t}\n\n\t\t\t\t});\n\n\t\t},\n\t\trollbackPreguntaAnterior: (parent, args, {models}) => {\n\t\t\treturn models.Pregunta.findOne({\"_id\": args.idPregunta,\n\t\t\t\t\"historial_cambios._id\": args.idPreguntaAnterior },{\"historial_cambios.$\":1,\"estado\":1})\n\t\t\t\t.populate(\"usuario_ID\")\n\t\t\t\t.then(preguntaAnterior => {\n\t\t\t\t\tif (preguntaAnterior.usuario_ID.correo === args.ownerQuestion){\n\t\t\t\t\t\tif ((preguntaAnterior.estado === \"revision\" && preguntaAnterior.historial_cambios[0].estado === \"estable\")\n\t\t\t\t\t\t\t\t|| (preguntaAnterior.estado === \"revision\" && preguntaAnterior.historial_cambios[0].estado === \"revision\")\n\t\t\t\t\t\t\t|| (preguntaAnterior.estado === \"estable\" && preguntaAnterior.historial_cambios[0].estado === \"revision\") ){\n\t\t\t\t\t\t\treturn models.Pregunta.findByIdAndUpdate(args.idPregunta,{\n\t\t\t\t\t\t\t\t$set: {descripcion: preguntaAnterior.historial_cambios[0].descripcion,\n\t\t\t\t\t\t\t\t\timagen: preguntaAnterior.historial_cambios[0].imagen,\n\t\t\t\t\t\t\t\t\testado: preguntaAnterior.historial_cambios[0].estado,\n\t\t\t\t\t\t\t\t\tfecha_creacion: preguntaAnterior.historial_cambios[0].fecha_creacion,\n\t\t\t\t\t\t\t\t\ttipoPregunta: preguntaAnterior.historial_cambios[0].tipoPregunta,\n\t\t\t\t\t\t\t\t\tareaconocimiento: preguntaAnterior.historial_cambios[0].areaconocimiento,\n\t\t\t\t\t\t\t\t\trespuestas: preguntaAnterior.historial_cambios[0].respuestas}\n\t\t\t\t\t\t\t},{new: true}).then(pregunta => {\n\t\t\t\t\t\t\t\treturn pregunta;\n\n\t\t\t\t\t\t\t}).catch(error => {\n\t\t\t\t\t\t\t\tif (error) {\n\t\t\t\t\t\t\t\t\tthrow new Error(error);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tthrow new Error(\"the rule to make rollback this question is not correct\");\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthrow new Error(\"you can't make rollback this question because you are not the owner!!\");\n\t\t\t\t\t}\n\n\t\t\t\t}).catch(error => {\n\t\t\t\t\tif (error) {\n\t\t\t\t\t\tthrow new Error(error);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t},\n\t\trollbackDescripcionPregunta: (parent, args, {models}) => {\n\t\t\treturn models.Pregunta.findOne({\"_id\": args.idPregunta,\n\t\t\t\t\"historial_cambios._id\": args.idPreguntaAnterior },{\"historial_cambios.$\":1,\"estado\":1})\n\t\t\t\t.populate(\"usuario_ID\")\n\t\t\t\t.then(preguntaAnterior => {\n\t\t\t\t\tif (preguntaAnterior.usuario_ID.correo === args.ownerQuestion){\n\t\t\t\t\t\tif ((preguntaAnterior.estado === \"revision\" && preguntaAnterior.historial_cambios[0].estado === \"estable\")\n\t\t\t\t\t\t\t|| (preguntaAnterior.estado === \"revision\" && preguntaAnterior.historial_cambios[0].estado === \"revision\")\n\t\t\t\t\t\t\t|| (preguntaAnterior.estado === \"estable\" && preguntaAnterior.historial_cambios[0].estado === \"revision\") ){\n\t\t\t\t\t\t\treturn models.Pregunta.findByIdAndUpdate(args.idPregunta,{\n\t\t\t\t\t\t\t\t$set: {descripcion: preguntaAnterior.historial_cambios[0].descripcion}\n\t\t\t\t\t\t\t},{new: true}).then(pregunta => {\n\t\t\t\t\t\t\t\treturn pregunta;\n\n\t\t\t\t\t\t\t}).catch(error => {\n\t\t\t\t\t\t\t\tif (error) {\n\t\t\t\t\t\t\t\t\tthrow new Error(error);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tthrow new Error(\"the rule to make rollback this question is not correct\");\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthrow new Error(\"you can't make rollback this question because you are not the owner!!\");\n\t\t\t\t\t}\n\n\t\t\t\t}).catch(error => {\n\t\t\t\t\tif (error) {\n\t\t\t\t\t\tthrow new Error(error);\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t},\n\t\trollbackRespuestasPregunta: (parent, args, {models}) => {\n\t\t\treturn models.Pregunta.findOne({\"_id\": args.idPregunta,\n\t\t\t\t\"historial_cambios._id\": args.idPreguntaAnterior },{\"historial_cambios.$\":1,\"estado\":1})\n\t\t\t\t.populate(\"usuario_ID\")\n\t\t\t\t.then(preguntaAnterior => {\n\t\t\t\t\tif (preguntaAnterior.usuario_ID.correo === args.ownerQuestion){\n\t\t\t\t\t\tif ((preguntaAnterior.estado === \"revision\" && preguntaAnterior.historial_cambios[0].estado === \"estable\")\n\t\t\t\t\t\t\t|| (preguntaAnterior.estado === \"revision\" && preguntaAnterior.historial_cambios[0].estado === \"revision\")\n\t\t\t\t\t\t\t|| (preguntaAnterior.estado === \"estable\" && preguntaAnterior.historial_cambios[0].estado === \"revision\") ){\n\t\t\t\t\t\t\treturn models.Pregunta.findByIdAndUpdate(args.idPregunta,{\n\t\t\t\t\t\t\t\t$set: {respuestas: preguntaAnterior.historial_cambios[0].respuestas}\n\t\t\t\t\t\t\t},{new: true}).then(pregunta => {\n\t\t\t\t\t\t\t\treturn pregunta;\n\n\t\t\t\t\t\t\t}).catch(error => {\n\t\t\t\t\t\t\t\tif (error) {\n\t\t\t\t\t\t\t\t\tthrow new Error(error);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tthrow new Error(\"the rule to make rollback this question is not correct\");\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthrow new Error(\"you can't make rollback this question because you are not the owner!!\");\n\t\t\t\t\t}\n\n\t\t\t\t}).catch(error => {\n\t\t\t\t\tif (error) {\n\t\t\t\t\t\tthrow new Error(error);\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t},\n\t\trollbackImagenPregunta: (parent, args, {models}) => {\n\t\t\treturn models.Pregunta.findOne({\"_id\": args.idPregunta,\n\t\t\t\t\"historial_cambios._id\": args.idPreguntaAnterior },{\"historial_cambios.$\":1,\"estado\":1})\n\t\t\t\t.populate(\"usuario_ID\")\n\t\t\t\t.then(preguntaAnterior => {\n\t\t\t\t\tif (preguntaAnterior.usuario_ID.correo === args.ownerQuestion){\n\t\t\t\t\t\tif ((preguntaAnterior.estado === \"revision\" && preguntaAnterior.historial_cambios[0].estado === \"estable\")\n\t\t\t\t\t\t\t|| (preguntaAnterior.estado === \"revision\" && preguntaAnterior.historial_cambios[0].estado === \"revision\")\n\t\t\t\t\t\t\t|| (preguntaAnterior.estado === \"estable\" && preguntaAnterior.historial_cambios[0].estado === \"revision\") ){\n\t\t\t\t\t\t\treturn models.Pregunta.findByIdAndUpdate(args.idPregunta,{\n\t\t\t\t\t\t\t\t$set: {imagen: preguntaAnterior.historial_cambios[0].imagen}\n\t\t\t\t\t\t\t},{new: true}).then(pregunta => {\n\t\t\t\t\t\t\t\treturn pregunta;\n\n\t\t\t\t\t\t\t}).catch(error => {\n\t\t\t\t\t\t\t\tif (error) {\n\t\t\t\t\t\t\t\t\tthrow new Error(error);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tthrow new Error(\"the rule to make rollback this question is not correct\");\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthrow new Error(\"you can't make rollback this question because you are not the owner!!\");\n\t\t\t\t\t}\n\n\t\t\t\t}).catch(error => {\n\t\t\t\t\tif (error) {\n\t\t\t\t\t\tthrow new Error(error);\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t},\n\t\tasignarPreguntasAMiembroComite: (parent, args, {models}) => {\n\t\t\treturn\tmodels.User.findById(args.idUsuario)\n\t\t\t\t.then(registroUsuario => {\n\t\t\t\t\tif(registroUsuario.roles[0].rol === \"comite\"){\n\t\t\t\t\t\treturn new Promise((resolve, reject)=>{\n\t\t\t\t\t\t\tasync.eachSeries(args.arrayPreguntas, (item, next)=>{\n\t\t\t\t\t\t\t\treturn\tmodels.Pregunta.findById(item)\n\t\t\t\t\t\t\t\t\t.populate(\"usuario_ID\")\n\t\t\t\t\t\t\t\t\t.populate(\"areaconocimiento\")\n\t\t\t\t\t\t\t\t\t.then(registroPregunta => {\n\t\t\t\t\t\t\t\t\t\tif(registroPregunta.usuario_ID._id == args.idUsuario){\n\t\t\t\t\t\t\t\t\t\t\treject(\"the user \" + registroPregunta.usuario_ID.nombre + \" already create \" +\n\t\t\t\t\t\t\t\t\t\t\t\t\"this questions, with title\" + registroPregunta.descripcion + \"so, can't\" +\n\t\t\t\t\t\t\t\t\t\t\t\t\"accept or revoque a question that the same create!\");\n\t\t\t\t\t\t\t\t\t\t}else if(registroPregunta.estados_asignados.length ||\n\t\t\t\t\t\t\t\t\t\t\tregistroPregunta.estados_asignados.usuario == args.idUsuario){\n\t\t\t\t\t\t\t\t\t\t\treject(\"Already exist a user assigned to this questions, you can't assign\" +\n\t\t\t\t\t\t\t\t\t\t\t\t\"to more one people \");\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\telse {\n\t\t\t\t\t\t\t\t\t\t\treturn\tmodels.Pregunta.findByIdAndUpdate(item,{\n\t\t\t\t\t\t\t\t\t\t\t\t$push: {estados_asignados:{usuario:args.idUsuario,\n\t\t\t\t\t\t\t\t\t\t\t\t\testado_asignado: \"revisor\",\n\t\t\t\t\t\t\t\t\t\t\t\t\tobservacion: \"A committe member need put a short description about your decision\",\n\t\t\t\t\t\t\t\t\t\t\t\t\tfecha_asignacion: new Date}}\n\t\t\t\t\t\t\t\t\t\t\t},{new: true}).then(preguntaActualizada => {\n\t\t\t\t\t\t\t\t\t\t\t\tif (preguntaActualizada){\n\t\t\t\t\t\t\t\t\t\t\t\t\tnext();\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t}).catch(error => {\n\t\t\t\t\t\t\t\t\t\tif (error){\n\t\t\t\t\t\t\t\t\t\t\treject(error);\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t},(error)=>{\n\t\t\t\t\t\t\t\tif (error){\n\t\t\t\t\t\t\t\t\treject(error);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tresolve(true);\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t});\n\n\n\n\t\t\t\t\t}else{\n\t\t\t\t\t\tthrow new Error(\"this user isn't committe member, so that you can't assign this question\");\n\t\t\t\t\t}\n\t\t\t\t}).catch(error => {\n\t\t\t\t\tthrow new Error(error);\n\n\t\t\t\t});\n\t\t},\n\t\tasignarEstadoPregunta: (parent, args, {models}) => {\n\t\t\treturn models.Pregunta.findById(args.idPregunta)\n\t\t\t\t.then(registroPregunta => {\n\t\t\t\t\tif (registroPregunta.usuario_ID == args.idUsuario){\n\t\t\t\t\t\tthrow new Error(\"you can't re-assign a state if you\" +\n\t\t\t\t\t\t\t\"are the owner the question\");\n\t\t\t\t\t}else if(registroPregunta.estados_asignados[0].usuario == args.idUsuario){\n\t\t\t\t\t\treturn models.Pregunta.findOneAndUpdate({_id:args.idPregunta,\"estados_asignados.usuario\": args.idUsuario},{\n\t\t\t\t\t\t\t$set:{\"estado\": args.estado,\"estados_asignados.$.estado_asignado\":args.estado,\n\t\t\t\t\t\t\t\t\"estados_asignados.$.observacion\":args.observacion}\n\t\t\t\t\t\t},{new: true}).then(preguntaActualizada => {\n\t\t\t\t\t\t\treturn preguntaActualizada;\n\t\t\t\t\t\t}).catch(errorActualizar => {\n\t\t\t\t\t\t\tthrow new Error(errorActualizar);\n\t\t\t\t\t\t});\n\t\t\t\t\t}else{\n\t\t\t\t\t\tthrow new Error(\"this users is not be able to assign this state to this question\" +\n\t\t\t\t\t\t\t\"because was not assigned \");\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t}).catch(error => {\n\t\t\t\t\tif (error){\n\t\t\t\t\t\tthrow new Error(error);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t},\n\t\ttransferirListaPreguntasDesignadasAUsuario: (parent, args, {models})=>{\n\t\t\treturn models.User.findById(args.idUsuarioDesignado)\n\t\t\t\t.then(usuario => {\n\t\t\t\t\tif(usuario.roles[0].rol === \"comite\"){\n\t\t\t\t\t\treturn models.Pregunta.update({\"estados_asignados.usuario\": args.idUsuarioActivo},{\n\t\t\t\t\t\t\t$set:{\"estados_asignados.$.usuario\":args.idUsuarioDesignado}\n\t\t\t\t\t\t},{multi:true,new:true}).then(actualizada => {\n\t\t\t\t\t\t\tif(actualizada.n >0){\n\t\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t\t}else{\n\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}).catch(error =>{\n\t\t\t\t\t\t\tif(error){\n\t\t\t\t\t\t\t\tthrow new Error(error);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t\t\n\t\t\t\t\t}else{\n\t\t\t\t\t\tthrow new Error(\"only commite member can assigned this questions\");\n\t\t\t\t\t}\n\n\t\t\t\t}).catch(error => {\n\t\t\t\t\tif (error){\n\t\t\t\t\t\tthrow new Error(error);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t}\n\t}\n};\n"]}