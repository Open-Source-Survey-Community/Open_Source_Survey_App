{"version":3,"sources":["../../resolvers/pregunta.js"],"names":["Query","verMyPreguntaActual","parent","args","models","Pregunta","findOne","_id","idPregunta","registroActual","populate","then","pregunta","catch","error","Error","listadoPreguntasActuales","edgePreguntaArray","cursor","parseInt","Buffer","from","after","toString","edgePreguntaInfoPromise","Promise","resolve","reject","edges","find","identificador","$gt","descripcion","RegExp","word","err","result","limit","on","push","res","node","endCursor","length","NaN","hasNextPage","cursorFinal","where","gt","count","pageInfo","hasnextPage","totalPagesPromise","listPaginatePregunta","all","values","totalCount","verListadoMisPreguntasActuales","idUsuario","usuario_ID","sort","listadoMisPreguntas","verListadoMisPreguntasActualesByEstado","estado","listadoPreguntas","listadoPreguntasActualesByEstado","historialImagenesUsadasByUserinAPregunta","listadoUsuariosDistintosCreadoPreguntas","distinct","User","$in","listaUsuariosDistintos","listaUsuarios","listadoAreasConocimientosUsadasPreguntas","areasConocimiento","listaAreasConocimientosUsadas","cargarListadoPreguntasByAreasConocimiento","areaconocimiento","idAreaConocimiento","Mutation","crearPregunta","existenPreguntasCreadas","objectNewPregunta","save","documento","editarPregunta","findById","preguntaAnterior","imagen","fecha_creacion","tipoPregunta","respuestas","findByIdAndUpdate","$push","historial_cambios","$set","new","documentoActualizado","eliminarPregunta","correo","correoUsuario","documentoPregunta","rollbackPreguntaAnterior","idPreguntaAnterior","ownerQuestion","rollbackDescripcionPregunta","rollbackRespuestasPregunta","rollbackImagenPregunta","asignarPreguntasAMiembroComite","registroUsuario","roles","rol","eachSeries","arrayPreguntas","item","next","registroPregunta","nombre","estados_asignados","usuario","estado_asignado","observacion","fecha_asignacion","Date","preguntaActualizada","asignarEstadoPregunta","findOneAndUpdate","errorActualizar","transferirListaPreguntasDesignadasAUsuario","idUsuarioDesignado","update","idUsuarioActivo","multi","actualizada","n"],"mappings":"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","file":"pregunta.js","sourcesContent":["/* eslint-disable no-unused-vars */\nimport async from \"async\";\n\nexport default {\n\tQuery: {\n\t\tverMyPreguntaActual: (parent, args, {models}) => {\n\t\t\treturn models.Pregunta.findOne({_id: args.idPregunta,\n\t\t\t\tregistroActual: true })\n\t\t\t\t.populate(\"usuario_ID\")\n\t\t\t\t.populate(\"areaconocimiento\")\n\t\t\t\t.populate(\"discusiones\")\n\t\t\t\t.then(pregunta => {\n\t\t\t\t\treturn pregunta;\n\t\t\t\t}).catch(error=> {\n\t\t\t\t\tif (error){\n\t\t\t\t\t\tthrow new Error(error);\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t},\n\t\tlistadoPreguntasActuales : (parent, args, {models}) => {\n\t\t\tlet edgePreguntaArray = [];\n\t\t\tlet cursor = parseInt(Buffer.from(args.after, \"base64\").toString(\"ascii\"));\n\t\t\tif (!cursor){\n\t\t\t\tcursor = 0;\n\t\t\t}\n\t\t\tlet edgePreguntaInfoPromise = new Promise((resolve, reject)=> {\n\t\t\t\tlet edges = models.Pregunta.find({identificador:{$gt:cursor},registroActual: true,\n\t\t\t\t\tdescripcion: new RegExp(args.word, \"i\")}, (err, result) => {\n\t\t\t\t\tif(err){\n\t\t\t\t\t\treject(err);\n\t\t\t\t\t}\n\t\t\t\t}).populate(\"usuario_ID\")\n\t\t\t\t\t.populate(\"areaconocimiento\")\n\t\t\t\t\t.populate(\"discusiones\")\n\t\t\t\t\t.limit(args.limit).cursor();\n\n\t\t\t\tedges.on(\"data\", res => {\n\t\t\t\t\tedgePreguntaArray.push({\n\t\t\t\t\t\tcursor : Buffer.from((res.identificador).toString()).toString(\"base64\"),\n\t\t\t\t\t\tnode: res\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t\tedges.on(\"end\",()=> {\n\t\t\t\t\tlet endCursor = edgePreguntaArray.length > 0 ? edgePreguntaArray[edgePreguntaArray.length - 1].cursor:NaN;\n\t\t\t\t\tlet hasNextPage = new Promise((resolve, reject)=> {\n\t\t\t\t\t\tif (endCursor) {\n\t\t\t\t\t\t\tlet cursorFinal = parseInt(Buffer.from(endCursor,\"base64\").toString(\"ascii\"));\n\t\t\t\t\t\t\tmodels.Pregunta.where(\"identificador\").gt(cursorFinal).count({registroActual:true},(err, count)=> {\n\t\t\t\t\t\t\t\tif (err) {\n\t\t\t\t\t\t\t\t\treject(err);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tcount > 0 ? resolve(true): resolve(false);\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tresolve(false);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\tresolve({\n\t\t\t\t\t\tedges: edgePreguntaArray,\n\t\t\t\t\t\tpageInfo: {\n\t\t\t\t\t\t\tendCursor: endCursor,\n\t\t\t\t\t\t\thasnextPage: hasNextPage\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t});\n\t\t\tlet totalPagesPromise = new Promise((resolve, reject) => {\n\t\t\t\tmodels.Pregunta.count({registroActual:true},(err, count) => {\n\t\t\t\t\tif (err) {\n\t\t\t\t\t\treject(err);\n\t\t\t\t\t}else {\n\t\t\t\t\t\tresolve(count);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\t\t\tlet listPaginatePregunta = Promise.all([edgePreguntaInfoPromise, totalPagesPromise]).then((values) => {\n\t\t\t\treturn {\n\t\t\t\t\tedges: values[0].edges,\n\t\t\t\t\ttotalCount: values[1],\n\t\t\t\t\tpageInfo:{\n\t\t\t\t\t\tendCursor: values[0].pageInfo.endCursor,\n\t\t\t\t\t\thasnextPage:values[0].pageInfo.hasnextPage\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t});\n\t\t\treturn listPaginatePregunta;\n\t\t},\n\t\tverListadoMisPreguntasActuales: (parent, args, {models})=> {\n\t\t\tif (args.idUsuario) {\n\t\t\t\treturn models.Pregunta.find({usuario_ID: args.idUsuario, registroActual: true})\n\t\t\t\t\t.populate(\"usuario_ID\")\n\t\t\t\t\t.populate(\"areaconocimiento\")\n\t\t\t\t\t.populate(\"discusiones\")\n\t\t\t\t\t.sort({\"fecha_creacion\":-1})\n\t\t\t\t\t.then(listadoMisPreguntas => {\n\t\t\t\t\t\treturn listadoMisPreguntas;\n\t\t\t\t\t})\n\t\t\t\t\t.catch(error => {\n\t\t\t\t\t\tif (error) {\n\t\t\t\t\t\t\tthrow new Error(error);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tthrow new Error(\"It neccessary to ID of a usuario, para retrieve the information\");\n\t\t\t}\n\n\t\t},\n\t\tverListadoMisPreguntasActualesByEstado: (parent, args, {models})=> {\n\t\t\tlet estado;\n\t\t\tif (args.idUsuario){\n\t\t\t\tif (!args.estado){\n\t\t\t\t\testado = \"revision\";\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\testado = args.estado;\n\t\t\t\t}\n\t\t\t\treturn models.Pregunta.find({usuario_ID: args.idUsuario, registroActual: true, estado: estado})\n\t\t\t\t\t.populate(\"usuario_ID\")\n\t\t\t\t\t.populate(\"areaconocimiento\")\n\t\t\t\t\t.populate(\"discusiones\")\n\t\t\t\t\t.sort({\"fecha_creacion\":-1})\n\t\t\t\t\t.then(listadoPreguntas => {\n\t\t\t\t\t\treturn listadoPreguntas;\n\t\t\t\t\t}).catch(error => {\n\t\t\t\t\t\tif (error){\n\t\t\t\t\t\t\tthrow new Error(error);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tthrow new Error(\"It neccessary to ID of a usuario, para retrieve the information\");\n\t\t\t}\n\n\t\t},\n\t\tlistadoPreguntasActualesByEstado: (parent, args, {models}) => {\n\t\t\tlet edgePreguntaArray = [];\n\t\t\tlet cursor = parseInt(Buffer.from(args.after, \"base64\").toString(\"ascii\"));\n\t\t\tif (!cursor){\n\t\t\t\tcursor = 0;\n\t\t\t}\n\t\t\tlet edgePreguntaInfoPromise = new Promise((resolve, reject)=> {\n\t\t\t\tlet edges = models.Pregunta.find({identificador:{$gt:cursor},registroActual: true,\n\t\t\t\t\tdescripcion: new RegExp(args.word, \"i\"),estado: args.estado}, (err, result) => {\n\t\t\t\t\tif(err){\n\t\t\t\t\t\treject(err);\n\t\t\t\t\t}\n\t\t\t\t}).populate(\"usuario_ID\")\n\t\t\t\t\t.populate(\"areaconocimiento\")\n\t\t\t\t\t.populate(\"discusiones\")\n\t\t\t\t\t.limit(args.limit).cursor();\n\n\t\t\t\tedges.on(\"data\", res => {\n\t\t\t\t\tedgePreguntaArray.push({\n\t\t\t\t\t\tcursor : Buffer.from((res.identificador).toString()).toString(\"base64\"),\n\t\t\t\t\t\tnode: res\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t\tedges.on(\"end\",()=> {\n\t\t\t\t\tlet endCursor = edgePreguntaArray.length > 0 ? edgePreguntaArray[edgePreguntaArray.length - 1].cursor:NaN;\n\t\t\t\t\tlet hasNextPage = new Promise((resolve, reject)=> {\n\t\t\t\t\t\tif (endCursor) {\n\t\t\t\t\t\t\tlet cursorFinal = parseInt(Buffer.from(endCursor,\"base64\").toString(\"ascii\"));\n\t\t\t\t\t\t\tmodels.Pregunta.where(\"identificador\").gt(cursorFinal).count({registroActual:true},(err, count)=> {\n\t\t\t\t\t\t\t\tif (err) {\n\t\t\t\t\t\t\t\t\treject(err);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tcount > 0 ? resolve(true): resolve(false);\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tresolve(false);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\tresolve({\n\t\t\t\t\t\tedges: edgePreguntaArray,\n\t\t\t\t\t\tpageInfo: {\n\t\t\t\t\t\t\tendCursor: endCursor,\n\t\t\t\t\t\t\thasnextPage: hasNextPage\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t});\n\t\t\tlet totalPagesPromise = new Promise((resolve, reject) => {\n\t\t\t\tmodels.Pregunta.count((err, count) => {\n\t\t\t\t\tif (err) {\n\t\t\t\t\t\treject(err);\n\t\t\t\t\t}else {\n\t\t\t\t\t\tresolve(count);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\t\t\tlet listPaginatePregunta = Promise.all([edgePreguntaInfoPromise, totalPagesPromise]).then((values) => {\n\t\t\t\treturn {\n\t\t\t\t\tedges: values[0].edges,\n\t\t\t\t\ttotalCount: values[1],\n\t\t\t\t\tpageInfo:{\n\t\t\t\t\t\tendCursor: values[0].pageInfo.endCursor,\n\t\t\t\t\t\thasnextPage:values[0].pageInfo.hasnextPage\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t});\n\t\t\treturn listPaginatePregunta;\n\t\t},\n\t\thistorialImagenesUsadasByUserinAPregunta: (parent, args, {models}) => {\n\t\t\treturn models.Pregunta.findOne({_id: args.idPregunta, usuario_ID: args.idUsuario},\"historial_cambios estado\")\n\t\t\t\t.then(pregunta => {\n\t\t\t\t\tif (pregunta.estado === \"revision\" || pregunta.estado === \"estable\"){\n\t\t\t\t\t\treturn pregunta;\n\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthrow new Error(\"you can to access to list Images of a closed(reject) question\");\n\t\t\t\t\t}\n\n\t\t\t\t}).catch(error => {\n\t\t\t\t\tif (error){\n\t\t\t\t\t\tthrow new Error(error);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t},\n\t\tlistadoUsuariosDistintosCreadoPreguntas: (parent, args, {models}) => {\n\t\t\treturn models.Pregunta.distinct(\"usuario_ID\")\n\t\t\t\t.then(listaUsuariosDistintos => {\n\t\t\t\t\treturn models.User.find({\"_id\":{$in:listaUsuariosDistintos}})\n\t\t\t\t\t\t.then(listaUsuarios => {\n\t\t\t\t\t\t\treturn listaUsuarios;\n\t\t\t\t\t\t}).catch(error => {\n\t\t\t\t\t\t\tif (error){\n\t\t\t\t\t\t\t\tthrow new Error(error);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t}).catch(error => {\n\t\t\t\t\tif (error){\n\t\t\t\t\t\tthrow new Error(error);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t},\n\t\tlistadoAreasConocimientosUsadasPreguntas: (parent, args, {models}) => {\n\t\t\treturn models.areasConocimiento.distinct(\"titulo\")\n\t\t\t\t.then(listaAreasConocimientosUsadas=>{\n\t\t\t\t\treturn listaAreasConocimientosUsadas;\n\t\t\t\t}).catch(error => {\n\t\t\t\t\tif (error){\n\t\t\t\t\t\tthrow new Error(error);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t},\n\t\tcargarListadoPreguntasByAreasConocimiento: (parent, args, {models})=>{\n\t\t\tlet edgePreguntaArray = [];\n\t\t\tlet cursor = parseInt(Buffer.from(args.after, \"base64\").toString(\"ascii\"));\n\t\t\tif (!cursor){\n\t\t\t\tcursor = 0;\n\t\t\t}\n\t\t\tlet edgePreguntaInfoPromise = new Promise((resolve, reject)=> {\n\t\t\t\tlet edges = models.Pregunta.find({identificador:{$gt:cursor},registroActual: true,\n\t\t\t\t\tdescripcion: new RegExp(args.word, \"i\"),areaconocimiento: args.idAreaConocimiento}, (err, result) => {\n\t\t\t\t\tif(err){\n\t\t\t\t\t\treject(err);\n\t\t\t\t\t}\n\t\t\t\t}).populate(\"usuario_ID\")\n\t\t\t\t\t.populate(\"areaconocimiento\")\n\t\t\t\t\t.populate(\"discusiones\")\n\t\t\t\t\t.limit(args.limit).cursor();\n\n\t\t\t\tedges.on(\"data\", res => {\n\t\t\t\t\tedgePreguntaArray.push({\n\t\t\t\t\t\tcursor : Buffer.from((res.identificador).toString()).toString(\"base64\"),\n\t\t\t\t\t\tnode: res\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t\tedges.on(\"end\",()=> {\n\t\t\t\t\tlet endCursor = edgePreguntaArray.length > 0 ? edgePreguntaArray[edgePreguntaArray.length - 1].cursor:NaN;\n\t\t\t\t\tlet hasNextPage = new Promise((resolve, reject)=> {\n\t\t\t\t\t\tif (endCursor) {\n\t\t\t\t\t\t\tlet cursorFinal = parseInt(Buffer.from(endCursor,\"base64\").toString(\"ascii\"));\n\t\t\t\t\t\t\tmodels.Pregunta.where(\"identificador\").gt(cursorFinal).count({registroActual:true,\n\t\t\t\t\t\t\t\tareaconocimiento: args.idAreaConocimiento},(err, count)=> {\n\t\t\t\t\t\t\t\tif (err) {\n\t\t\t\t\t\t\t\t\treject(err);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tcount > 0 ? resolve(true): resolve(false);\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tresolve(false);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\tresolve({\n\t\t\t\t\t\tedges: edgePreguntaArray,\n\t\t\t\t\t\tpageInfo: {\n\t\t\t\t\t\t\tendCursor: endCursor,\n\t\t\t\t\t\t\thasnextPage: hasNextPage\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t});\n\t\t\tlet totalPagesPromise = new Promise((resolve, reject) => {\n\t\t\t\tmodels.Pregunta.count({areaconocimiento: args.idAreaConocimiento,registroActual:true},(err, count) => {\n\t\t\t\t\tif (err) {\n\t\t\t\t\t\treject(err);\n\t\t\t\t\t}else {\n\t\t\t\t\t\tresolve(count);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\t\t\tlet listPaginatePregunta = Promise.all([edgePreguntaInfoPromise, totalPagesPromise]).then((values) => {\n\t\t\t\treturn {\n\t\t\t\t\tedges: values[0].edges,\n\t\t\t\t\ttotalCount: values[1],\n\t\t\t\t\tpageInfo:{\n\t\t\t\t\t\tendCursor: values[0].pageInfo.endCursor,\n\t\t\t\t\t\thasnextPage:values[0].pageInfo.hasnextPage\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t});\n\t\t\treturn listPaginatePregunta;\n\t\t}\n\t},\n\tMutation: {\n\t\tcrearPregunta: (parent, args, {models}) => {\n\t\t\tif (args.pregunta.descripcion && args.pregunta.usuario_ID && args.pregunta.areaconocimiento.length > 0) {\n\t\t\t\treturn models.Pregunta.count()\n\t\t\t\t\t.then(existenPreguntasCreadas => {\n\t\t\t\t\t\tif (existenPreguntasCreadas) {\n\t\t\t\t\t\t\targs.pregunta.identificador = existenPreguntasCreadas + 1;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tconst objectNewPregunta = new models.Pregunta(args.pregunta);\n\t\t\t\t\t\treturn objectNewPregunta.save()\n\t\t\t\t\t\t\t.then(documento => {\n\t\t\t\t\t\t\t\treturn documento;\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t.catch(error => {\n\t\t\t\t\t\t\t\tif (error) {\n\t\t\t\t\t\t\t\t\tthrow new Error(error);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t}).catch(error=> {\n\t\t\t\t\t\tif (error){\n\t\t\t\t\t\t\tthrow new Error(error);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t} else {\n\t\t\t\tthrow new Error(\"there is empties fields, is not possible save a new question\");\n\t\t\t}\n\n\t\t},\n\t\teditarPregunta: (parent, args, {models}) => {\n\t\t\treturn models.Pregunta.findById(args.idPregunta)\n\t\t\t\t.then(documento => {\n\t\t\t\t\tif (documento.usuario_ID == args.pregunta.usuario_ID ) {\n\t\t\t\t\t\tif (documento.estado === \"revision\" || documento.estado === \"estable\"){\n\t\t\t\t\t\t\tlet preguntaAnterior = {\n\t\t\t\t\t\t\t\tdescripcion: documento.descripcion,\n\t\t\t\t\t\t\t\timagen: documento.imagen,\n\t\t\t\t\t\t\t\testado: documento.estado,\n\t\t\t\t\t\t\t\tfecha_creacion: documento.fecha_creacion,\n\t\t\t\t\t\t\t\ttipoPregunta: documento.tipoPregunta,\n\t\t\t\t\t\t\t\tareaconocimiento: documento.areaconocimiento,\n\t\t\t\t\t\t\t\trespuestas: documento.respuestas\n\t\t\t\t\t\t\t};\n\n\t\t\t\t\t\t\treturn models.Pregunta.findByIdAndUpdate(args.idPregunta,\n\t\t\t\t\t\t\t\t{$push:{historial_cambios: preguntaAnterior},\n\t\t\t\t\t\t\t\t\t$set:{descripcion: args.pregunta.descripcion,\n\t\t\t\t\t\t\t\t\t\timagen: args.pregunta.imagen,\n\t\t\t\t\t\t\t\t\t\tfecha_creacion: args.pregunta.fecha_creacion,\n\t\t\t\t\t\t\t\t\t\ttipoPregunta: args.pregunta.tipoPregunta,\n\t\t\t\t\t\t\t\t\t\tareaconocimiento: args.pregunta.areaconocimiento,\n\t\t\t\t\t\t\t\t\t\trespuestas: args.pregunta.respuestas\n\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t,{new : true})\n\t\t\t\t\t\t\t\t.then(documentoActualizado => {\n\t\t\t\t\t\t\t\t\treturn documentoActualizado;\n\t\t\t\t\t\t\t\t}).catch(error=> {\n\t\t\t\t\t\t\t\t\tif (error) {\n\t\t\t\t\t\t\t\t\t\tthrow new Error(error);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tthrow new Error(\"this questions is closed!!, because the commite member decided \" +\n\t\t\t\t\t\t\t\t\"reject this question, so you should, create a new one\");\n\t\t\t\t\t\t}\n\t\t\t\t\t}else {\n\t\t\t\t\t\tthrow new Error(\"you are not own this question, so you can not update\");\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\t.catch(error => {\n\t\t\t\t\tif (error) {\n\t\t\t\t\t\tthrow new Error(error);\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t},\n\t\teliminarPregunta: (parent, args, {models}) => {\n\t\t\treturn models.User.findOne({correo: args.correoUsuario},\"_id\")\n\t\t\t\t.then(idUsuario => {\n\t\t\t\t\treturn models.Pregunta.findOne({_id: args.idPregunta, usuario_ID: idUsuario})\n\t\t\t\t\t\t.then(documentoPregunta => {\n\t\t\t\t\t\t\tif (documentoPregunta.estado === \"revision\" || documentoPregunta.estado === \"rechazada\") {\n\t\t\t\t\t\t\t\treturn models.Pregunta.findByIdAndUpdate(args.idPregunta, {$set:{registroActual: false}},{new: true})\n\t\t\t\t\t\t\t\t\t.then(documentoPregunta => {\n\t\t\t\t\t\t\t\t\t\treturn documentoPregunta;\n\t\t\t\t\t\t\t\t\t}).catch(error => {\n\t\t\t\t\t\t\t\t\t\tif (error) {\n\t\t\t\t\t\t\t\t\t\t\tthrow new Error(error);\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tthrow new Error(\"this questions is accepted, is not possible delete this question\");\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t}).catch(error => {\n\t\t\t\t\t\t\tif (error) {\n\t\t\t\t\t\t\t\tthrow new Error(error);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\n\t\t\t\t}).catch(error => {\n\t\t\t\t\tif (error) {\n\t\t\t\t\t\tthrow new Error(error);\n\t\t\t\t\t}\n\n\t\t\t\t});\n\n\t\t},\n\t\trollbackPreguntaAnterior: (parent, args, {models}) => {\n\t\t\treturn models.Pregunta.findOne({\"_id\": args.idPregunta,\n\t\t\t\t\"historial_cambios._id\": args.idPreguntaAnterior },{\"historial_cambios.$\":1,\"estado\":1})\n\t\t\t\t.populate(\"usuario_ID\")\n\t\t\t\t.then(preguntaAnterior => {\n\t\t\t\t\tif (preguntaAnterior.usuario_ID.correo === args.ownerQuestion){\n\t\t\t\t\t\tif ((preguntaAnterior.estado === \"revision\" && preguntaAnterior.historial_cambios[0].estado === \"estable\")\n\t\t\t\t\t\t\t\t|| (preguntaAnterior.estado === \"revision\" && preguntaAnterior.historial_cambios[0].estado === \"revision\")\n\t\t\t\t\t\t\t|| (preguntaAnterior.estado === \"estable\" && preguntaAnterior.historial_cambios[0].estado === \"revision\") ){\n\t\t\t\t\t\t\treturn models.Pregunta.findByIdAndUpdate(args.idPregunta,{\n\t\t\t\t\t\t\t\t$set: {descripcion: preguntaAnterior.historial_cambios[0].descripcion,\n\t\t\t\t\t\t\t\t\timagen: preguntaAnterior.historial_cambios[0].imagen,\n\t\t\t\t\t\t\t\t\testado: preguntaAnterior.historial_cambios[0].estado,\n\t\t\t\t\t\t\t\t\tfecha_creacion: preguntaAnterior.historial_cambios[0].fecha_creacion,\n\t\t\t\t\t\t\t\t\ttipoPregunta: preguntaAnterior.historial_cambios[0].tipoPregunta,\n\t\t\t\t\t\t\t\t\tareaconocimiento: preguntaAnterior.historial_cambios[0].areaconocimiento,\n\t\t\t\t\t\t\t\t\trespuestas: preguntaAnterior.historial_cambios[0].respuestas}\n\t\t\t\t\t\t\t},{new: true}).then(pregunta => {\n\t\t\t\t\t\t\t\treturn pregunta;\n\n\t\t\t\t\t\t\t}).catch(error => {\n\t\t\t\t\t\t\t\tif (error) {\n\t\t\t\t\t\t\t\t\tthrow new Error(error);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tthrow new Error(\"the rule to make rollback this question is not correct\");\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthrow new Error(\"you can't make rollback this question because you are not the owner!!\");\n\t\t\t\t\t}\n\n\t\t\t\t}).catch(error => {\n\t\t\t\t\tif (error) {\n\t\t\t\t\t\tthrow new Error(error);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t},\n\t\trollbackDescripcionPregunta: (parent, args, {models}) => {\n\t\t\treturn models.Pregunta.findOne({\"_id\": args.idPregunta,\n\t\t\t\t\"historial_cambios._id\": args.idPreguntaAnterior },{\"historial_cambios.$\":1,\"estado\":1})\n\t\t\t\t.populate(\"usuario_ID\")\n\t\t\t\t.then(preguntaAnterior => {\n\t\t\t\t\tif (preguntaAnterior.usuario_ID.correo === args.ownerQuestion){\n\t\t\t\t\t\tif ((preguntaAnterior.estado === \"revision\" && preguntaAnterior.historial_cambios[0].estado === \"estable\")\n\t\t\t\t\t\t\t|| (preguntaAnterior.estado === \"revision\" && preguntaAnterior.historial_cambios[0].estado === \"revision\")\n\t\t\t\t\t\t\t|| (preguntaAnterior.estado === \"estable\" && preguntaAnterior.historial_cambios[0].estado === \"revision\") ){\n\t\t\t\t\t\t\treturn models.Pregunta.findByIdAndUpdate(args.idPregunta,{\n\t\t\t\t\t\t\t\t$set: {descripcion: preguntaAnterior.historial_cambios[0].descripcion}\n\t\t\t\t\t\t\t},{new: true}).then(pregunta => {\n\t\t\t\t\t\t\t\treturn pregunta;\n\n\t\t\t\t\t\t\t}).catch(error => {\n\t\t\t\t\t\t\t\tif (error) {\n\t\t\t\t\t\t\t\t\tthrow new Error(error);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tthrow new Error(\"the rule to make rollback this question is not correct\");\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthrow new Error(\"you can't make rollback this question because you are not the owner!!\");\n\t\t\t\t\t}\n\n\t\t\t\t}).catch(error => {\n\t\t\t\t\tif (error) {\n\t\t\t\t\t\tthrow new Error(error);\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t},\n\t\trollbackRespuestasPregunta: (parent, args, {models}) => {\n\t\t\treturn models.Pregunta.findOne({\"_id\": args.idPregunta,\n\t\t\t\t\"historial_cambios._id\": args.idPreguntaAnterior },{\"historial_cambios.$\":1,\"estado\":1})\n\t\t\t\t.populate(\"usuario_ID\")\n\t\t\t\t.then(preguntaAnterior => {\n\t\t\t\t\tif (preguntaAnterior.usuario_ID.correo === args.ownerQuestion){\n\t\t\t\t\t\tif ((preguntaAnterior.estado === \"revision\" && preguntaAnterior.historial_cambios[0].estado === \"estable\")\n\t\t\t\t\t\t\t|| (preguntaAnterior.estado === \"revision\" && preguntaAnterior.historial_cambios[0].estado === \"revision\")\n\t\t\t\t\t\t\t|| (preguntaAnterior.estado === \"estable\" && preguntaAnterior.historial_cambios[0].estado === \"revision\") ){\n\t\t\t\t\t\t\treturn models.Pregunta.findByIdAndUpdate(args.idPregunta,{\n\t\t\t\t\t\t\t\t$set: {respuestas: preguntaAnterior.historial_cambios[0].respuestas}\n\t\t\t\t\t\t\t},{new: true}).then(pregunta => {\n\t\t\t\t\t\t\t\treturn pregunta;\n\n\t\t\t\t\t\t\t}).catch(error => {\n\t\t\t\t\t\t\t\tif (error) {\n\t\t\t\t\t\t\t\t\tthrow new Error(error);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tthrow new Error(\"the rule to make rollback this question is not correct\");\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthrow new Error(\"you can't make rollback this question because you are not the owner!!\");\n\t\t\t\t\t}\n\n\t\t\t\t}).catch(error => {\n\t\t\t\t\tif (error) {\n\t\t\t\t\t\tthrow new Error(error);\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t},\n\t\trollbackImagenPregunta: (parent, args, {models}) => {\n\t\t\treturn models.Pregunta.findOne({\"_id\": args.idPregunta,\n\t\t\t\t\"historial_cambios._id\": args.idPreguntaAnterior },{\"historial_cambios.$\":1,\"estado\":1})\n\t\t\t\t.populate(\"usuario_ID\")\n\t\t\t\t.then(preguntaAnterior => {\n\t\t\t\t\tif (preguntaAnterior.usuario_ID.correo === args.ownerQuestion){\n\t\t\t\t\t\tif ((preguntaAnterior.estado === \"revision\" && preguntaAnterior.historial_cambios[0].estado === \"estable\")\n\t\t\t\t\t\t\t|| (preguntaAnterior.estado === \"revision\" && preguntaAnterior.historial_cambios[0].estado === \"revision\")\n\t\t\t\t\t\t\t|| (preguntaAnterior.estado === \"estable\" && preguntaAnterior.historial_cambios[0].estado === \"revision\") ){\n\t\t\t\t\t\t\treturn models.Pregunta.findByIdAndUpdate(args.idPregunta,{\n\t\t\t\t\t\t\t\t$set: {imagen: preguntaAnterior.historial_cambios[0].imagen}\n\t\t\t\t\t\t\t},{new: true}).then(pregunta => {\n\t\t\t\t\t\t\t\treturn pregunta;\n\n\t\t\t\t\t\t\t}).catch(error => {\n\t\t\t\t\t\t\t\tif (error) {\n\t\t\t\t\t\t\t\t\tthrow new Error(error);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tthrow new Error(\"the rule to make rollback this question is not correct\");\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthrow new Error(\"you can't make rollback this question because you are not the owner!!\");\n\t\t\t\t\t}\n\n\t\t\t\t}).catch(error => {\n\t\t\t\t\tif (error) {\n\t\t\t\t\t\tthrow new Error(error);\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t},\n\t\tasignarPreguntasAMiembroComite: (parent, args, {models}) => {\n\t\t\treturn\tmodels.User.findById(args.idUsuario)\n\t\t\t\t.then(registroUsuario => {\n\t\t\t\t\tif(registroUsuario.roles[0].rol === \"comite\"){\n\t\t\t\t\t\treturn new Promise((resolve, reject)=>{\n\t\t\t\t\t\t\tasync.eachSeries(args.arrayPreguntas, (item, next)=>{\n\t\t\t\t\t\t\t\treturn\tmodels.Pregunta.findById(item)\n\t\t\t\t\t\t\t\t\t.populate(\"usuario_ID\")\n\t\t\t\t\t\t\t\t\t.populate(\"areaconocimiento\")\n\t\t\t\t\t\t\t\t\t.then(registroPregunta => {\n\t\t\t\t\t\t\t\t\t\tif(registroPregunta.usuario_ID._id == args.idUsuario){\n\t\t\t\t\t\t\t\t\t\t\treject(\"the user \" + registroPregunta.usuario_ID.nombre + \" already create \" +\n\t\t\t\t\t\t\t\t\t\t\t\t\"this questions, with title\" + registroPregunta.descripcion + \"so, can't\" +\n\t\t\t\t\t\t\t\t\t\t\t\t\"accept or revoque a question that the same create!\");\n\t\t\t\t\t\t\t\t\t\t}else if(registroPregunta.estados_asignados.length ||\n\t\t\t\t\t\t\t\t\t\t\tregistroPregunta.estados_asignados.usuario == args.idUsuario){\n\t\t\t\t\t\t\t\t\t\t\treject(\"Already exist a user assigned to this questions, you can't assign\" +\n\t\t\t\t\t\t\t\t\t\t\t\t\"to more one people \");\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\telse {\n\t\t\t\t\t\t\t\t\t\t\treturn\tmodels.Pregunta.findByIdAndUpdate(item,{\n\t\t\t\t\t\t\t\t\t\t\t\t$push: {estados_asignados:{usuario:args.idUsuario,\n\t\t\t\t\t\t\t\t\t\t\t\t\testado_asignado: \"revisor\",\n\t\t\t\t\t\t\t\t\t\t\t\t\tobservacion: \"A committe member need put a short description about your decision\",\n\t\t\t\t\t\t\t\t\t\t\t\t\tfecha_asignacion: new Date}}\n\t\t\t\t\t\t\t\t\t\t\t},{new: true}).then(preguntaActualizada => {\n\t\t\t\t\t\t\t\t\t\t\t\tif (preguntaActualizada){\n\t\t\t\t\t\t\t\t\t\t\t\t\tnext();\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t}).catch(error => {\n\t\t\t\t\t\t\t\t\t\tif (error){\n\t\t\t\t\t\t\t\t\t\t\treject(error);\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t},(error)=>{\n\t\t\t\t\t\t\t\tif (error){\n\t\t\t\t\t\t\t\t\treject(error);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tresolve(true);\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t});\n\n\n\n\t\t\t\t\t}else{\n\t\t\t\t\t\tthrow new Error(\"this user isn't committe member, so that you can't assign this question\");\n\t\t\t\t\t}\n\t\t\t\t}).catch(error => {\n\t\t\t\t\tthrow new Error(error);\n\n\t\t\t\t});\n\t\t},\n\t\tasignarEstadoPregunta: (parent, args, {models}) => {\n\t\t\treturn models.Pregunta.findById(args.idPregunta)\n\t\t\t\t.then(registroPregunta => {\n\t\t\t\t\tif (registroPregunta.usuario_ID == args.idUsuario){\n\t\t\t\t\t\tthrow new Error(\"you can't re-assign a state if you\" +\n\t\t\t\t\t\t\t\"are the owner the question\");\n\t\t\t\t\t}else if(registroPregunta.estados_asignados[0].usuario == args.idUsuario){\n\t\t\t\t\t\treturn models.Pregunta.findOneAndUpdate({_id:args.idPregunta,\"estados_asignados.usuario\": args.idUsuario},{\n\t\t\t\t\t\t\t$set:{\"estado\": args.estado,\"estados_asignados.$.estado_asignado\":args.estado,\n\t\t\t\t\t\t\t\t\"estados_asignados.$.observacion\":args.observacion}\n\t\t\t\t\t\t},{new: true}).then(preguntaActualizada => {\n\t\t\t\t\t\t\treturn preguntaActualizada;\n\t\t\t\t\t\t}).catch(errorActualizar => {\n\t\t\t\t\t\t\tthrow new Error(errorActualizar);\n\t\t\t\t\t\t});\n\t\t\t\t\t}else{\n\t\t\t\t\t\tthrow new Error(\"this users is not be able to assign this state to this question\" +\n\t\t\t\t\t\t\t\"because was not assigned \");\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t}).catch(error => {\n\t\t\t\t\tif (error){\n\t\t\t\t\t\tthrow new Error(error);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t},\n\t\ttransferirListaPreguntasDesignadasAUsuario: (parent, args, {models})=>{\n\t\t\treturn models.User.findById(args.idUsuarioDesignado)\n\t\t\t\t.then(usuario => {\n\t\t\t\t\tif(usuario.roles[0].rol === \"comite\"){\n\t\t\t\t\t\treturn models.Pregunta.update({\"estados_asignados.usuario\": args.idUsuarioActivo},{\n\t\t\t\t\t\t\t$set:{\"estados_asignados.$.usuario\":args.idUsuarioDesignado}\n\t\t\t\t\t\t},{multi:true,new:true}).then(actualizada => {\n\t\t\t\t\t\t\tif(actualizada.n >0){\n\t\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t\t}else{\n\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}).catch(error =>{\n\t\t\t\t\t\t\tif(error){\n\t\t\t\t\t\t\t\tthrow new Error(error);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t\t\n\t\t\t\t\t}else{\n\t\t\t\t\t\tthrow new Error(\"only commite member can assigned this questions\");\n\t\t\t\t\t}\n\n\t\t\t\t}).catch(error => {\n\t\t\t\t\tif (error){\n\t\t\t\t\t\tthrow new Error(error);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t}\n\t}\n};\n"]}