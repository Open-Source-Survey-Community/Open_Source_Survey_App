"use strict";

Object.defineProperty(exports, "__esModule", {
	value: true
});
exports.default = {

	Query: {
		verComentario: function verComentario(parent, args, _ref) {
			var models = _ref.models;

			return models.Comentario.findById(args.idComentario).populate("creador_comentario").populate("listaSubComentarios").populate("votacion.usuario_creador").then(function (comentario) {
				return comentario;
			}).catch(function (error) {
				if (error) {
					throw new Error(error);
				}
			});
		},
		verListaSubComentarios: function verListaSubComentarios(parent, args, _ref2) {
			var models = _ref2.models;

			return models.Comentario.findById(args.idComentario, "listaSubComentarios").populate({
				path: "listaSubComentarios",
				populate: {
					path: "creador_comentario",
					model: "usuario"
				}
			}).populate({
				path: "listaSubComentarios",
				populate: {
					path: "votacion.usuario_creador",
					model: "usuario"
				}
			}).then(function (listadocumentos) {
				return listadocumentos.listaSubComentarios;
			}).catch(function (error) {
				throw new Error(error);
			});
		}
	},
	Mutation: {
		crearComentarioAnexadaAPregunta: function crearComentarioAnexadaAPregunta(parent, args, _ref3) {
			var models = _ref3.models;

			return models.Comentario.count().then(function (existenComentariosCreados) {
				if (existenComentariosCreados) {
					args.comentario.identificador = existenComentariosCreados + 1;
				}
				var objetoComentario = new models.Comentario(args.comentario);
				return objetoComentario.save().then(function (comentarioGuardado) {
					return models.Pregunta.findByIdAndUpdate(args.idPregunta, {
						$push: { comentarios: comentarioGuardado }
					}, { new: true }).then(function () {
						return models.Comentario.populate(comentarioGuardado, "creador_comentario");
					}).catch(function (error) {
						throw new Error(error);
					});
				}).catch(function (error) {
					if (error) {
						throw new Error(error);
					}
				});
			}).catch(function (error) {
				throw new Error(error);
			});
		},
		crearComentarioAnexadaADiscusionPregunta: function crearComentarioAnexadaADiscusionPregunta(parent, args, _ref4) {
			var models = _ref4.models;

			return models.Comentario.count().then(function (existenComentariosCreados) {
				if (existenComentariosCreados) {
					args.comentario.identificador = existenComentariosCreados + 1;
				}
				var objetoComentario = new models.Comentario(args.comentario);
				return objetoComentario.save().then(function (comentarioGuardado) {
					return models.discusionPregunta.findByIdAndUpdate(args.idDiscusionPregunta, {
						$push: { comentarios: comentarioGuardado }
					}, { new: true }).then(function () {
						return models.Comentario.populate(comentarioGuardado, "creador_comentario");
					}).catch(function (error) {
						throw new Error(error);
					});
				}).catch(function (error) {
					if (error) {
						throw new Error(error);
					}
				});
			}).catch(function (error) {
				throw new Error(error);
			});
		},
		crearSubComentarioAnexadaAComentario: function crearSubComentarioAnexadaAComentario(parent, args, _ref5) {
			var models = _ref5.models;

			return models.Comentario.count().then(function (existenComentariosCreados) {
				if (existenComentariosCreados) {
					args.comentario.identificador = existenComentariosCreados + 1;
				}
				var objetoComentario = new models.Comentario(args.comentario);
				return objetoComentario.save().then(function (comentarioGuardado) {
					return models.Comentario.findByIdAndUpdate(args.idComentario, {
						$push: { listaSubComentarios: comentarioGuardado }
					}, { new: true }).then(function () {
						return models.Comentario.populate(comentarioGuardado, "creador_comentario");
					}).catch(function (error) {
						throw new Error(error);
					});
				}).catch(function (error) {
					if (error) {
						throw new Error(error);
					}
				});
			}).catch(function (error) {
				throw new Error(error);
			});
		},
		editarComentario: function editarComentario(parent, args, _ref6) {
			var models = _ref6.models;

			return models.Comentario.findById(args.idComentario).then(function (registroComentario) {
				if (registroComentario.creador_comentario == args.idUsuario) {
					return models.Comentario.findByIdAndUpdate(args.idComentario, { $set: { contenido: args.contenido, fecha_actualizacion: new Date() } }, { new: true }).populate("creador_comentario").then(function (comentarioActualizado) {
						return comentarioActualizado;
					}).catch(function (error) {
						throw new Error(error);
					});
				} else {
					throw new Error("this users is not the owner this question");
				}
			}).catch(function (error) {
				if (error) {
					throw new Error(error);
				}
			});
		},
		colocarLikesComentario: function colocarLikesComentario(parent, args, _ref7) {
			var models = _ref7.models;

			return models.Comentario.findOne({ "_id": args.idComentario, "votacion.usuario_creador": args.idUsuario }, { "votacion.$": 1 }).then(function (comentario) {
				if (comentario) {
					if (comentario.votacion[0].like === 1 && comentario.votacion[0].dislike === 0) {
						return models.Comentario.findOneAndUpdate({ "_id": args.idComentario, "votacion.usuario_creador": args.idUsuario }, {
							$set: { "votacion.$.usuario_creador": args.idUsuario, "votacion.$.like": 0 }
						}, { new: true }).then(function () {
							return { like: -1, dislike: 0 };
						}).catch(function (error) {
							if (error) {
								throw new Error(error);
							}
						});
					} else if (comentario.votacion[0].like === 0 && comentario.votacion[0].dislike === 1) {
						return models.Comentario.findOneAndUpdate({ "_id": args.idComentario, "votacion.usuario_creador": args.idUsuario }, {
							$set: { "votacion.$.usuario_creador": args.idUsuario, "votacion.$.like": 1, "votacion.$.dislike": 0 }
						}, { new: true }).then(function () {
							return { like: 1, dislike: -1 };
						}).catch(function (error) {
							if (error) {
								throw new Error(error);
							}
						});
					} else if (comentario.votacion[0].like === 0 && comentario.votacion[0].dislike === 0) {
						return models.Comentario.findOneAndUpdate({ "_id": args.idComentario, "votacion.usuario_creador": args.idUsuario }, {
							$set: { "votacion.$.usuario_creador": args.idUsuario, "votacion.$.like": 1 }
						}, { new: true }).then(function () {
							return { like: 1, dislike: 0 };
						}).catch(function (error) {
							if (error) {
								throw new Error(error);
							}
						});
					}
				} else {
					return models.Comentario.findByIdAndUpdate(args.idComentario, { $push: { "votacion": { "usuario_creador": args.idUsuario, "like": 1, "dislike": 0, "favoritos": 0 } }
					}, { new: true }).then(function () {
						return { like: 1, dislike: 0 };
					}).catch(function (error) {
						if (error) {
							throw new Error(error);
						}
					});
				}
			}).catch(function (error) {
				if (error) {
					throw new Error(error);
				}
			});
		},
		colocarDisLikesComentario: function colocarDisLikesComentario(parent, args, _ref8) {
			var models = _ref8.models;

			return models.Comentario.findOne({ "_id": args.idComentario, "votacion.usuario_creador": args.idUsuario }, { "votacion.$": 1 }).then(function (comentario) {
				if (comentario) {
					if (comentario.votacion[0].like === 0 && comentario.votacion[0].dislike === 1) {
						return models.Comentario.findOneAndUpdate({ "_id": args.idComentario, "votacion.usuario_creador": args.idUsuario }, {
							$set: { "votacion.$.usuario_creador": args.idUsuario, "votacion.$.dislike": 0 }
						}, { new: true }).then(function () {
							return { like: 0, dislike: -1 };
						}).catch(function (error) {
							if (error) {
								throw new Error(error);
							}
						});
					} else if (comentario.votacion[0].like === 1 && comentario.votacion[0].dislike === 0) {
						return models.Comentario.findOneAndUpdate({ "_id": args.idComentario, "votacion.usuario_creador": args.idUsuario }, {
							$set: { "votacion.$.usuario_creador": args.idUsuario, "votacion.$.like": 0, "votacion.$.dislike": 1 }
						}, { new: true }).then(function () {
							return { like: -1, dislike: 1 };
						}).catch(function (error) {
							if (error) {
								throw new Error(error);
							}
						});
					} else if (comentario.votacion[0].like === 0 && comentario.votacion[0].dislike === 0) {
						return models.Comentario.findOneAndUpdate({ "_id": args.idComentario, "votacion.usuario_creador": args.idUsuario }, {
							$set: { "votacion.$.usuario_creador": args.idUsuario, "votacion.$.dislike": 1 }
						}, { new: true }).then(function () {
							return { like: 0, dislike: 1 };
						}).catch(function (error) {
							if (error) {
								throw new Error(error);
							}
						});
					}
				} else {
					return models.Comentario.findByIdAndUpdate(args.idComentario, { $push: { "votacion": { "usuario_creador": args.idUsuario, "like": 0, "dislike": 1, "favoritos": 0 } }
					}, { new: true }).then(function () {
						return { like: 0, dislike: 1 };
					}).catch(function (error) {
						if (error) {
							throw new Error(error);
						}
					});
				}
			}).catch(function (error) {
				if (error) {
					throw new Error(error);
				}
			});
		},
		colocarFavoritosComentario: function colocarFavoritosComentario(parent, args, _ref9) {
			var models = _ref9.models;

			return models.Comentario.findOne({ "_id": args.idComentario, "votacion.usuario_creador": args.idUsuario }, { "votacion.$": 1 }).then(function (comentario) {
				if (comentario) {
					if (comentario.votacion[0].favoritos === 1) {
						return models.Comentario.findOneAndUpdate({ "_id": args.idComentario, "votacion.usuario_creador": args.idUsuario }, {
							$set: { "votacion.$.usuario_creador": args.idUsuario, "votacion.$.favoritos": 0 }
						}, { new: true }).then(function () {
							return 0;
						}).catch(function (error) {
							if (error) {
								throw new Error(error);
							}
						});
					} else if (comentario.votacion[0].favoritos === 0) {
						return models.Comentario.findOneAndUpdate({ "_id": args.idComentario, "votacion.usuario_creador": args.idUsuario }, {
							$set: { "votacion.$.usuario_creador": args.idUsuario, "votacion.$.favoritos": 1 }
						}, { new: true }).then(function () {
							return 1;
						}).catch(function (error) {
							if (error) {
								throw new Error(error);
							}
						});
					}
				} else {
					return models.Comentario.findByIdAndUpdate(args.idComentario, { $push: { "votacion": { "usuario_creador": args.idUsuario, "like": 0, "dislike": 0, "favoritos": 1 } }
					}, { new: true }).populate("votacion.usuario_creador").then(function () {
						return 1;
					}).catch(function (error) {
						if (error) {
							throw new Error(error);
						}
					});
				}
			}).catch(function (error) {
				if (error) {
					throw new Error(error);
				}
			});
		}
	}
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3Jlc29sdmVycy9jb21lbnRhcmlvcy5qcyJdLCJuYW1lcyI6WyJRdWVyeSIsInZlckNvbWVudGFyaW8iLCJwYXJlbnQiLCJhcmdzIiwibW9kZWxzIiwiQ29tZW50YXJpbyIsImZpbmRCeUlkIiwiaWRDb21lbnRhcmlvIiwicG9wdWxhdGUiLCJ0aGVuIiwiY29tZW50YXJpbyIsImNhdGNoIiwiZXJyb3IiLCJFcnJvciIsInZlckxpc3RhU3ViQ29tZW50YXJpb3MiLCJwYXRoIiwibW9kZWwiLCJsaXN0YWRvY3VtZW50b3MiLCJsaXN0YVN1YkNvbWVudGFyaW9zIiwiTXV0YXRpb24iLCJjcmVhckNvbWVudGFyaW9BbmV4YWRhQVByZWd1bnRhIiwiY291bnQiLCJleGlzdGVuQ29tZW50YXJpb3NDcmVhZG9zIiwiaWRlbnRpZmljYWRvciIsIm9iamV0b0NvbWVudGFyaW8iLCJzYXZlIiwiUHJlZ3VudGEiLCJmaW5kQnlJZEFuZFVwZGF0ZSIsImlkUHJlZ3VudGEiLCIkcHVzaCIsImNvbWVudGFyaW9zIiwiY29tZW50YXJpb0d1YXJkYWRvIiwibmV3IiwiY3JlYXJDb21lbnRhcmlvQW5leGFkYUFEaXNjdXNpb25QcmVndW50YSIsImRpc2N1c2lvblByZWd1bnRhIiwiaWREaXNjdXNpb25QcmVndW50YSIsImNyZWFyU3ViQ29tZW50YXJpb0FuZXhhZGFBQ29tZW50YXJpbyIsImVkaXRhckNvbWVudGFyaW8iLCJyZWdpc3Ryb0NvbWVudGFyaW8iLCJjcmVhZG9yX2NvbWVudGFyaW8iLCJpZFVzdWFyaW8iLCIkc2V0IiwiY29udGVuaWRvIiwiZmVjaGFfYWN0dWFsaXphY2lvbiIsIkRhdGUiLCJjb21lbnRhcmlvQWN0dWFsaXphZG8iLCJjb2xvY2FyTGlrZXNDb21lbnRhcmlvIiwiZmluZE9uZSIsInZvdGFjaW9uIiwibGlrZSIsImRpc2xpa2UiLCJmaW5kT25lQW5kVXBkYXRlIiwiY29sb2NhckRpc0xpa2VzQ29tZW50YXJpbyIsImNvbG9jYXJGYXZvcml0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QUFNLElBQUlDLEtBQUosQ0FBVUQsS0FBVixDQUFOO0FBQ0E7QUFDRCxPQVRLLENBQVA7QUFVQTtBQUVELEtBMUJELE1BMEJLO0FBQ0osWUFBT1IsT0FBT0MsVUFBUCxDQUFrQnNCLGlCQUFsQixDQUFvQ3hCLEtBQUtJLFlBQXpDLEVBQ04sRUFBQ3NCLE9BQU0sRUFBQyxZQUFXLEVBQUMsbUJBQW1CMUIsS0FBS3FDLFNBQXpCLEVBQW9DLFFBQU8sQ0FBM0MsRUFBOEMsV0FBVSxDQUF4RCxFQUEyRCxhQUFZLENBQXZFLEVBQVo7QUFBUCxNQURNLEVBRUosRUFBQ1IsS0FBSyxJQUFOLEVBRkksRUFHTHhCLFFBSEssQ0FHSSwwQkFISixFQUlMQyxJQUpLLENBSUEsWUFBTTtBQUNYLGFBQU8sQ0FBUDtBQUNBLE1BTkssRUFNSEUsS0FORyxDQU1HLGlCQUFTO0FBQ2pCLFVBQUdDLEtBQUgsRUFBUztBQUNSLGFBQU0sSUFBSUMsS0FBSixDQUFVRCxLQUFWLENBQU47QUFDQTtBQUNELE1BVkssQ0FBUDtBQVdBO0FBQ0QsSUF6Q0ssRUF5Q0hELEtBekNHLENBeUNHLGlCQUFTO0FBQ2pCLFFBQUlDLEtBQUosRUFBVTtBQUNULFdBQU0sSUFBSUMsS0FBSixDQUFVRCxLQUFWLENBQU47QUFDQTtBQUNELElBN0NLLENBQVA7QUE4Q0E7QUF6UU87QUF2Q0ssQyIsImZpbGUiOiJjb21lbnRhcmlvcy5qcyIsInNvdXJjZXNDb250ZW50IjpbImV4cG9ydCBkZWZhdWx0IHtcblxuXHRRdWVyeTp7XG5cdFx0dmVyQ29tZW50YXJpbzogKHBhcmVudCwgYXJncywge21vZGVsc30pPT57XG5cdFx0XHRyZXR1cm4gbW9kZWxzLkNvbWVudGFyaW8uZmluZEJ5SWQoYXJncy5pZENvbWVudGFyaW8pXG5cdFx0XHRcdC5wb3B1bGF0ZShcImNyZWFkb3JfY29tZW50YXJpb1wiKVxuXHRcdFx0XHQucG9wdWxhdGUoXCJsaXN0YVN1YkNvbWVudGFyaW9zXCIpXG5cdFx0XHRcdC5wb3B1bGF0ZShcInZvdGFjaW9uLnVzdWFyaW9fY3JlYWRvclwiKVxuXHRcdFx0XHQudGhlbihjb21lbnRhcmlvID0+IHtcblx0XHRcdFx0XHRyZXR1cm4gY29tZW50YXJpbztcblx0XHRcdFx0fSkuY2F0Y2goZXJyb3IgPT57XG5cdFx0XHRcdFx0aWYgKGVycm9yKXtcblx0XHRcdFx0XHRcdHRocm93IG5ldyBFcnJvcihlcnJvcik7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9KTtcblx0XHR9LFxuICAgICAgICB2ZXJMaXN0YVN1YkNvbWVudGFyaW9zOiAocGFyZW50LCBhcmdzLCB7bW9kZWxzfSk9Pntcblx0XHRcdHJldHVybiBtb2RlbHMuQ29tZW50YXJpby5maW5kQnlJZChhcmdzLmlkQ29tZW50YXJpbywgXCJsaXN0YVN1YkNvbWVudGFyaW9zXCIpXG5cdFx0XHRcdC5wb3B1bGF0ZSh7XG5cdFx0XHRcdFx0cGF0aDpcImxpc3RhU3ViQ29tZW50YXJpb3NcIixcblx0XHRcdFx0XHRwb3B1bGF0ZTp7XG5cdFx0XHRcdFx0XHRwYXRoOlwiY3JlYWRvcl9jb21lbnRhcmlvXCIsXG5cdFx0XHRcdFx0XHRtb2RlbDpcInVzdWFyaW9cIlxuXHRcdFx0XHRcdH1cblx0XHRcdFx0fSlcblx0XHRcdFx0LnBvcHVsYXRlKHtcblx0XHRcdFx0XHRwYXRoOlwibGlzdGFTdWJDb21lbnRhcmlvc1wiLFxuXHRcdFx0XHRcdHBvcHVsYXRlOntcblx0XHRcdFx0XHRcdHBhdGg6XCJ2b3RhY2lvbi51c3VhcmlvX2NyZWFkb3JcIixcblx0XHRcdFx0XHRcdG1vZGVsOlwidXN1YXJpb1wiXG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9KVxuXHRcdFx0XHQudGhlbihsaXN0YWRvY3VtZW50b3MgPT57XG5cdFx0XHRcdFx0cmV0dXJuIGxpc3RhZG9jdW1lbnRvcy5saXN0YVN1YkNvbWVudGFyaW9zO1xuXHRcdFx0XHR9KS5jYXRjaChlcnJvciA9Pntcblx0XHRcdFx0XHR0aHJvdyBuZXcgRXJyb3IoZXJyb3IpO1xuXHRcdFx0XHR9KTtcblx0XHR9XG5cdH0sXG5cdE11dGF0aW9uOntcblx0XHRjcmVhckNvbWVudGFyaW9BbmV4YWRhQVByZWd1bnRhOiAocGFyZW50LCBhcmdzLCB7bW9kZWxzfSk9Pntcblx0XHRcdHJldHVybiBtb2RlbHMuQ29tZW50YXJpby5jb3VudCgpXG5cdFx0XHRcdC50aGVuKGV4aXN0ZW5Db21lbnRhcmlvc0NyZWFkb3MgPT4ge1xuXHRcdFx0XHRcdGlmIChleGlzdGVuQ29tZW50YXJpb3NDcmVhZG9zKXtcblx0XHRcdFx0XHRcdGFyZ3MuY29tZW50YXJpby5pZGVudGlmaWNhZG9yID0gZXhpc3RlbkNvbWVudGFyaW9zQ3JlYWRvcyArIDE7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdGNvbnN0IG9iamV0b0NvbWVudGFyaW8gPSBuZXcgbW9kZWxzLkNvbWVudGFyaW8oYXJncy5jb21lbnRhcmlvKTtcblx0XHRcdFx0XHRyZXR1cm4gb2JqZXRvQ29tZW50YXJpby5zYXZlKClcblx0XHRcdFx0XHRcdC50aGVuKGNvbWVudGFyaW9HdWFyZGFkbyA9PiB7XG5cdFx0XHRcdFx0XHRcdHJldHVybiBtb2RlbHMuUHJlZ3VudGEuZmluZEJ5SWRBbmRVcGRhdGUoYXJncy5pZFByZWd1bnRhLHtcblx0XHRcdFx0XHRcdFx0XHQkcHVzaDp7Y29tZW50YXJpb3M6Y29tZW50YXJpb0d1YXJkYWRvfVxuXHRcdFx0XHRcdFx0XHR9LHtuZXc6dHJ1ZX0pXG5cdFx0XHRcdFx0XHRcdFx0LnRoZW4oKCkgPT4ge1xuXHRcdFx0XHRcdFx0XHRcdFx0cmV0dXJuIG1vZGVscy5Db21lbnRhcmlvLnBvcHVsYXRlKGNvbWVudGFyaW9HdWFyZGFkbyxcImNyZWFkb3JfY29tZW50YXJpb1wiKTtcblx0XHRcdFx0XHRcdFx0XHR9KS5jYXRjaChlcnJvciA9PiB7XG5cdFx0XHRcdFx0XHRcdFx0XHR0aHJvdyBuZXcgRXJyb3IoZXJyb3IpO1xuXHRcdFx0XHRcdFx0XHRcdH0pO1xuXHRcdFx0XHRcdFx0fSkuY2F0Y2goZXJyb3IgPT4ge1xuXHRcdFx0XHRcdFx0XHRpZiAoZXJyb3Ipe1xuXHRcdFx0XHRcdFx0XHRcdHRocm93IG5ldyBFcnJvcihlcnJvcik7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9KS5jYXRjaChlcnJvciA9PiB7XG5cdFx0XHRcdFx0dGhyb3cgbmV3IEVycm9yKGVycm9yKTtcblx0XHRcdFx0fSk7XG5cdFx0fSxcblx0XHRjcmVhckNvbWVudGFyaW9BbmV4YWRhQURpc2N1c2lvblByZWd1bnRhOiAocGFyZW50LCBhcmdzLCB7bW9kZWxzfSk9Pntcblx0XHRcdHJldHVybiBtb2RlbHMuQ29tZW50YXJpby5jb3VudCgpXG5cdFx0XHRcdC50aGVuKGV4aXN0ZW5Db21lbnRhcmlvc0NyZWFkb3MgPT4ge1xuXHRcdFx0XHRcdGlmIChleGlzdGVuQ29tZW50YXJpb3NDcmVhZG9zKXtcblx0XHRcdFx0XHRcdGFyZ3MuY29tZW50YXJpby5pZGVudGlmaWNhZG9yID0gZXhpc3RlbkNvbWVudGFyaW9zQ3JlYWRvcyArIDE7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdGNvbnN0IG9iamV0b0NvbWVudGFyaW8gPSBuZXcgbW9kZWxzLkNvbWVudGFyaW8oYXJncy5jb21lbnRhcmlvKTtcblx0XHRcdFx0XHRyZXR1cm4gb2JqZXRvQ29tZW50YXJpby5zYXZlKClcblx0XHRcdFx0XHRcdC50aGVuKGNvbWVudGFyaW9HdWFyZGFkbyA9PiB7XG5cdFx0XHRcdFx0XHRcdHJldHVybiBtb2RlbHMuZGlzY3VzaW9uUHJlZ3VudGEuZmluZEJ5SWRBbmRVcGRhdGUoYXJncy5pZERpc2N1c2lvblByZWd1bnRhLHtcblx0XHRcdFx0XHRcdFx0XHQkcHVzaDp7Y29tZW50YXJpb3M6Y29tZW50YXJpb0d1YXJkYWRvfVxuXHRcdFx0XHRcdFx0XHR9LHtuZXc6dHJ1ZX0pXG5cdFx0XHRcdFx0XHRcdFx0LnRoZW4oKCkgPT4ge1xuXHRcdFx0XHRcdFx0XHRcdFx0cmV0dXJuIG1vZGVscy5Db21lbnRhcmlvLnBvcHVsYXRlKGNvbWVudGFyaW9HdWFyZGFkbyxcImNyZWFkb3JfY29tZW50YXJpb1wiKTtcblx0XHRcdFx0XHRcdFx0XHR9KS5jYXRjaChlcnJvciA9PiB7XG5cdFx0XHRcdFx0XHRcdFx0XHR0aHJvdyBuZXcgRXJyb3IoZXJyb3IpO1xuXHRcdFx0XHRcdFx0XHRcdH0pO1xuXHRcdFx0XHRcdFx0fSkuY2F0Y2goZXJyb3IgPT4ge1xuXHRcdFx0XHRcdFx0XHRpZiAoZXJyb3Ipe1xuXHRcdFx0XHRcdFx0XHRcdHRocm93IG5ldyBFcnJvcihlcnJvcik7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9KS5jYXRjaChlcnJvciA9PiB7XG5cdFx0XHRcdFx0dGhyb3cgbmV3IEVycm9yKGVycm9yKTtcblx0XHRcdFx0fSk7XG5cdFx0fSxcblx0XHRjcmVhclN1YkNvbWVudGFyaW9BbmV4YWRhQUNvbWVudGFyaW86IChwYXJlbnQsIGFyZ3MsIHttb2RlbHN9KT0+e1xuXHRcdFx0cmV0dXJuIG1vZGVscy5Db21lbnRhcmlvLmNvdW50KClcblx0XHRcdFx0LnRoZW4oZXhpc3RlbkNvbWVudGFyaW9zQ3JlYWRvcyA9PiB7XG5cdFx0XHRcdFx0aWYgKGV4aXN0ZW5Db21lbnRhcmlvc0NyZWFkb3Mpe1xuXHRcdFx0XHRcdFx0YXJncy5jb21lbnRhcmlvLmlkZW50aWZpY2Fkb3IgPSBleGlzdGVuQ29tZW50YXJpb3NDcmVhZG9zICsgMTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0Y29uc3Qgb2JqZXRvQ29tZW50YXJpbyA9IG5ldyBtb2RlbHMuQ29tZW50YXJpbyhhcmdzLmNvbWVudGFyaW8pO1xuXHRcdFx0XHRcdHJldHVybiBvYmpldG9Db21lbnRhcmlvLnNhdmUoKVxuXHRcdFx0XHRcdFx0LnRoZW4oY29tZW50YXJpb0d1YXJkYWRvID0+IHtcblx0XHRcdFx0XHRcdFx0cmV0dXJuIG1vZGVscy5Db21lbnRhcmlvLmZpbmRCeUlkQW5kVXBkYXRlKGFyZ3MuaWRDb21lbnRhcmlvLHtcblx0XHRcdFx0XHRcdFx0XHQkcHVzaDp7bGlzdGFTdWJDb21lbnRhcmlvczpjb21lbnRhcmlvR3VhcmRhZG99XG5cdFx0XHRcdFx0XHRcdH0se25ldzp0cnVlfSlcblx0XHRcdFx0XHRcdFx0XHQudGhlbigoKSA9PiB7XG5cdFx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gbW9kZWxzLkNvbWVudGFyaW8ucG9wdWxhdGUoY29tZW50YXJpb0d1YXJkYWRvLFwiY3JlYWRvcl9jb21lbnRhcmlvXCIpO1xuXHRcdFx0XHRcdFx0XHRcdH0pLmNhdGNoKGVycm9yID0+IHtcblx0XHRcdFx0XHRcdFx0XHRcdHRocm93IG5ldyBFcnJvcihlcnJvcik7XG5cdFx0XHRcdFx0XHRcdFx0fSk7XG5cdFx0XHRcdFx0XHR9KS5jYXRjaChlcnJvciA9PiB7XG5cdFx0XHRcdFx0XHRcdGlmIChlcnJvcil7XG5cdFx0XHRcdFx0XHRcdFx0dGhyb3cgbmV3IEVycm9yKGVycm9yKTtcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH0pLmNhdGNoKGVycm9yID0+IHtcblx0XHRcdFx0XHR0aHJvdyBuZXcgRXJyb3IoZXJyb3IpO1xuXHRcdFx0XHR9KTtcblx0XHR9LFxuXHRcdGVkaXRhckNvbWVudGFyaW86IChwYXJlbnQsIGFyZ3MsIHttb2RlbHN9KSA9PiB7XG5cdFx0XHRyZXR1cm4gbW9kZWxzLkNvbWVudGFyaW8uZmluZEJ5SWQoYXJncy5pZENvbWVudGFyaW8pXG5cdFx0XHRcdC50aGVuKHJlZ2lzdHJvQ29tZW50YXJpbyA9PiB7XG5cdFx0XHRcdFx0aWYgKHJlZ2lzdHJvQ29tZW50YXJpby5jcmVhZG9yX2NvbWVudGFyaW8gPT0gYXJncy5pZFVzdWFyaW8pe1xuXHRcdFx0XHRcdFx0cmV0dXJuIG1vZGVscy5Db21lbnRhcmlvLmZpbmRCeUlkQW5kVXBkYXRlKGFyZ3MuaWRDb21lbnRhcmlvLFxuXHRcdFx0XHRcdFx0XHR7JHNldDp7Y29udGVuaWRvOiBhcmdzLmNvbnRlbmlkbyxmZWNoYV9hY3R1YWxpemFjaW9uOiBuZXcgRGF0ZX19LFxuXHRcdFx0XHRcdFx0XHR7bmV3OiB0cnVlfSlcblx0XHRcdFx0XHRcdFx0LnBvcHVsYXRlKFwiY3JlYWRvcl9jb21lbnRhcmlvXCIpXG5cdFx0XHRcdFx0XHRcdC50aGVuKGNvbWVudGFyaW9BY3R1YWxpemFkbz0+e1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiBjb21lbnRhcmlvQWN0dWFsaXphZG87XG5cdFx0XHRcdFx0XHRcdH0pLmNhdGNoKGVycm9yID0+IHtcblx0XHRcdFx0XHRcdFx0XHR0aHJvdyBuZXcgRXJyb3IoZXJyb3IpO1xuXHRcdFx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHR9ZWxzZXtcblx0XHRcdFx0XHRcdHRocm93IG5ldyBFcnJvcihcInRoaXMgdXNlcnMgaXMgbm90IHRoZSBvd25lciB0aGlzIHF1ZXN0aW9uXCIpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fSkuY2F0Y2goZXJyb3IgPT4ge1xuXHRcdFx0XHRcdGlmIChlcnJvcil7XG5cdFx0XHRcdFx0XHR0aHJvdyBuZXcgRXJyb3IoZXJyb3IpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fSk7XG5cblx0XHR9LFxuXHRcdGNvbG9jYXJMaWtlc0NvbWVudGFyaW86IChwYXJlbnQsIGFyZ3MsIHttb2RlbHN9KT0+e1xuXHRcdFx0cmV0dXJuIG1vZGVscy5Db21lbnRhcmlvLmZpbmRPbmUoe1wiX2lkXCI6IGFyZ3MuaWRDb21lbnRhcmlvLCBcInZvdGFjaW9uLnVzdWFyaW9fY3JlYWRvclwiOiBhcmdzLmlkVXN1YXJpb30se1widm90YWNpb24uJFwiOjF9KVxuXHRcdFx0XHQudGhlbihjb21lbnRhcmlvID0+IHtcblx0XHRcdFx0XHRpZihjb21lbnRhcmlvKXtcblx0XHRcdFx0XHRcdGlmKGNvbWVudGFyaW8udm90YWNpb25bMF0ubGlrZSA9PT0gMSAmJiBjb21lbnRhcmlvLnZvdGFjaW9uWzBdLmRpc2xpa2UgPT09IDApe1xuXHRcdFx0XHRcdFx0XHRyZXR1cm4gbW9kZWxzLkNvbWVudGFyaW8uZmluZE9uZUFuZFVwZGF0ZSh7XCJfaWRcIjphcmdzLmlkQ29tZW50YXJpbyxcInZvdGFjaW9uLnVzdWFyaW9fY3JlYWRvclwiOiBhcmdzLmlkVXN1YXJpb30se1xuXHRcdFx0XHRcdFx0XHRcdCRzZXQ6e1widm90YWNpb24uJC51c3VhcmlvX2NyZWFkb3JcIjogYXJncy5pZFVzdWFyaW8sIFwidm90YWNpb24uJC5saWtlXCI6MH1cblx0XHRcdFx0XHRcdFx0fSx7bmV3OiB0cnVlfSlcblx0XHRcdFx0XHRcdFx0XHQudGhlbigoKSA9PiB7XG5cdFx0XHRcdFx0XHRcdFx0XHRyZXR1cm4ge2xpa2U6LTEsIGRpc2xpa2U6MH07XG5cdFx0XHRcdFx0XHRcdFx0fSkuY2F0Y2goZXJyb3IgPT4ge1xuXHRcdFx0XHRcdFx0XHRcdFx0aWYoZXJyb3Ipe1xuXHRcdFx0XHRcdFx0XHRcdFx0XHR0aHJvdyBuZXcgRXJyb3IoZXJyb3IpO1xuXHRcdFx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHRcdH0pO1xuXG5cdFx0XHRcdFx0XHR9ZWxzZSBpZihjb21lbnRhcmlvLnZvdGFjaW9uWzBdLmxpa2UgPT09IDAgJiYgY29tZW50YXJpby52b3RhY2lvblswXS5kaXNsaWtlID09PSAxKXtcblx0XHRcdFx0XHRcdFx0cmV0dXJuIG1vZGVscy5Db21lbnRhcmlvLmZpbmRPbmVBbmRVcGRhdGUoe1wiX2lkXCI6YXJncy5pZENvbWVudGFyaW8sXCJ2b3RhY2lvbi51c3VhcmlvX2NyZWFkb3JcIjogYXJncy5pZFVzdWFyaW99LHtcblx0XHRcdFx0XHRcdFx0XHQkc2V0OntcInZvdGFjaW9uLiQudXN1YXJpb19jcmVhZG9yXCI6IGFyZ3MuaWRVc3VhcmlvLCBcInZvdGFjaW9uLiQubGlrZVwiOjEsXCJ2b3RhY2lvbi4kLmRpc2xpa2VcIjowfVxuXHRcdFx0XHRcdFx0XHR9LHtuZXc6IHRydWV9KVxuXHRcdFx0XHRcdFx0XHRcdC50aGVuKCgpID0+IHtcblx0XHRcdFx0XHRcdFx0XHRcdHJldHVybiB7bGlrZToxLCBkaXNsaWtlOi0xfTtcblx0XHRcdFx0XHRcdFx0XHR9KS5jYXRjaChlcnJvciA9PiB7XG5cdFx0XHRcdFx0XHRcdFx0XHRpZihlcnJvcil7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdHRocm93IG5ldyBFcnJvcihlcnJvcik7XG5cdFx0XHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdFx0fSk7XG5cdFx0XHRcdFx0XHR9ZWxzZSBpZihjb21lbnRhcmlvLnZvdGFjaW9uWzBdLmxpa2UgPT09IDAgJiYgY29tZW50YXJpby52b3RhY2lvblswXS5kaXNsaWtlID09PSAwKXtcblx0XHRcdFx0XHRcdFx0cmV0dXJuIG1vZGVscy5Db21lbnRhcmlvLmZpbmRPbmVBbmRVcGRhdGUoe1wiX2lkXCI6YXJncy5pZENvbWVudGFyaW8sXCJ2b3RhY2lvbi51c3VhcmlvX2NyZWFkb3JcIjogYXJncy5pZFVzdWFyaW99LHtcblx0XHRcdFx0XHRcdFx0XHQkc2V0OntcInZvdGFjaW9uLiQudXN1YXJpb19jcmVhZG9yXCI6IGFyZ3MuaWRVc3VhcmlvLCBcInZvdGFjaW9uLiQubGlrZVwiOjF9XG5cdFx0XHRcdFx0XHRcdH0se25ldzogdHJ1ZX0pXG5cdFx0XHRcdFx0XHRcdFx0LnRoZW4oKCkgPT4ge1xuXHRcdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHtsaWtlOjEsIGRpc2xpa2U6MH07XG5cdFx0XHRcdFx0XHRcdFx0fSkuY2F0Y2goZXJyb3IgPT4ge1xuXHRcdFx0XHRcdFx0XHRcdFx0aWYoZXJyb3Ipe1xuXHRcdFx0XHRcdFx0XHRcdFx0XHR0aHJvdyBuZXcgRXJyb3IoZXJyb3IpO1xuXHRcdFx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHRcdH0pO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0fWVsc2V7XG5cdFx0XHRcdFx0XHRyZXR1cm4gbW9kZWxzLkNvbWVudGFyaW8uZmluZEJ5SWRBbmRVcGRhdGUoYXJncy5pZENvbWVudGFyaW8sXG5cdFx0XHRcdFx0XHRcdHskcHVzaDp7XCJ2b3RhY2lvblwiOntcInVzdWFyaW9fY3JlYWRvclwiOiBhcmdzLmlkVXN1YXJpbywgXCJsaWtlXCI6MSwgXCJkaXNsaWtlXCI6MCwgXCJmYXZvcml0b3NcIjowfX1cblx0XHRcdFx0XHRcdFx0fSx7bmV3OiB0cnVlfSlcblx0XHRcdFx0XHRcdFx0LnRoZW4oKCkgPT4ge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiB7bGlrZToxLCBkaXNsaWtlOjB9O1xuXHRcdFx0XHRcdFx0XHR9KS5jYXRjaChlcnJvciA9PiB7XG5cdFx0XHRcdFx0XHRcdFx0aWYoZXJyb3Ipe1xuXHRcdFx0XHRcdFx0XHRcdFx0dGhyb3cgbmV3IEVycm9yKGVycm9yKTtcblx0XHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdH0pO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fSkuY2F0Y2goZXJyb3IgPT4ge1xuXHRcdFx0XHRcdGlmIChlcnJvcil7XG5cdFx0XHRcdFx0XHR0aHJvdyBuZXcgRXJyb3IoZXJyb3IpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fSk7XG5cdFx0fSxcblx0XHRjb2xvY2FyRGlzTGlrZXNDb21lbnRhcmlvOiAocGFyZW50LCBhcmdzLCB7bW9kZWxzfSk9Pntcblx0XHRcdHJldHVybiBtb2RlbHMuQ29tZW50YXJpby5maW5kT25lKHtcIl9pZFwiOiBhcmdzLmlkQ29tZW50YXJpbywgXCJ2b3RhY2lvbi51c3VhcmlvX2NyZWFkb3JcIjogYXJncy5pZFVzdWFyaW99LHtcInZvdGFjaW9uLiRcIjoxfSlcblx0XHRcdFx0LnRoZW4oY29tZW50YXJpbyA9PiB7XG5cdFx0XHRcdFx0aWYoY29tZW50YXJpbyl7XG5cdFx0XHRcdFx0XHRpZihjb21lbnRhcmlvLnZvdGFjaW9uWzBdLmxpa2UgPT09IDAgJiYgY29tZW50YXJpby52b3RhY2lvblswXS5kaXNsaWtlID09PSAxKXtcblx0XHRcdFx0XHRcdFx0cmV0dXJuIG1vZGVscy5Db21lbnRhcmlvLmZpbmRPbmVBbmRVcGRhdGUoe1wiX2lkXCI6YXJncy5pZENvbWVudGFyaW8sXCJ2b3RhY2lvbi51c3VhcmlvX2NyZWFkb3JcIjogYXJncy5pZFVzdWFyaW99LHtcblx0XHRcdFx0XHRcdFx0XHQkc2V0OntcInZvdGFjaW9uLiQudXN1YXJpb19jcmVhZG9yXCI6IGFyZ3MuaWRVc3VhcmlvLCBcInZvdGFjaW9uLiQuZGlzbGlrZVwiOjB9XG5cdFx0XHRcdFx0XHRcdH0se25ldzogdHJ1ZX0pXG5cdFx0XHRcdFx0XHRcdFx0LnRoZW4oKCkgPT4ge1xuXHRcdFx0XHRcdFx0XHRcdFx0cmV0dXJuIHtsaWtlOjAsIGRpc2xpa2U6LTF9O1xuXHRcdFx0XHRcdFx0XHRcdH0pLmNhdGNoKGVycm9yID0+IHtcblx0XHRcdFx0XHRcdFx0XHRcdGlmKGVycm9yKXtcblx0XHRcdFx0XHRcdFx0XHRcdFx0dGhyb3cgbmV3IEVycm9yKGVycm9yKTtcblx0XHRcdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0XHR9KTtcblxuXHRcdFx0XHRcdFx0fWVsc2UgaWYoY29tZW50YXJpby52b3RhY2lvblswXS5saWtlID09PSAxICYmIGNvbWVudGFyaW8udm90YWNpb25bMF0uZGlzbGlrZSA9PT0gMCl7XG5cdFx0XHRcdFx0XHRcdHJldHVybiBtb2RlbHMuQ29tZW50YXJpby5maW5kT25lQW5kVXBkYXRlKHtcIl9pZFwiOmFyZ3MuaWRDb21lbnRhcmlvLFwidm90YWNpb24udXN1YXJpb19jcmVhZG9yXCI6IGFyZ3MuaWRVc3VhcmlvfSx7XG5cdFx0XHRcdFx0XHRcdFx0JHNldDp7XCJ2b3RhY2lvbi4kLnVzdWFyaW9fY3JlYWRvclwiOiBhcmdzLmlkVXN1YXJpbywgXCJ2b3RhY2lvbi4kLmxpa2VcIjowLFwidm90YWNpb24uJC5kaXNsaWtlXCI6MX1cblx0XHRcdFx0XHRcdFx0fSx7bmV3OiB0cnVlfSlcblx0XHRcdFx0XHRcdFx0XHQudGhlbigoKSA9PiB7XG5cdFx0XHRcdFx0XHRcdFx0XHRyZXR1cm4ge2xpa2U6LTEsIGRpc2xpa2U6MX07XG5cdFx0XHRcdFx0XHRcdFx0fSkuY2F0Y2goZXJyb3IgPT4ge1xuXHRcdFx0XHRcdFx0XHRcdFx0aWYoZXJyb3Ipe1xuXHRcdFx0XHRcdFx0XHRcdFx0XHR0aHJvdyBuZXcgRXJyb3IoZXJyb3IpO1xuXHRcdFx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHRcdH0pO1xuXHRcdFx0XHRcdFx0fWVsc2UgaWYoY29tZW50YXJpby52b3RhY2lvblswXS5saWtlID09PSAwICYmIGNvbWVudGFyaW8udm90YWNpb25bMF0uZGlzbGlrZSA9PT0gMCl7XG5cdFx0XHRcdFx0XHRcdHJldHVybiBtb2RlbHMuQ29tZW50YXJpby5maW5kT25lQW5kVXBkYXRlKHtcIl9pZFwiOmFyZ3MuaWRDb21lbnRhcmlvLFwidm90YWNpb24udXN1YXJpb19jcmVhZG9yXCI6IGFyZ3MuaWRVc3VhcmlvfSx7XG5cdFx0XHRcdFx0XHRcdFx0JHNldDp7XCJ2b3RhY2lvbi4kLnVzdWFyaW9fY3JlYWRvclwiOiBhcmdzLmlkVXN1YXJpbywgXCJ2b3RhY2lvbi4kLmRpc2xpa2VcIjoxfVxuXHRcdFx0XHRcdFx0XHR9LHtuZXc6IHRydWV9KVxuXHRcdFx0XHRcdFx0XHRcdC50aGVuKCgpID0+IHtcblx0XHRcdFx0XHRcdFx0XHRcdHJldHVybiB7bGlrZTowLCBkaXNsaWtlOjF9O1xuXHRcdFx0XHRcdFx0XHRcdH0pLmNhdGNoKGVycm9yID0+IHtcblx0XHRcdFx0XHRcdFx0XHRcdGlmKGVycm9yKXtcblx0XHRcdFx0XHRcdFx0XHRcdFx0dGhyb3cgbmV3IEVycm9yKGVycm9yKTtcblx0XHRcdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdH1lbHNle1xuXHRcdFx0XHRcdFx0cmV0dXJuIG1vZGVscy5Db21lbnRhcmlvLmZpbmRCeUlkQW5kVXBkYXRlKGFyZ3MuaWRDb21lbnRhcmlvLFxuXHRcdFx0XHRcdFx0XHR7JHB1c2g6e1widm90YWNpb25cIjp7XCJ1c3VhcmlvX2NyZWFkb3JcIjogYXJncy5pZFVzdWFyaW8sIFwibGlrZVwiOjAsIFwiZGlzbGlrZVwiOjEsIFwiZmF2b3JpdG9zXCI6MH19XG5cdFx0XHRcdFx0XHRcdH0se25ldzogdHJ1ZX0pXG5cdFx0XHRcdFx0XHRcdC50aGVuKCgpID0+IHtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4ge2xpa2U6MCwgZGlzbGlrZToxfTtcblx0XHRcdFx0XHRcdFx0fSkuY2F0Y2goZXJyb3IgPT4ge1xuXHRcdFx0XHRcdFx0XHRcdGlmKGVycm9yKXtcblx0XHRcdFx0XHRcdFx0XHRcdHRocm93IG5ldyBFcnJvcihlcnJvcik7XG5cdFx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH0pLmNhdGNoKGVycm9yID0+IHtcblx0XHRcdFx0XHRpZiAoZXJyb3Ipe1xuXHRcdFx0XHRcdFx0dGhyb3cgbmV3IEVycm9yKGVycm9yKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH0pO1xuXHRcdH0sXG5cdFx0Y29sb2NhckZhdm9yaXRvc0NvbWVudGFyaW86IChwYXJlbnQsIGFyZ3MsIHttb2RlbHN9KT0+e1xuXHRcdFx0cmV0dXJuIG1vZGVscy5Db21lbnRhcmlvLmZpbmRPbmUoe1wiX2lkXCI6IGFyZ3MuaWRDb21lbnRhcmlvLCBcInZvdGFjaW9uLnVzdWFyaW9fY3JlYWRvclwiOiBhcmdzLmlkVXN1YXJpb30se1widm90YWNpb24uJFwiOjF9KVxuXHRcdFx0XHQudGhlbihjb21lbnRhcmlvID0+IHtcblx0XHRcdFx0XHRpZihjb21lbnRhcmlvKXtcblx0XHRcdFx0XHRcdGlmKGNvbWVudGFyaW8udm90YWNpb25bMF0uZmF2b3JpdG9zID09PSAxKXtcblx0XHRcdFx0XHRcdFx0cmV0dXJuIG1vZGVscy5Db21lbnRhcmlvLmZpbmRPbmVBbmRVcGRhdGUoe1wiX2lkXCI6YXJncy5pZENvbWVudGFyaW8sXCJ2b3RhY2lvbi51c3VhcmlvX2NyZWFkb3JcIjogYXJncy5pZFVzdWFyaW99LHtcblx0XHRcdFx0XHRcdFx0XHQkc2V0OntcInZvdGFjaW9uLiQudXN1YXJpb19jcmVhZG9yXCI6IGFyZ3MuaWRVc3VhcmlvLCBcInZvdGFjaW9uLiQuZmF2b3JpdG9zXCI6MH1cblx0XHRcdFx0XHRcdFx0fSx7bmV3OiB0cnVlfSlcblx0XHRcdFx0XHRcdFx0XHQudGhlbigoKSA9PiB7XG5cdFx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gMDtcblx0XHRcdFx0XHRcdFx0XHR9KS5jYXRjaChlcnJvciA9PiB7XG5cdFx0XHRcdFx0XHRcdFx0XHRpZihlcnJvcil7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdHRocm93IG5ldyBFcnJvcihlcnJvcik7XG5cdFx0XHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdFx0fSk7XG5cblx0XHRcdFx0XHRcdH1lbHNlIGlmKGNvbWVudGFyaW8udm90YWNpb25bMF0uZmF2b3JpdG9zID09PSAwKXtcblx0XHRcdFx0XHRcdFx0cmV0dXJuIG1vZGVscy5Db21lbnRhcmlvLmZpbmRPbmVBbmRVcGRhdGUoe1wiX2lkXCI6YXJncy5pZENvbWVudGFyaW8sXCJ2b3RhY2lvbi51c3VhcmlvX2NyZWFkb3JcIjogYXJncy5pZFVzdWFyaW99LHtcblx0XHRcdFx0XHRcdFx0XHQkc2V0OntcInZvdGFjaW9uLiQudXN1YXJpb19jcmVhZG9yXCI6IGFyZ3MuaWRVc3VhcmlvLCBcInZvdGFjaW9uLiQuZmF2b3JpdG9zXCI6MX1cblx0XHRcdFx0XHRcdFx0fSx7bmV3OiB0cnVlfSlcblx0XHRcdFx0XHRcdFx0XHQudGhlbigoKSA9PiB7XG5cdFx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gMTtcblx0XHRcdFx0XHRcdFx0XHR9KS5jYXRjaChlcnJvciA9PiB7XG5cdFx0XHRcdFx0XHRcdFx0XHRpZihlcnJvcil7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdHRocm93IG5ldyBFcnJvcihlcnJvcik7XG5cdFx0XHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdFx0fSk7XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHR9ZWxzZXtcblx0XHRcdFx0XHRcdHJldHVybiBtb2RlbHMuQ29tZW50YXJpby5maW5kQnlJZEFuZFVwZGF0ZShhcmdzLmlkQ29tZW50YXJpbyxcblx0XHRcdFx0XHRcdFx0eyRwdXNoOntcInZvdGFjaW9uXCI6e1widXN1YXJpb19jcmVhZG9yXCI6IGFyZ3MuaWRVc3VhcmlvLCBcImxpa2VcIjowLCBcImRpc2xpa2VcIjowLCBcImZhdm9yaXRvc1wiOjF9fVxuXHRcdFx0XHRcdFx0XHR9LHtuZXc6IHRydWV9KVxuXHRcdFx0XHRcdFx0XHQucG9wdWxhdGUoXCJ2b3RhY2lvbi51c3VhcmlvX2NyZWFkb3JcIilcblx0XHRcdFx0XHRcdFx0LnRoZW4oKCkgPT4ge1xuXHRcdFx0XHRcdFx0XHRcdHJldHVybiAxO1xuXHRcdFx0XHRcdFx0XHR9KS5jYXRjaChlcnJvciA9PiB7XG5cdFx0XHRcdFx0XHRcdFx0aWYoZXJyb3Ipe1xuXHRcdFx0XHRcdFx0XHRcdFx0dGhyb3cgbmV3IEVycm9yKGVycm9yKTtcblx0XHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdH0pO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fSkuY2F0Y2goZXJyb3IgPT4ge1xuXHRcdFx0XHRcdGlmIChlcnJvcil7XG5cdFx0XHRcdFx0XHR0aHJvdyBuZXcgRXJyb3IoZXJyb3IpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fSk7XG5cdFx0fVxuXHR9XG59OyJdfQ==