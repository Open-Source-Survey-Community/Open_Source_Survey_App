"use strict";

Object.defineProperty(exports, "__esModule", {
	value: true
});
exports.default = {
	Query: {
		listadoEtiquetasCorrecciones: function listadoEtiquetasCorrecciones(parent, args, _ref) {
			var models = _ref.models;

			if (args.idioma) {
				return models.etiquetaCorrecciones.find({ idioma: args.idioma }).populate("usuariopropietario").then(function (documentoEtiquetaCorrecciones) {
					return documentoEtiquetaCorrecciones;
				}).catch(function (error) {
					if (error) {
						throw new Error(error);
					}
				});
			} else {
				throw new Error("is neccessary a lenguage to filter tags");
			}
		},
		filtrarEtiquetasCorrecciones: function filtrarEtiquetasCorrecciones(parent, args, _ref2) {
			var models = _ref2.models;

			return models.etiquetaCorrecciones.find({ idioma: args.idioma, etiqueta: new RegExp(args.caracter, "i") }).populate("usuariopropietario").limit(10).then(function (documento) {
				return documento;
			}).catch(function (error) {
				if (error) {
					throw new Error(error);
				}
			});
		},
		filtrarMyEtiquetasCorrecciones: function filtrarMyEtiquetasCorrecciones(parent, args, _ref3) {
			var models = _ref3.models;

			if (!args.limit) {
				args.limit = 10;
			} else {
				args.limit = args.limit * 10;
			}

			return models.etiquetaCorrecciones.find({ usuariopropietario: args.usuario_ID,
				etiqueta: new RegExp(args.caracter, "i") }).populate("usuariopropietario").limit(args.limit).then(function (documento) {
				return documento;
			}).catch(function (error) {
				if (error) {
					throw new Error(error);
				}
			});
		}

	},
	Mutation: {
		crearNuevaEtiquetaCorrecciones: function crearNuevaEtiquetaCorrecciones(parent, args, _ref4) {
			var models = _ref4.models;

			return models.etiquetaCorrecciones.findOne({ etiqueta: { $regex: new RegExp(args.etiqueta.etiqueta, "i") } }).then(function (etiqueta) {
				if (etiqueta) {
					throw new Error("this tag already exist in the collection");
				} else {
					var etiquetaCorrecciones = new models.etiquetaCorrecciones(args.etiqueta);
					return etiquetaCorrecciones.save().then(function (documento) {
						return documento;
					}).catch(function (error) {
						if (error) {
							throw new Error(error);
						}
					});
				}
			}).catch(function (error) {
				if (error) {
					throw new Error(error);
				}
			});
		},
		editarEtiquetaCorrecciontoPregunta: function editarEtiquetaCorrecciontoPregunta(parent, args, _ref5) {
			var models = _ref5.models;

			return models.etiquetaCorrecciones.findById(args.idEtiquetaCorreccion, "usuariopropietario").populate("usuariopropietario").then(function (documentoEtiquetaCorreccion) {
				if (documentoEtiquetaCorreccion.usuariopropietario.correo === args.correoUsuario) {
					return models.discusionPregunta.count({ etiquetas_correcciones: args.idEtiquetaCorreccion,
						habilitada: true }).then(function (numeroDiscusionesPreguntas) {
						if (numeroDiscusionesPreguntas > 0) {
							throw new Error("you can't edit this tag, because other users are using the same tag");
						} else {
							return models.etiquetaCorrecciones.findByIdAndUpdate(args.idEtiquetaCorreccion, { $set: { color: args.color, descripcion: args.descripcion, etiqueta: args.etiqueta } }, { new: true }).then(function (etiquetaCorreccionEditada) {
								return etiquetaCorreccionEditada;
							}).catch(function (error) {
								if (error) {
									throw new Error(error);
								}
							});
						}
					}).catch(function (error) {
						if (error) {
							throw new Error(error);
						}
					});
				} else {
					throw new Error("you can't edit this tag because you are not the owner");
				}
			}).catch(function (error) {
				if (error) {
					throw new Error(error);
				}
			});
		},
		eliminarEtiquetaCorreccionPregunta: function eliminarEtiquetaCorreccionPregunta(parent, args, _ref6) {
			var models = _ref6.models;

			return models.etiquetaCorrecciones.findById(args.idEtiquetaCorreccion, "usuariopropietario").populate("usuariopropietario").then(function (documentoEtiquetaCorreccion) {
				if (documentoEtiquetaCorreccion.usuariopropietario.correo === args.correoUsuario) {
					return models.discusionPregunta.count({ etiquetas_correcciones: args.idEtiquetaCorreccion,
						habilitada: true }).then(function (numeroDiscusionesPreguntas) {
						if (numeroDiscusionesPreguntas > 0) {
							throw new Error("you can't edit this tag, because other users are using the same tag");
						} else {
							return models.etiquetaCorrecciones.findByIdAndRemove(args.idEtiquetaCorreccion).then(function (etiquetaCorreccionEditada) {
								return etiquetaCorreccionEditada;
							}).catch(function (error) {
								if (error) {
									throw new Error(error);
								}
							});
						}
					}).catch(function (error) {
						if (error) {
							throw new Error(error);
						}
					});
				} else {
					throw new Error("you can't edit this tag because you are not the owner");
				}
			}).catch(function (error) {
				if (error) {
					throw new Error(error);
				}
			});
		}

	}

};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3Jlc29sdmVycy9ldGlxdWV0YXMtY29ycmVjY2lvbmVzLmpzIl0sIm5hbWVzIjpbIlF1ZXJ5IiwibGlzdGFkb0V0aXF1ZXRhc0NvcnJlY2Npb25lcyIsInBhcmVudCIsImFyZ3MiLCJtb2RlbHMiLCJpZGlvbWEiLCJldGlxdWV0YUNvcnJlY2Npb25lcyIsImZpbmQiLCJwb3B1bGF0ZSIsInRoZW4iLCJkb2N1bWVudG9FdGlxdWV0YUNvcnJlY2Npb25lcyIsImNhdGNoIiwiZXJyb3IiLCJFcnJvciIsImZpbHRyYXJFdGlxdWV0YXNDb3JyZWNjaW9uZXMiLCJldGlxdWV0YSIsIlJlZ0V4cCIsImNhcmFjdGVyIiwibGltaXQiLCJkb2N1bWVudG8iLCJmaWx0cmFyTXlFdGlxdWV0YXNDb3JyZWNjaW9uZXMiLCJ1c3VhcmlvcHJvcGlldGFyaW8iLCJ1c3VhcmlvX0lEIiwiTXV0YXRpb24iLCJjcmVhck51ZXZhRXRpcXVldGFDb3JyZWNjaW9uZXMiLCJmaW5kT25lIiwiJHJlZ2V4Iiwic2F2ZSIsImVkaXRhckV0aXF1ZXRhQ29ycmVjY2lvbnRvUHJlZ3VudGEiLCJmaW5kQnlJZCIsImlkRXRpcXVldGFDb3JyZWNjaW9uIiwiZG9jdW1lbnRvRXRpcXVldGFDb3JyZWNjaW9uIiwiY29ycmVvIiwiY29ycmVvVXN1YXJpbyIsImRpc2N1c2lvblByZWd1bnRhIiwiY291bnQiLCJldGlxdWV0YXNfY29ycmVjY2lvbmVzIiwiaGFiaWxpdGFkYSIsIm51bWVyb0Rpc2N1c2lvbmVzUHJlZ3VudGFzIiwiZmluZEJ5SWRBbmRVcGRhdGUiLCIkc2V0IiwiY29sb3IiLCJkZXNjcmlwY2lvbiIsIm5ldyIsImV0aXF1ZXRhQ29ycmVjY2lvbkVkaXRhZGEiLCJlbGltaW5hckV0aXF1ZXRhQ29ycmVjY2lvblByZWd1bnRhIiwiZmluZEJ5SWRBbmRSZW1vdmUiXSwibWFwcGluZ3MiOiI7Ozs7O2tCQUFlO0FBQ2RBLFFBQU87QUFDTkMsZ0NBQThCLHNDQUFDQyxNQUFELEVBQVND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Q0FBTjtBQUNBLE9BRkQsTUFFTTtBQUNMLGNBQU9ULE9BQU9FLG9CQUFQLENBQTRCd0MsaUJBQTVCLENBQThDM0MsS0FBSzJCLG9CQUFuRCxFQUNMckIsSUFESyxDQUNBLHFDQUE2QjtBQUNsQyxlQUFPbUMseUJBQVA7QUFDQSxRQUhLLEVBR0hqQyxLQUhHLENBR0csaUJBQVM7QUFDakIsWUFBSUMsS0FBSixFQUFXO0FBQ1YsZUFBTSxJQUFJQyxLQUFKLENBQVVELEtBQVYsQ0FBTjtBQUNBO0FBQ0QsUUFQSyxDQUFQO0FBU0E7QUFDRCxNQWhCSyxFQWdCSEQsS0FoQkcsQ0FnQkcsaUJBQVM7QUFDakIsVUFBSUMsS0FBSixFQUFVO0FBQ1QsYUFBTSxJQUFJQyxLQUFKLENBQVVELEtBQVYsQ0FBTjtBQUNBO0FBQ0QsTUFwQkssQ0FBUDtBQXNCQSxLQXZCRCxNQXVCSztBQUNKLFdBQU0sSUFBSUMsS0FBSixDQUFVLHVEQUFWLENBQU47QUFDQTtBQUNELElBN0JLLEVBNkJIRixLQTdCRyxDQTZCRyxpQkFBUztBQUNqQixRQUFJQyxLQUFKLEVBQVc7QUFDVixXQUFNLElBQUlDLEtBQUosQ0FBVUQsS0FBVixDQUFOO0FBQ0E7QUFDRCxJQWpDSyxDQUFQO0FBbUNBOztBQW5HUzs7QUE1REcsQyIsImZpbGUiOiJldGlxdWV0YXMtY29ycmVjY2lvbmVzLmpzIiwic291cmNlc0NvbnRlbnQiOlsiZXhwb3J0IGRlZmF1bHQge1xuXHRRdWVyeToge1xuXHRcdGxpc3RhZG9FdGlxdWV0YXNDb3JyZWNjaW9uZXM6IChwYXJlbnQsIGFyZ3MsIHttb2RlbHN9KSA9Pntcblx0XHRcdGlmIChhcmdzLmlkaW9tYSkge1xuXHRcdFx0XHRyZXR1cm4gbW9kZWxzLmV0aXF1ZXRhQ29ycmVjY2lvbmVzLmZpbmQoe2lkaW9tYTogYXJncy5pZGlvbWF9KS5wb3B1bGF0ZShcInVzdWFyaW9wcm9waWV0YXJpb1wiKVxuXHRcdFx0XHRcdC50aGVuKGRvY3VtZW50b0V0aXF1ZXRhQ29ycmVjY2lvbmVzID0+IHtcblx0XHRcdFx0XHRcdHJldHVybiBkb2N1bWVudG9FdGlxdWV0YUNvcnJlY2Npb25lcztcblxuXHRcdFx0XHRcdH0pLmNhdGNoKGVycm9yID0+IHtcblx0XHRcdFx0XHRcdGlmIChlcnJvcikge1xuXHRcdFx0XHRcdFx0XHR0aHJvdyBuZXcgRXJyb3IoZXJyb3IpO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH0pO1xuXG5cdFx0XHR9ZWxzZSB7XG5cdFx0XHRcdHRocm93IG5ldyBFcnJvcihcImlzIG5lY2Nlc3NhcnkgYSBsZW5ndWFnZSB0byBmaWx0ZXIgdGFnc1wiKTtcblxuXHRcdFx0fVxuXHRcdH0sXG5cdFx0ZmlsdHJhckV0aXF1ZXRhc0NvcnJlY2Npb25lczogKHBhcmVudCwgYXJncywge21vZGVsc30pID0+IHtcblx0XHRcdHJldHVybiBtb2RlbHMuZXRpcXVldGFDb3JyZWNjaW9uZXMuZmluZCh7aWRpb21hOiBhcmdzLmlkaW9tYSwgZXRpcXVldGE6IG5ldyBSZWdFeHAoYXJncy5jYXJhY3RlciwgXCJpXCIpfSlcblx0XHRcdFx0LnBvcHVsYXRlKFwidXN1YXJpb3Byb3BpZXRhcmlvXCIpXG5cdFx0XHRcdC5saW1pdCgxMClcblx0XHRcdFx0LnRoZW4oZG9jdW1lbnRvID0+IHtcblx0XHRcdFx0XHRyZXR1cm4gZG9jdW1lbnRvO1xuXG5cdFx0XHRcdH0pLmNhdGNoKGVycm9yID0+IHtcblx0XHRcdFx0XHRpZiAoZXJyb3IpIHtcblx0XHRcdFx0XHRcdHRocm93IG5ldyBFcnJvcihlcnJvcik7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdH0pO1xuXG5cdFx0fSxcblx0XHRmaWx0cmFyTXlFdGlxdWV0YXNDb3JyZWNjaW9uZXM6IChwYXJlbnQsIGFyZ3MsIHttb2RlbHN9KSA9PiB7XG5cdFx0XHRpZighYXJncy5saW1pdCkge1xuXHRcdFx0XHRhcmdzLmxpbWl0ID0gMTA7XG5cdFx0XHR9ZWxzZXtcblx0XHRcdFx0YXJncy5saW1pdCA9IGFyZ3MubGltaXQgKiAxMDtcblx0XHRcdH1cblxuXHRcdFx0cmV0dXJuIG1vZGVscy5ldGlxdWV0YUNvcnJlY2Npb25lcy5maW5kKHt1c3VhcmlvcHJvcGlldGFyaW86IGFyZ3MudXN1YXJpb19JRCxcblx0XHRcdFx0ZXRpcXVldGE6IG5ldyBSZWdFeHAoYXJncy5jYXJhY3RlciwgXCJpXCIpfSlcblx0XHRcdFx0LnBvcHVsYXRlKFwidXN1YXJpb3Byb3BpZXRhcmlvXCIpXG5cdFx0XHRcdC5saW1pdChhcmdzLmxpbWl0KVxuXHRcdFx0XHQudGhlbihkb2N1bWVudG8gPT4ge1xuXHRcdFx0XHRcdHJldHVybiBkb2N1bWVudG87XG5cblx0XHRcdFx0fSkuY2F0Y2goZXJyb3IgPT4ge1xuXHRcdFx0XHRcdGlmIChlcnJvcikge1xuXHRcdFx0XHRcdFx0dGhyb3cgbmV3IEVycm9yKGVycm9yKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0fSk7XG5cblxuXHRcdH1cblxuXG5cdH0sXG5cdE11dGF0aW9uIDoge1xuXHRcdGNyZWFyTnVldmFFdGlxdWV0YUNvcnJlY2Npb25lczogKHBhcmVudCwgYXJncywge21vZGVsc30pID0+IHtcblx0XHRcdHJldHVybiBtb2RlbHMuZXRpcXVldGFDb3JyZWNjaW9uZXMuZmluZE9uZSh7ZXRpcXVldGE6IHskcmVnZXg6IG5ldyBSZWdFeHAoYXJncy5ldGlxdWV0YS5ldGlxdWV0YSwgXCJpXCIpfX0pXG5cdFx0XHRcdC50aGVuKGV0aXF1ZXRhID0+IHtcblx0XHRcdFx0XHRpZiAoZXRpcXVldGEpIHtcblx0XHRcdFx0XHRcdHRocm93IG5ldyBFcnJvcihcInRoaXMgdGFnIGFscmVhZHkgZXhpc3QgaW4gdGhlIGNvbGxlY3Rpb25cIik7XG5cdFx0XHRcdFx0fWVsc2V7XG5cdFx0XHRcdFx0XHRjb25zdCBldGlxdWV0YUNvcnJlY2Npb25lcyA9IG5ldyBtb2RlbHMuZXRpcXVldGFDb3JyZWNjaW9uZXMoYXJncy5ldGlxdWV0YSk7XG5cdFx0XHRcdFx0XHRyZXR1cm4gZXRpcXVldGFDb3JyZWNjaW9uZXMuc2F2ZSgpXG5cdFx0XHRcdFx0XHRcdC50aGVuKGRvY3VtZW50byA9PiB7XG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuIGRvY3VtZW50bztcblx0XHRcdFx0XHRcdFx0fSlcblx0XHRcdFx0XHRcdFx0LmNhdGNoKGVycm9yID0+IHtcblx0XHRcdFx0XHRcdFx0XHRpZiAoZXJyb3IpIHtcblx0XHRcdFx0XHRcdFx0XHRcdHRocm93IG5ldyBFcnJvcihlcnJvcik7XG5cdFx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdH0pO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fSkuY2F0Y2goZXJyb3IgPT4ge1xuXHRcdFx0XHRcdGlmIChlcnJvcil7XG5cdFx0XHRcdFx0XHR0aHJvdyBuZXcgRXJyb3IoZXJyb3IpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fSk7XG5cdFx0fSxcblx0XHRlZGl0YXJFdGlxdWV0YUNvcnJlY2Npb250b1ByZWd1bnRhOiAocGFyZW50LCBhcmdzLCB7bW9kZWxzfSkgPT4ge1xuXHRcdFx0cmV0dXJuIG1vZGVscy5ldGlxdWV0YUNvcnJlY2Npb25lcy5maW5kQnlJZChhcmdzLmlkRXRpcXVldGFDb3JyZWNjaW9uLFwidXN1YXJpb3Byb3BpZXRhcmlvXCIpXG5cdFx0XHRcdC5wb3B1bGF0ZShcInVzdWFyaW9wcm9waWV0YXJpb1wiKVxuXHRcdFx0XHQudGhlbihkb2N1bWVudG9FdGlxdWV0YUNvcnJlY2Npb24gPT4ge1xuXHRcdFx0XHRcdGlmKGRvY3VtZW50b0V0aXF1ZXRhQ29ycmVjY2lvbi51c3VhcmlvcHJvcGlldGFyaW8uY29ycmVvID09PSBhcmdzLmNvcnJlb1VzdWFyaW8pe1xuXHRcdFx0XHRcdFx0cmV0dXJuIG1vZGVscy5kaXNjdXNpb25QcmVndW50YS5jb3VudCh7ZXRpcXVldGFzX2NvcnJlY2Npb25lczogYXJncy5pZEV0aXF1ZXRhQ29ycmVjY2lvbixcblx0XHRcdFx0XHRcdFx0aGFiaWxpdGFkYTogdHJ1ZX0pXG5cdFx0XHRcdFx0XHRcdC50aGVuKG51bWVyb0Rpc2N1c2lvbmVzUHJlZ3VudGFzID0+IHtcblx0XHRcdFx0XHRcdFx0XHRpZiAobnVtZXJvRGlzY3VzaW9uZXNQcmVndW50YXMgPiAwKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHR0aHJvdyBuZXcgRXJyb3IoXCJ5b3UgY2FuJ3QgZWRpdCB0aGlzIHRhZywgYmVjYXVzZSBvdGhlciB1c2VycyBhcmUgdXNpbmcgdGhlIHNhbWUgdGFnXCIpO1xuXHRcdFx0XHRcdFx0XHRcdH1lbHNlIHtcblx0XHRcdFx0XHRcdFx0XHRcdHJldHVybiBtb2RlbHMuZXRpcXVldGFDb3JyZWNjaW9uZXMuZmluZEJ5SWRBbmRVcGRhdGUoYXJncy5pZEV0aXF1ZXRhQ29ycmVjY2lvbixcblx0XHRcdFx0XHRcdFx0XHRcdFx0eyRzZXQ6e2NvbG9yOiBhcmdzLmNvbG9yLCBkZXNjcmlwY2lvbjogYXJncy5kZXNjcmlwY2lvbiwgZXRpcXVldGE6IGFyZ3MuZXRpcXVldGF9fSxcblx0XHRcdFx0XHRcdFx0XHRcdFx0e25ldzogdHJ1ZX0pXG5cdFx0XHRcdFx0XHRcdFx0XHRcdC50aGVuKGV0aXF1ZXRhQ29ycmVjY2lvbkVkaXRhZGEgPT4ge1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdHJldHVybiBldGlxdWV0YUNvcnJlY2Npb25FZGl0YWRhO1xuXHRcdFx0XHRcdFx0XHRcdFx0XHR9KS5jYXRjaChlcnJvciA9PiB7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0aWYgKGVycm9yKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHR0aHJvdyBuZXcgRXJyb3IoZXJyb3IpO1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0XHRcdFx0fSk7XG5cblx0XHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdH0pLmNhdGNoKGVycm9yID0+IHtcblx0XHRcdFx0XHRcdFx0XHRpZiAoZXJyb3Ipe1xuXHRcdFx0XHRcdFx0XHRcdFx0dGhyb3cgbmV3IEVycm9yKGVycm9yKTtcblx0XHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdH0pO1xuXG5cdFx0XHRcdFx0fWVsc2V7XG5cdFx0XHRcdFx0XHR0aHJvdyBuZXcgRXJyb3IoXCJ5b3UgY2FuJ3QgZWRpdCB0aGlzIHRhZyBiZWNhdXNlIHlvdSBhcmUgbm90IHRoZSBvd25lclwiKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH0pLmNhdGNoKGVycm9yID0+IHtcblx0XHRcdFx0XHRpZiAoZXJyb3IpIHtcblx0XHRcdFx0XHRcdHRocm93IG5ldyBFcnJvcihlcnJvcik7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9KTtcblx0XHR9LFxuXHRcdGVsaW1pbmFyRXRpcXVldGFDb3JyZWNjaW9uUHJlZ3VudGEgOiAocGFyZW50LCBhcmdzLCB7bW9kZWxzfSkgPT4ge1xuXHRcdFx0cmV0dXJuIG1vZGVscy5ldGlxdWV0YUNvcnJlY2Npb25lcy5maW5kQnlJZChhcmdzLmlkRXRpcXVldGFDb3JyZWNjaW9uLFwidXN1YXJpb3Byb3BpZXRhcmlvXCIpXG5cdFx0XHRcdC5wb3B1bGF0ZShcInVzdWFyaW9wcm9waWV0YXJpb1wiKVxuXHRcdFx0XHQudGhlbihkb2N1bWVudG9FdGlxdWV0YUNvcnJlY2Npb24gPT4ge1xuXHRcdFx0XHRcdGlmKGRvY3VtZW50b0V0aXF1ZXRhQ29ycmVjY2lvbi51c3VhcmlvcHJvcGlldGFyaW8uY29ycmVvID09PSBhcmdzLmNvcnJlb1VzdWFyaW8pe1xuXHRcdFx0XHRcdFx0cmV0dXJuIG1vZGVscy5kaXNjdXNpb25QcmVndW50YS5jb3VudCh7ZXRpcXVldGFzX2NvcnJlY2Npb25lczogYXJncy5pZEV0aXF1ZXRhQ29ycmVjY2lvbixcblx0XHRcdFx0XHRcdFx0aGFiaWxpdGFkYTogdHJ1ZX0pXG5cdFx0XHRcdFx0XHRcdC50aGVuKG51bWVyb0Rpc2N1c2lvbmVzUHJlZ3VudGFzID0+IHtcblx0XHRcdFx0XHRcdFx0XHRpZiAobnVtZXJvRGlzY3VzaW9uZXNQcmVndW50YXMgPiAwKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHR0aHJvdyBuZXcgRXJyb3IoXCJ5b3UgY2FuJ3QgZWRpdCB0aGlzIHRhZywgYmVjYXVzZSBvdGhlciB1c2VycyBhcmUgdXNpbmcgdGhlIHNhbWUgdGFnXCIpO1xuXHRcdFx0XHRcdFx0XHRcdH1lbHNlIHtcblx0XHRcdFx0XHRcdFx0XHRcdHJldHVybiBtb2RlbHMuZXRpcXVldGFDb3JyZWNjaW9uZXMuZmluZEJ5SWRBbmRSZW1vdmUoYXJncy5pZEV0aXF1ZXRhQ29ycmVjY2lvbilcblx0XHRcdFx0XHRcdFx0XHRcdFx0LnRoZW4oZXRpcXVldGFDb3JyZWNjaW9uRWRpdGFkYSA9PiB7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0cmV0dXJuIGV0aXF1ZXRhQ29ycmVjY2lvbkVkaXRhZGE7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdH0pLmNhdGNoKGVycm9yID0+IHtcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRpZiAoZXJyb3IpIHtcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdHRocm93IG5ldyBFcnJvcihlcnJvcik7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHRcdFx0XHR9KTtcblxuXHRcdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0fSkuY2F0Y2goZXJyb3IgPT4ge1xuXHRcdFx0XHRcdFx0XHRcdGlmIChlcnJvcil7XG5cdFx0XHRcdFx0XHRcdFx0XHR0aHJvdyBuZXcgRXJyb3IoZXJyb3IpO1xuXHRcdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0fSk7XG5cblx0XHRcdFx0XHR9ZWxzZXtcblx0XHRcdFx0XHRcdHRocm93IG5ldyBFcnJvcihcInlvdSBjYW4ndCBlZGl0IHRoaXMgdGFnIGJlY2F1c2UgeW91IGFyZSBub3QgdGhlIG93bmVyXCIpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fSkuY2F0Y2goZXJyb3IgPT4ge1xuXHRcdFx0XHRcdGlmIChlcnJvcikge1xuXHRcdFx0XHRcdFx0dGhyb3cgbmV3IEVycm9yKGVycm9yKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH0pO1xuXG5cdFx0fVxuXG5cdH1cblxufTsiXX0=