"use strict";

Object.defineProperty(exports, "__esModule", {
	value: true
});
exports.default = {

	Query: {
		mostrarPerfilUsuario: function mostrarPerfilUsuario(parent, args, _ref) {
			var models = _ref.models;

			if (args.id) {
				return models.User.findById(args.id).then(function (usuario) {
					return usuario;
				}).catch(function (error) {
					if (error) {
						throw new Error(error);
					}
				});
			} else {
				return null;
			}
		},
		listaUsuariosByName: function listaUsuariosByName(parent, args, _ref2) {
			var models = _ref2.models;

			return models.User.find({
				"nombre": new RegExp(args.nombre, "i")
			}).then(function (resultados) {
				return resultados;
			}).catch(function (error) {
				if (error) {
					return null;
				}
			});
		},
		listarTodosUsuarios: function listarTodosUsuarios(parent, args, _ref3) {
			var models = _ref3.models;

			return models.User.find().then(function (usuarios) {
				return usuarios;
			}).catch(function (error) {
				if (error) {
					return null;
				}
			});
		}
	},
	Mutation: {
		crearUsuario: function crearUsuario(parent, args, _ref4) {
			var models = _ref4.models;

			return models.User.findOne({
				correo: args.correo
			}, "_id nombre apellido correo urlImage wiki institucion grado_academico area_academica roles").then(function (response) {
				if (!response) {
					var userInstance = new models.User({ correo: args.correo,
						nombre: args.nombre,
						urlImage: args.urlImage,
						roles: [{ rol: args.rol, Acciones: [args.acciones] }] });
					return userInstance.save().then(function (documento) {
						return documento;
					}).catch(function (error) {
						if (error) {
							throw new Error(error);
						}
					});
				} else {
					return response;
				}
			}).catch(function (error) {
				if (error) {
					throw new Error(error);
				}
			});
		},
		editarInstitucionUsuario: function editarInstitucionUsuario(parent, args, _ref5) {
			var models = _ref5.models;

			if (args.id) {
				return models.User.findByIdAndUpdate(args.id, { $set: { institucion: args.institucion } }, { upsert: true, new: true }).then(function (documento) {
					return documento;
				}).catch(function (error) {
					if (error) {
						throw new Error(error);
					}
				});
			} else {
				return null;
			}
		},
		editarGradoAcademicoUsuario: function editarGradoAcademicoUsuario(parent, args, _ref6) {
			var models = _ref6.models;

			if (args.id) {
				return models.User.findByIdAndUpdate(args.id, { $set: { grado_academico: args.grado_academico } }, { upsert: true, new: true }).then(function (documento) {
					return documento;
				}).catch(function (error) {
					if (error) {
						throw new Error(error);
					}
				});
			} else {
				return null;
			}
		},
		editarAreaAcademica: function editarAreaAcademica(parent, args, _ref7) {
			var models = _ref7.models;

			if (args.id) {
				return models.User.findByIdAndUpdate(args.id, { $set: { area_academica: args.area_academica } }, { new: true }).then(function (documento) {
					return documento;
				}).catch(function (error) {
					if (error) {
						throw new Error(error);
					}
				});
			} else {
				return null;
			}
		},
		addWiki: function addWiki(parent, args, _ref8) {
			var models = _ref8.models;

			if (args.id) {
				return models.User.findByIdAndUpdate(args.id, { $set: { wiki: args.wiki } }, { new: true }).then(function (documento) {
					return documento;
				}).catch(function (error) {
					if (error) {
						throw new Error(error);
					}
				});
			} else {
				return null;
			}
		},
		editarNombreUsuario: function editarNombreUsuario(parent, args, _ref9) {
			var models = _ref9.models;

			if (args.id && args.nombre) {
				return models.User.findByIdAndUpdate(args.id, { $set: { nombre: args.nombre } }, { new: true }).then(function (documento) {
					return documento;
				}).catch(function (error) {
					if (error) {
						throw new Error(error);
					}
				});
			} else {
				return null;
			}
		},
		editarApellido: function editarApellido(parent, args, _ref10) {
			var models = _ref10.models;

			if (args.id && args.apellido) {
				return models.User.findByIdAndUpdate(args.id, { $set: { apellido: args.apellido } }, { new: true }).then(function (documento) {
					return documento;
				}).catch(function (error) {
					if (error) {
						throw new Error(error);
					}
				});
			} else {
				return null;
			}
		},
		addImage: function addImage(parent, args, _ref11) {
			var models = _ref11.models;

			if (args.id) {
				return models.User.findByIdAndUpdate(args.id, { $set: { urlImage: args.imagen } }, { new: true }).then(function (documento) {
					return documento;
				}).catch(function (error) {
					if (error) {
						throw new Error(error);
					}
				});
			} else {
				return null;
			}
		}
	}

};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3Jlc29sdmVycy91c2VyLmpzIl0sIm5hbWVzIjpbIlF1ZXJ5IiwibW9zdHJhclBlcmZpbFVzdWFyaW8iLCJwYXJlbnQiLCJhcmdzIiwibW9kZWxzIiwiaWQiLCJVc2VyIiwiZmluZEJ5SWQiLCJ0aGVuIiwidXN1YXJpbyIsImNhdGNoIiwiZXJyb3IiLCJFcnJvciIsImxpc3RhVXN1YXJpb3NCeU5hbWUiLCJmaW5kIiwiUmVnRXhwIiwibm9tYnJlIiwicmVzdWx0YWRvcyIsImxpc3RhclRvZG9zVXN1YXJpb3MiLCJ1c3VhcmlvcyIsIk11dGF0aW9uIiwiY3JlYXJVc3VhcmlvIiwiZmluZE9uZSIsImNvcnJlbyIsInJlc3BvbnNlIiwidXNlckluc3RhbmNlIiwidXJsSW1hZ2UiLCJyb2xlcyIsInJvbCIsIkFjY2lvbmVzIiwiYWNjaW9uZXMiLCJzYXZlIiwiZG9jdW1lbnRvIiwiZWRpdGFySW5zdGl0dWNpb25Vc3VhcmlvIiwiZmluZEJ5SWRBbmRVcGRhdGUiLCIkc2V0IiwiaW5zdGl0dWNpb24iLCJ1cHNlcnQiLCJuZXciLCJlZGl0YXJHcmFkb0FjYWRlbWljb1VzdWFyaW8iLCJncmFkb19hY2FkZW1pY28iLCJlZGl0YXJBcmVhQWNhZGVtaWNhIiwiYXJlYV9hY2FkZW1pY2EiLCJhZGRXaWtpIiwid2lraSIsImVkaXRhck5vbWJyZVVzdWFyaW8iLCJlZGl0YXJBcGVsbGlkbyIsImFwZWxsaWRvIiwiYWRkSW1hZ2UiLCJpbWFnZW4iXSwibWFwcGluZ3MiOiI7Ozs7O2tCQUFlOztBQUVkQSxRQUFNO0FBQ0xDLHdCQUFzQiw4QkFBQ0MsTUFBRCxFQUFTQyxJQUFULFFBQTBCO0FBQUEsT0FBVkMsTUFBVSxRQUFWQSxNQUFVOztBQUMvQyxPQUFJRCxLQUFLRSxFQUFULEVBQVk7QUFDWCxXQUFPRCxPQUFPRSxJQUFQLENBQVlDLFFBQVosQ0FBcUJKLEtBQUtFLEVBQTFCLEVBQ0xHLElBREssQ0FDQSxtQkFBUztBQUNkLFlBQU9DLE9BQVA7QUFDQSxLQUhL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SEcsQ0FHRyxpQkFBTztBQUNmLFNBQUlDLEtBQUosRUFBVTtBQUNULFlBQU0sSUFBSUMsS0FBSixDQUFVRCxLQUFWLENBQU47QUFDQTtBQUNELEtBUEssQ0FBUDtBQVNBLElBVkQsTUFVTTtBQUNMLFdBQU8sSUFBUDtBQUNBO0FBQ0Q7QUFoSU87O0FBMUNLLEMiLCJmaWxlIjoidXNlci5qcyIsInNvdXJjZXNDb250ZW50IjpbImV4cG9ydCBkZWZhdWx0IHtcblxuXHRRdWVyeTp7XG5cdFx0bW9zdHJhclBlcmZpbFVzdWFyaW86IChwYXJlbnQsIGFyZ3MsIHttb2RlbHN9KT0+e1xuXHRcdFx0aWYgKGFyZ3MuaWQpe1xuXHRcdFx0XHRyZXR1cm5cdG1vZGVscy5Vc2VyLmZpbmRCeUlkKGFyZ3MuaWQpXG5cdFx0XHRcdFx0LnRoZW4odXN1YXJpbz0+e1xuXHRcdFx0XHRcdFx0cmV0dXJuIHVzdWFyaW87XG5cdFx0XHRcdFx0fSkuY2F0Y2goZXJyb3I9Pntcblx0XHRcdFx0XHRcdGlmIChlcnJvcil7XG5cdFx0XHRcdFx0XHRcdHRocm93IG5ldyBFcnJvcihlcnJvcik7XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHR9KTtcblx0XHRcdH1lbHNlIHtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cdFx0fSxcblx0XHRsaXN0YVVzdWFyaW9zQnlOYW1lOiAocGFyZW50LCBhcmdzLCB7bW9kZWxzfSk9PiB7XG5cdFx0XHRyZXR1cm4gbW9kZWxzLlVzZXIuZmluZCh7XG5cdFx0XHRcdFwibm9tYnJlXCI6IG5ldyBSZWdFeHAoYXJncy5ub21icmUsIFwiaVwiKVxuXHRcdFx0fSlcblx0XHRcdFx0LnRoZW4ocmVzdWx0YWRvcyA9Pntcblx0XHRcdFx0XHRyZXR1cm4gcmVzdWx0YWRvcztcblx0XHRcdFx0fSkuY2F0Y2goZXJyb3IgPT57XG5cdFx0XHRcdFx0aWYgKGVycm9yKXtcblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fSk7XG5cblx0XHR9LFxuXHRcdGxpc3RhclRvZG9zVXN1YXJpb3M6IChwYXJlbnQsIGFyZ3MsIHttb2RlbHN9KT0+IHtcblx0XHRcdHJldHVybiBtb2RlbHMuVXNlci5maW5kKClcblx0XHRcdFx0LnRoZW4odXN1YXJpb3M9Pntcblx0XHRcdFx0XHRyZXR1cm4gdXN1YXJpb3M7XG5cdFx0XHRcdH0pLmNhdGNoKGVycm9yPT57XG5cdFx0XHRcdFx0aWYgKGVycm9yKXtcblx0XHRcdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fSk7XG5cdFx0fVxuXHR9LFxuXHRNdXRhdGlvbjp7XG5cdFx0Y3JlYXJVc3VhcmlvOiAocGFyZW50LCBhcmdzLCB7bW9kZWxzfSk9PiB7XG5cdFx0XHRyZXR1cm4gXHRtb2RlbHMuVXNlci5maW5kT25lKHtcblx0XHRcdFx0Y29ycmVvOiBhcmdzLmNvcnJlb1xuXHRcdFx0fSxcIl9pZCBub21icmUgYXBlbGxpZG8gY29ycmVvIHVybEltYWdlIHdpa2kgaW5zdGl0dWNpb24gZ3JhZG9fYWNhZGVtaWNvIGFyZWFfYWNhZGVtaWNhIHJvbGVzXCIpLnRoZW4ocmVzcG9uc2U9Pntcblx0XHRcdFx0aWYgKCFyZXNwb25zZSl7XG5cdFx0XHRcdFx0bGV0IHVzZXJJbnN0YW5jZSA9IG5ldyBtb2RlbHMuVXNlcih7Y29ycmVvOiBhcmdzLmNvcnJlbyxcblx0XHRcdFx0XHRcdG5vbWJyZTogYXJncy5ub21icmUsXG5cdFx0XHRcdFx0XHR1cmxJbWFnZTogYXJncy51cmxJbWFnZSxcblx0XHRcdFx0XHRcdHJvbGVzOiBbe3JvbDphcmdzLnJvbCwgQWNjaW9uZXM6IFthcmdzLmFjY2lvbmVzXX1dfSk7XG5cdFx0XHRcdFx0cmV0dXJuXHR1c2VySW5zdGFuY2Uuc2F2ZSgpLnRoZW4oZG9jdW1lbnRvID0+IHtcblx0XHRcdFx0XHRcdHJldHVybiBkb2N1bWVudG87XG5cdFx0XHRcdFx0fSkuY2F0Y2goKGVycm9yKSA9PiB7XG5cdFx0XHRcdFx0XHRpZihlcnJvcil7XG5cdFx0XHRcdFx0XHRcdHRocm93IG5ldyBFcnJvcihlcnJvcik7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0cmV0dXJuIHJlc3BvbnNlO1xuXHRcdFx0XHR9XG5cdFx0XHR9KS5jYXRjaCgoZXJyb3IpID0+IHtcblx0XHRcdFx0aWYgKGVycm9yKXtcblx0XHRcdFx0XHR0aHJvdyBuZXcgRXJyb3IoZXJyb3IpO1xuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblxuXHRcdH0sXG5cdFx0ZWRpdGFySW5zdGl0dWNpb25Vc3VhcmlvOihwYXJlbnQsIGFyZ3MsIHttb2RlbHN9KT0+e1xuXHRcdFx0aWYgKGFyZ3MuaWQgKSB7XG5cdFx0XHRcdHJldHVybiBtb2RlbHMuVXNlci5maW5kQnlJZEFuZFVwZGF0ZShhcmdzLmlkLHskc2V0OntpbnN0aXR1Y2lvbjphcmdzLmluc3RpdHVjaW9ufX0se3Vwc2VydDogdHJ1ZSxuZXc6IHRydWV9KVxuXHRcdFx0XHRcdC50aGVuKGRvY3VtZW50bz0+e1xuXHRcdFx0XHRcdFx0cmV0dXJuIGRvY3VtZW50bztcblx0XHRcdFx0XHR9KS5jYXRjaChlcnJvcj0+e1xuXHRcdFx0XHRcdFx0aWYgKGVycm9yKXtcblx0XHRcdFx0XHRcdFx0dGhyb3cgbmV3IEVycm9yKGVycm9yKTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9KTtcblx0XHRcdH1lbHNlIHtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cdFx0fSxcblx0XHRlZGl0YXJHcmFkb0FjYWRlbWljb1VzdWFyaW86IChwYXJlbnQsIGFyZ3MsIHttb2RlbHN9KT0+e1xuXHRcdFx0aWYgKGFyZ3MuaWQgKSB7XG5cdFx0XHRcdHJldHVybiBtb2RlbHMuVXNlci5maW5kQnlJZEFuZFVwZGF0ZShhcmdzLmlkLHskc2V0OntncmFkb19hY2FkZW1pY286YXJncy5ncmFkb19hY2FkZW1pY299fSx7dXBzZXJ0OiB0cnVlLG5ldzogdHJ1ZX0pXG5cdFx0XHRcdFx0LnRoZW4oZG9jdW1lbnRvPT57XG5cdFx0XHRcdFx0XHRyZXR1cm4gZG9jdW1lbnRvO1xuXHRcdFx0XHRcdH0pLmNhdGNoKGVycm9yPT57XG5cdFx0XHRcdFx0XHRpZiAoZXJyb3Ipe1xuXHRcdFx0XHRcdFx0XHR0aHJvdyBuZXcgRXJyb3IoZXJyb3IpO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH0pO1xuXHRcdFx0fWVsc2Uge1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9LFxuXHRcdGVkaXRhckFyZWFBY2FkZW1pY2E6IChwYXJlbnQsIGFyZ3MsIHttb2RlbHN9KT0+e1xuXHRcdFx0aWYgKGFyZ3MuaWQpIHtcblx0XHRcdFx0cmV0dXJuIG1vZGVscy5Vc2VyLmZpbmRCeUlkQW5kVXBkYXRlKGFyZ3MuaWQseyRzZXQ6e2FyZWFfYWNhZGVtaWNhOmFyZ3MuYXJlYV9hY2FkZW1pY2F9fSx7bmV3OiB0cnVlfSlcblx0XHRcdFx0XHQudGhlbihkb2N1bWVudG89Pntcblx0XHRcdFx0XHRcdHJldHVybiBkb2N1bWVudG87XG5cdFx0XHRcdFx0fSkuY2F0Y2goZXJyb3I9Pntcblx0XHRcdFx0XHRcdGlmIChlcnJvcil7XG5cdFx0XHRcdFx0XHRcdHRocm93IG5ldyBFcnJvcihlcnJvcik7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHR9ZWxzZSB7XG5cdFx0XHRcdHJldHVybiBudWxsO1xuXG5cdFx0XHR9XG5cdFx0fSxcblx0XHRhZGRXaWtpOiAocGFyZW50LCBhcmdzLCB7bW9kZWxzfSk9Pntcblx0XHRcdGlmIChhcmdzLmlkKSB7XG5cdFx0XHRcdHJldHVybiBtb2RlbHMuVXNlci5maW5kQnlJZEFuZFVwZGF0ZShhcmdzLmlkLHskc2V0Ont3aWtpOmFyZ3Mud2lraX19LHtuZXc6IHRydWV9KVxuXHRcdFx0XHRcdC50aGVuKGRvY3VtZW50bz0+e1xuXHRcdFx0XHRcdFx0cmV0dXJuIGRvY3VtZW50bztcblx0XHRcdFx0XHR9KS5jYXRjaChlcnJvcj0+e1xuXHRcdFx0XHRcdFx0aWYgKGVycm9yKXtcblx0XHRcdFx0XHRcdFx0dGhyb3cgbmV3IEVycm9yKGVycm9yKTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9KTtcblxuXHRcdFx0fWVsc2Uge1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9LFxuXHRcdGVkaXRhck5vbWJyZVVzdWFyaW86IChwYXJlbnQsIGFyZ3MsIHttb2RlbHN9KT0+e1xuXHRcdFx0aWYgKGFyZ3MuaWQgJiYgYXJncy5ub21icmUpIHtcblx0XHRcdFx0cmV0dXJuIG1vZGVscy5Vc2VyLmZpbmRCeUlkQW5kVXBkYXRlKGFyZ3MuaWQseyRzZXQ6e25vbWJyZTphcmdzLm5vbWJyZX19LHtuZXc6IHRydWV9KVxuXHRcdFx0XHRcdC50aGVuKGRvY3VtZW50bz0+e1xuXHRcdFx0XHRcdFx0cmV0dXJuIGRvY3VtZW50bztcblx0XHRcdFx0XHR9KS5jYXRjaChlcnJvcj0+e1xuXHRcdFx0XHRcdFx0aWYgKGVycm9yKXtcblx0XHRcdFx0XHRcdFx0dGhyb3cgbmV3IEVycm9yKGVycm9yKTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9KTtcblxuXHRcdFx0fWVsc2Uge1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9LFxuXHRcdGVkaXRhckFwZWxsaWRvOiAocGFyZW50LCBhcmdzLCB7bW9kZWxzfSk9Pntcblx0XHRcdGlmIChhcmdzLmlkICYmIGFyZ3MuYXBlbGxpZG8pe1xuXHRcdFx0XHRyZXR1cm4gbW9kZWxzLlVzZXIuZmluZEJ5SWRBbmRVcGRhdGUoYXJncy5pZCx7JHNldDp7YXBlbGxpZG86YXJncy5hcGVsbGlkb319LHtuZXc6IHRydWV9KVxuXHRcdFx0XHRcdC50aGVuKGRvY3VtZW50bz0+e1xuXHRcdFx0XHRcdFx0cmV0dXJuIGRvY3VtZW50bztcblx0XHRcdFx0XHR9KS5jYXRjaChlcnJvcj0+e1xuXHRcdFx0XHRcdFx0aWYgKGVycm9yKXtcblx0XHRcdFx0XHRcdFx0dGhyb3cgbmV3IEVycm9yKGVycm9yKTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9KTtcblx0XHRcdH1lbHNlIHtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9XG5cdFx0fSxcblx0XHRhZGRJbWFnZTogKHBhcmVudCwgYXJncywge21vZGVsc30pPT57XG5cdFx0XHRpZiAoYXJncy5pZCl7XG5cdFx0XHRcdHJldHVybiBtb2RlbHMuVXNlci5maW5kQnlJZEFuZFVwZGF0ZShhcmdzLmlkLHskc2V0Ont1cmxJbWFnZTphcmdzLmltYWdlbn19LHtuZXc6IHRydWV9KVxuXHRcdFx0XHRcdC50aGVuKGRvY3VtZW50bz0+e1xuXHRcdFx0XHRcdFx0cmV0dXJuIGRvY3VtZW50bztcblx0XHRcdFx0XHR9KS5jYXRjaChlcnJvcj0+e1xuXHRcdFx0XHRcdFx0aWYgKGVycm9yKXtcblx0XHRcdFx0XHRcdFx0dGhyb3cgbmV3IEVycm9yKGVycm9yKTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9KTtcblxuXHRcdFx0fWVsc2Uge1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxufTsiXX0=